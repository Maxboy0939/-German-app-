<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>German App - Ø§Ù¾Ù„ÛŒÚ©ÛŒØ´Ù† ÛŒØ§Ø¯Ú¯ÛŒØ±ÛŒ Ø¢Ù„Ù…Ø§Ù†ÛŒ</title>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

    <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">

    <style>
        :root {
            --bg-primary: #000000;
            --bg-secondary: #1c1c1e;
            --bg-tertiary: #2c2c2e;
            --bg-quaternary: #3a3a3c;
            --bg-glass: rgba(255, 255, 255, 0.06);
            --bg-glass-hover: rgba(255, 255, 255, 0.1);
            --bg-glass-active: rgba(255, 255, 255, 0.15);
            --bg-glass-border: rgba(255, 255, 255, 0.08);
            --bg-glass-highlight: rgba(255, 255, 255, 0.15);
            --text-primary: #ffffff;
            --text-secondary: rgba(255, 255, 255, 0.7);
            --text-tertiary: rgba(255, 255, 255, 0.4);
            --accent-blue: #0a84ff;
            --accent-green: #30d158;
            --accent-orange: #ff9f0a;
            --accent-red: #ff453a;
            --accent-purple: #bf5af2;
            --accent-teal: #64d2ff;
            --accent-pink: #ff375f;
            --accent-yellow: #ffd60a;
            --accent-indigo: #5e5ce6;
            --shadow-glass: 0 8px 32px rgba(0, 0, 0, 0.4);
            --shadow-glass-lg: 0 20px 60px rgba(0, 0, 0, 0.5);
            --shadow-glow-blue: 0 0 30px rgba(10, 132, 255, 0.3);
            --border-radius-sm: 12px;
            --border-radius-md: 16px;
            --border-radius-lg: 22px;
            --border-radius-xl: 28px;
            --border-radius-full: 9999px;
            --blur-amount: 40px;
            --blur-heavy: 80px;
            --transition-fast: 0.2s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            --transition-smooth: 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            --transition-spring: 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            --transition-bounce: 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            --font-fa: 'Vazirmatn', sans-serif;
            --font-en: 'Inter', sans-serif;
            --nav-height: 84px;
        }

        [data-theme="light"] {
            --bg-primary: #f2f2f7;
            --bg-secondary: #ffffff;
            --bg-tertiary: #e5e5ea;
            --bg-quaternary: #d1d1d6;
            --bg-glass: rgba(255, 255, 255, 0.75);
            --bg-glass-hover: rgba(255, 255, 255, 0.88);
            --bg-glass-active: rgba(255, 255, 255, 0.95);
            --bg-glass-border: rgba(0, 0, 0, 0.06);
            --bg-glass-highlight: rgba(255, 255, 255, 0.95);
            --text-primary: #1c1c1e;
            --text-secondary: rgba(0, 0, 0, 0.55);
            --text-tertiary: rgba(0, 0, 0, 0.25);
            --accent-blue: #007aff;
            --accent-green: #28cd41;
            --accent-orange: #ff9500;
            --accent-red: #ff3b30;
            --accent-purple: #af52de;
            --accent-teal: #5ac8fa;
            --accent-pink: #ff2d55;
            --shadow-glass: 0 8px 32px rgba(0, 0, 0, 0.08);
            --shadow-glass-lg: 0 20px 60px rgba(0, 0, 0, 0.12);
            --shadow-glow-blue: 0 0 30px rgba(0, 122, 255, 0.15);
        }

        *, *::before, *::after {
            margin: 0; padding: 0; box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        html { font-size: 16px; scroll-behavior: smooth; }

        body {
            font-family: var(--font-fa);
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            min-height: 100dvh;
            overflow-x: hidden;
            transition: background 0.5s ease, color 0.5s ease;
            -webkit-font-smoothing: antialiased;
        }

        /* ====== GLASS COMPONENTS ====== */
        .glass {
            background: var(--bg-glass);
            backdrop-filter: blur(var(--blur-amount));
            -webkit-backdrop-filter: blur(var(--blur-amount));
            border: 1px solid var(--bg-glass-border);
            border-radius: var(--border-radius-lg);
            box-shadow: var(--shadow-glass);
            transition: all var(--transition-smooth);
            position: relative;
            overflow: hidden;
        }

        .glass::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, var(--bg-glass-highlight), transparent);
            opacity: 0.5;
            pointer-events: none;
        }

        .glass-interactive {
            cursor: pointer;
        }

        .glass-interactive:hover {
            background: var(--bg-glass-hover);
            transform: translateY(-2px);
            box-shadow: var(--shadow-glass-lg);
        }

        .glass-interactive:active {
            transform: translateY(0) scale(0.98);
            background: var(--bg-glass-active);
        }

        /* ====== APP CONTAINER ====== */
        #app {
            max-width: 430px;
            margin: 0 auto;
            min-height: 100vh;
            min-height: 100dvh;
            position: relative;
            padding-bottom: calc(var(--nav-height) + 16px);
        }

        /* ====== HEADER ====== */
        .app-header {
            position: sticky;
            top: 0;
            z-index: 100;
            background: var(--bg-glass);
            backdrop-filter: blur(var(--blur-heavy));
            -webkit-backdrop-filter: blur(var(--blur-heavy));
            border-bottom: 1px solid var(--bg-glass-border);
            padding: 14px 20px;
            padding-top: max(env(safe-area-inset-top, 14px), 14px);
        }

        .header-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
            min-height: 44px;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .header-title {
            font-size: 1.2rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--accent-blue), var(--accent-purple));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            flex: 1;
            text-align: center;
        }

        .header-btn {
            background: none;
            border: none;
            color: var(--accent-blue);
            font-size: 1rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 4px;
            font-family: var(--font-fa);
            padding: 10px;
            border-radius: var(--border-radius-sm);
            transition: all var(--transition-fast);
            min-width: 44px;
            justify-content: center;
        }

        .header-btn:active {
            background: var(--bg-glass);
            transform: scale(0.95);
        }

        .header-btn.back-btn {
            font-weight: 600;
        }

        .header-btn.hidden { visibility: hidden; pointer-events: none; }

        /* ====== BOTTOM NAV ====== */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 100%;
            max-width: 430px;
            height: var(--nav-height);
            background: var(--bg-glass);
            backdrop-filter: blur(var(--blur-heavy));
            -webkit-backdrop-filter: blur(var(--blur-heavy));
            border-top: 1px solid var(--bg-glass-border);
            display: flex;
            align-items: flex-start;
            justify-content: space-around;
            padding: 8px 4px;
            padding-bottom: max(env(safe-area-inset-bottom, 8px), 8px);
            z-index: 1000;
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 3px;
            background: none;
            border: none;
            color: var(--text-tertiary);
            cursor: pointer;
            padding: 8px 14px;
            border-radius: var(--border-radius-md);
            transition: all var(--transition-fast);
            font-family: var(--font-fa);
            min-width: 60px;
            position: relative;
        }

        .nav-item.active { color: var(--accent-blue); }

        .nav-item.active::after {
            content: '';
            position: absolute;
            top: -4px;
            width: 20px;
            height: 3px;
            border-radius: 2px;
            background: var(--accent-blue);
        }

        .nav-item .nav-icon { font-size: 1.4rem; transition: transform var(--transition-spring); }
        .nav-item.active .nav-icon { transform: scale(1.15); }
        .nav-item .nav-label { font-size: 0.62rem; font-weight: 600; }

        /* ====== PAGE SYSTEM ====== */
        .page {
            display: none;
            padding: 20px;
            animation: pageIn 0.35s ease;
        }
        .page.active { display: block; }

        @keyframes pageIn {
            from { opacity: 0; transform: translateY(16px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }
        @keyframes pulse { 0%,100% { transform: scale(1); } 50% { transform: scale(1.08); } }
        @keyframes ripple {
            0% { transform: scale(0); opacity: 0.5; }
            100% { transform: scale(4); opacity: 0; }
        }
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        /* ====== WELCOME BANNER ====== */
        .welcome-banner {
            background: linear-gradient(135deg, #0a84ff, #5e5ce6, #bf5af2);
            border-radius: var(--border-radius-xl);
            padding: 30px 24px;
            margin-bottom: 24px;
            position: relative;
            overflow: hidden;
        }

        .welcome-banner::before {
            content: '';
            position: absolute;
            top: -50%; right: -30%;
            width: 200px; height: 200px;
            border-radius: 50%;
            background: rgba(255,255,255,0.1);
        }

        .welcome-banner::after {
            content: 'ğŸ‡©ğŸ‡ª';
            position: absolute;
            bottom: -10px; left: 10px;
            font-size: 100px;
            opacity: 0.12;
        }

        .welcome-banner h1 {
            font-size: 1.7rem;
            color: #fff;
            margin-bottom: 6px;
            font-family: var(--font-en);
            font-weight: 800;
        }

        .welcome-banner .welcome-sub {
            color: rgba(255,255,255,0.88);
            font-size: 0.88rem;
            font-weight: 400;
        }

        .welcome-banner .welcome-user {
            margin-top: 14px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .welcome-banner .user-mini-avatar {
            width: 36px; height: 36px;
            border-radius: 50%;
            background: rgba(255,255,255,0.2);
            display: flex; align-items: center; justify-content: center;
            font-size: 1.2rem;
            overflow: hidden;
        }

        .welcome-banner .user-mini-avatar img {
            width: 100%; height: 100%;
            border-radius: 50%;
            object-fit: cover;
        }

        .welcome-banner .user-mini-name {
            color: #fff;
            font-weight: 600;
            font-size: 0.9rem;
        }

        /* ====== STATS ROW ====== */
        .stats-row {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-bottom: 28px;
        }

        .stat-card {
            text-align: center;
            padding: 16px 8px;
        }

        .stat-card .stat-emoji { font-size: 1.6rem; margin-bottom: 6px; }
        .stat-card .stat-value {
            font-size: 1.5rem; font-weight: 800;
            font-family: var(--font-en);
        }
        .stat-card .stat-label {
            font-size: 0.68rem;
            color: var(--text-secondary);
            margin-top: 2px;
        }

        /* ====== SECTION TITLE ====== */
        .sec-title {
            font-size: 1.1rem;
            font-weight: 700;
            margin-bottom: 14px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* ====== LEVEL GRID ====== */
        .level-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }

        .level-card {
            padding: 22px 16px;
            text-align: center;
        }

        .level-card .level-icon { font-size: 2.2rem; margin-bottom: 10px; }
        .level-card .level-name {
            font-size: 1.15rem;
            font-weight: 800;
            font-family: var(--font-en);
            margin-bottom: 2px;
        }
        .level-card .level-desc {
            font-size: 0.72rem;
            color: var(--text-secondary);
        }
        .level-card .level-progress {
            margin-top: 14px;
            height: 5px;
            background: var(--bg-tertiary);
            border-radius: 3px;
            overflow: hidden;
        }
        .level-card .level-progress-bar {
            height: 100%;
            border-radius: 3px;
            transition: width 0.8s ease;
        }

        /* Level Colors */
        .level-a11 .level-progress-bar { background: linear-gradient(90deg, #30d158, #28cd41); }
        .level-a12 .level-progress-bar { background: linear-gradient(90deg, #64d2ff, #5ac8fa); }
        .level-a21 .level-progress-bar { background: linear-gradient(90deg, #0a84ff, #007aff); }
        .level-a22 .level-progress-bar { background: linear-gradient(90deg, #bf5af2, #af52de); }
        .level-b11 .level-progress-bar { background: linear-gradient(90deg, #ff9f0a, #ff9500); }
        .level-b12 .level-progress-bar { background: linear-gradient(90deg, #ff375f, #ff2d55); }
        .level-b21 .level-progress-bar { background: linear-gradient(90deg, #ff453a, #ff3b30); }
        .level-b22 .level-progress-bar { background: linear-gradient(90deg, #ffd60a, #ffcc00); }

        /* ====== LESSON LIST ====== */
        .lesson-list { display: flex; flex-direction: column; gap: 8px; }

        .lesson-item {
            padding: 16px 18px;
            display: flex;
            align-items: center;
            gap: 14px;
        }

        .lesson-num {
            width: 42px; height: 42px;
            border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            font-weight: 800;
            font-size: 1rem;
            font-family: var(--font-en);
            color: #fff;
            flex-shrink: 0;
        }

        .lesson-info { flex: 1; }
        .lesson-title-text { font-weight: 600; font-size: 0.93rem; margin-bottom: 3px; }
        .lesson-sub-text { font-size: 0.75rem; color: var(--text-secondary); }
        .lesson-status { font-size: 1.1rem; }

        /* Progress bar in lessons page */
        .level-prog-bar {
            height: 6px;
            background: var(--bg-tertiary);
            border-radius: 3px;
            overflow: hidden;
            margin: 6px 0 4px;
        }
        .level-prog-fill {
            height: 100%;
            border-radius: 3px;
            background: linear-gradient(90deg, var(--accent-blue), var(--accent-purple));
            transition: width 0.8s ease;
        }

        /* ====== LESSON DETAIL 4 SECTIONS ====== */
        .lesson-hero {
            background: linear-gradient(135deg, var(--accent-blue), var(--accent-indigo));
            border-radius: var(--border-radius-xl);
            padding: 28px 22px;
            margin-bottom: 20px;
            text-align: center;
            color: #fff;
        }
        .lesson-hero h2 {
            font-size: 1.4rem;
            font-family: var(--font-en);
            font-weight: 800;
            margin-bottom: 6px;
        }
        .lesson-hero p { font-size: 0.88rem; opacity: 0.85; }

        .section-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }

        .section-btn {
            padding: 24px 14px;
            text-align: center;
        }
        .section-btn .s-icon { font-size: 2.4rem; margin-bottom: 10px; }
        .section-btn .s-name { font-weight: 700; font-size: 0.92rem; margin-bottom: 4px; }
        .section-btn .s-sub { font-size: 0.72rem; color: var(--text-secondary); }
        .section-btn .s-done {
            margin-top: 8px;
            font-size: 0.7rem;
            color: var(--accent-green);
            font-weight: 600;
        }

        /* ====== SECTION TABS ====== */
        .tabs {
            display: flex;
            gap: 6px;
            overflow-x: auto;
            padding: 2px 0 12px;
            -webkit-overflow-scrolling: touch;
        }
        .tabs::-webkit-scrollbar { display: none; }
        .tab-btn {
            padding: 8px 16px;
            border-radius: var(--border-radius-full);
            font-size: 0.8rem;
            font-weight: 600;
            white-space: nowrap;
            cursor: pointer;
            transition: all var(--transition-fast);
            background: var(--bg-glass);
            border: 1px solid var(--bg-glass-border);
            color: var(--text-secondary);
            font-family: var(--font-fa);
        }
        .tab-btn.active {
            background: var(--accent-blue);
            color: #fff;
            border-color: transparent;
            box-shadow: var(--shadow-glow-blue);
        }

        /* ====== VOCAB CARDS ====== */
        .vocab-list { display: flex; flex-direction: column; gap: 10px; }

        .v-card { padding: 18px; }
        .v-top {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 8px;
        }
        .v-word-group { display: flex; align-items: baseline; gap: 6px; flex-wrap: wrap; }
        .v-article {
            font-size: 0.78rem;
            color: var(--accent-orange);
            font-weight: 700;
            font-family: var(--font-en);
        }
        .v-word {
            font-size: 1.15rem;
            font-weight: 700;
            font-family: var(--font-en);
            color: var(--accent-blue);
        }
        .v-plural {
            font-size: 0.75rem;
            color: var(--accent-purple);
            font-family: var(--font-en);
        }
        .v-speak {
            background: linear-gradient(135deg, var(--accent-blue), var(--accent-indigo));
            border: none;
            color: #fff;
            width: 42px; height: 42px;
            border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            cursor: pointer;
            font-size: 1.1rem;
            transition: all var(--transition-fast);
            flex-shrink: 0;
            box-shadow: 0 4px 12px rgba(10, 132, 255, 0.3);
        }
        .v-speak:active { transform: scale(0.9); }
        .v-speak.playing {
            animation: pulse 0.5s infinite;
            background: linear-gradient(135deg, var(--accent-green), #28cd41);
        }
        .v-trans {
            font-size: 0.88rem;
            color: var(--text-secondary);
            margin-bottom: 10px;
        }
        .v-example {
            background: var(--bg-glass);
            border-radius: var(--border-radius-sm);
            padding: 12px 14px;
            border-right: 3px solid var(--accent-blue);
        }
        .v-example .ex-de {
            font-size: 0.86rem;
            font-family: var(--font-en);
            font-style: italic;
            margin-bottom: 4px;
        }
        .v-example .ex-fa {
            font-size: 0.78rem;
            color: var(--text-secondary);
        }

        /* ====== GRAMMAR ====== */
        .g-block { padding: 20px; margin-bottom: 12px; }
        .g-block h3 {
            font-size: 1.05rem;
            margin-bottom: 10px;
            color: var(--accent-purple);
        }
        .g-block p {
            font-size: 0.88rem;
            color: var(--text-secondary);
            margin-bottom: 8px;
            line-height: 1.7;
        }
        .g-table {
            width: 100%;
            border-collapse: collapse;
            margin: 10px 0;
            font-size: 0.82rem;
        }
        .g-table th {
            background: var(--bg-glass);
            padding: 10px;
            text-align: center;
            font-weight: 700;
            color: var(--accent-blue);
            font-family: var(--font-en);
        }
        .g-table td {
            padding: 9px 10px;
            text-align: center;
            border-bottom: 1px solid var(--bg-glass-border);
            font-family: var(--font-en);
        }
        .g-example {
            background: var(--bg-glass);
            border-radius: var(--border-radius-sm);
            padding: 10px 14px;
            margin: 6px 0;
            border-right: 3px solid var(--accent-purple);
        }
        .g-example .g-de {
            font-family: var(--font-en);
            font-style: italic;
            font-size: 0.88rem;
            margin-bottom: 3px;
        }
        .g-example .g-fa {
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        /* ====== EXPLANATION ====== */
        .exp-block { padding: 20px; margin-bottom: 12px; }
        .exp-block h3 {
            font-size: 1.05rem;
            margin-bottom: 10px;
            color: var(--accent-teal);
        }
        .exp-block p {
            font-size: 0.88rem;
            color: var(--text-secondary);
            line-height: 1.8;
            margin-bottom: 8px;
        }
        .dialog-box {
            background: var(--bg-glass);
            border-radius: var(--border-radius-md);
            padding: 14px;
            margin: 10px 0;
        }
        .dialog-line {
            display: flex;
            gap: 8px;
            margin-bottom: 6px;
            font-size: 0.88rem;
            align-items: flex-start;
        }
        .dialog-line:last-child { margin-bottom: 0; }
        .d-speaker {
            font-weight: 700;
            color: var(--accent-blue);
            font-family: var(--font-en);
            min-width: 55px;
            flex-shrink: 0;
        }

        /* ====== EXERCISES ====== */
        .ex-container { display: flex; flex-direction: column; gap: 14px; }
        .ex-card { padding: 20px; }
        .ex-type {
            font-size: 0.72rem;
            color: var(--accent-orange);
            font-weight: 700;
            margin-bottom: 8px;
            letter-spacing: 0.5px;
        }
        .ex-question {
            font-size: 0.95rem;
            font-weight: 600;
            margin-bottom: 14px;
            line-height: 1.6;
        }
        .ex-options { display: flex; flex-direction: column; gap: 8px; }
        .ex-opt {
            padding: 13px 16px;
            border-radius: var(--border-radius-sm);
            cursor: pointer;
            transition: all var(--transition-fast);
            font-size: 0.88rem;
            display: flex;
            align-items: center;
            gap: 12px;
            border: 1px solid var(--bg-glass-border);
            background: var(--bg-glass);
        }
        .ex-opt:active { transform: scale(0.98); }
        .opt-letter {
            width: 28px; height: 28px;
            border-radius: 50%;
            background: var(--bg-tertiary);
            display: flex; align-items: center; justify-content: center;
            font-weight: 700;
            font-size: 0.78rem;
            font-family: var(--font-en);
            flex-shrink: 0;
            transition: all var(--transition-fast);
        }
        .ex-opt.correct {
            background: rgba(48, 209, 88, 0.12);
            border-color: var(--accent-green);
        }
        .ex-opt.correct .opt-letter { background: var(--accent-green); color: #fff; }
        .ex-opt.wrong {
            background: rgba(255, 69, 58, 0.12);
            border-color: var(--accent-red);
            animation: shake 0.4s ease;
        }
        .ex-opt.wrong .opt-letter { background: var(--accent-red); color: #fff; }
        .ex-opt.disabled { pointer-events: none; opacity: 0.7; }

        .fill-input {
            background: transparent;
            border: none;
            border-bottom: 2px solid var(--accent-blue);
            color: var(--text-primary);
            font-size: 1rem;
            font-family: var(--font-en);
            padding: 6px 2px;
            outline: none;
            width: 100%;
            max-width: 250px;
            transition: border-color var(--transition-fast);
        }
        .fill-input:focus { border-color: var(--accent-purple); }

        .check-answer-btn {
            background: linear-gradient(135deg, var(--accent-blue), var(--accent-indigo));
            border: none;
            color: #fff;
            padding: 13px 24px;
            border-radius: var(--border-radius-md);
            font-family: var(--font-fa);
            font-size: 0.92rem;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            margin-top: 10px;
            transition: all var(--transition-fast);
        }
        .check-answer-btn:active { transform: scale(0.97); }

        .feedback {
            padding: 12px 14px;
            border-radius: var(--border-radius-sm);
            margin-top: 10px;
            font-size: 0.85rem;
            display: none;
            animation: fadeIn 0.3s ease;
        }
        .feedback.ok {
            display: block;
            background: rgba(48, 209, 88, 0.1);
            color: var(--accent-green);
            border: 1px solid rgba(48, 209, 88, 0.2);
        }
        .feedback.no {
            display: block;
            background: rgba(255, 69, 58, 0.1);
            color: var(--accent-red);
            border: 1px solid rgba(255, 69, 58, 0.2);
        }

        /* ====== SCORES PAGE ====== */
        .my-stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-bottom: 24px;
        }
        .my-stat { padding: 18px; text-align: center; }
        .my-stat .ms-num {
            font-size: 1.7rem;
            font-weight: 800;
            font-family: var(--font-en);
        }
        .my-stat .ms-label {
            font-size: 0.75rem;
            color: var(--text-secondary);
            margin-top: 4px;
        }

        .lb-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 14px 18px;
            margin-bottom: 6px;
        }
        .lb-rank {
            width: 32px; height: 32px;
            border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            font-weight: 800;
            font-family: var(--font-en);
            font-size: 0.85rem;
            flex-shrink: 0;
            background: var(--bg-tertiary);
            color: var(--text-primary);
        }
        .lb-rank.r1 { background: linear-gradient(135deg, #FFD700, #FFA500); color: #fff; }
        .lb-rank.r2 { background: linear-gradient(135deg, #C0C0C0, #999); color: #fff; }
        .lb-rank.r3 { background: linear-gradient(135deg, #CD7F32, #A0522D); color: #fff; }
        .lb-avatar {
            width: 40px; height: 40px;
            border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            font-size: 1.2rem;
            background: var(--bg-glass);
            flex-shrink: 0;
            overflow: hidden;
        }
        .lb-avatar img { width: 100%; height: 100%; border-radius: 50%; object-fit: cover; }
        .lb-info { flex: 1; }
        .lb-name { font-weight: 600; font-size: 0.92rem; }
        .lb-level { font-size: 0.72rem; color: var(--text-secondary); }
        .lb-score { font-weight: 800; font-family: var(--font-en); color: var(--accent-orange); font-size: 0.92rem; }

        /* ====== PROFILE PAGE ====== */
        .profile-hero {
            text-align: center;
            padding: 30px 20px;
            margin-bottom: 20px;
        }
        .profile-avatar {
            width: 90px; height: 90px;
            border-radius: 50%;
            margin: 0 auto 16px;
            display: flex; align-items: center; justify-content: center;
            font-size: 3rem;
            overflow: hidden;
            position: relative;
        }
        .profile-avatar.gradient-bg {
            background: linear-gradient(135deg, var(--accent-blue), var(--accent-purple), var(--accent-pink));
        }
        .profile-avatar img {
            width: 100%; height: 100%;
            border-radius: 50%;
            object-fit: cover;
        }
        .profile-avatar .avatar-ring {
            position: absolute;
            inset: -3px;
            border-radius: 50%;
            border: 3px solid transparent;
            background: linear-gradient(135deg, var(--accent-blue), var(--accent-purple)) border-box;
            -webkit-mask: linear-gradient(#fff 0 0) padding-box, linear-gradient(#fff 0 0);
            mask: linear-gradient(#fff 0 0) padding-box, linear-gradient(#fff 0 0);
            -webkit-mask-composite: xor;
            mask-composite: exclude;
        }
        .profile-name { font-size: 1.3rem; font-weight: 700; margin-bottom: 4px; }
        .profile-email { font-size: 0.82rem; color: var(--text-secondary); }

        .profile-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            margin-bottom: 20px;
        }
        .ps-item { text-align: center; padding: 14px 8px; }
        .ps-num {
            font-size: 1.3rem;
            font-weight: 800;
            font-family: var(--font-en);
        }
        .ps-label {
            font-size: 0.68rem;
            color: var(--text-secondary);
            margin-top: 2px;
        }

        .google-sign-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 14px;
            width: 100%;
            padding: 16px;
            border-radius: var(--border-radius-lg);
            background: var(--bg-secondary);
            border: 1px solid var(--bg-glass-border);
            color: var(--text-primary);
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition-fast);
            font-family: var(--font-fa);
            box-shadow: var(--shadow-glass);
        }
        .google-sign-btn:hover { transform: translateY(-2px); box-shadow: var(--shadow-glass-lg); }
        .google-sign-btn:active { transform: scale(0.98); }
        .google-sign-btn svg { width: 22px; height: 22px; }

        .sign-out-btn {
            width: 100%;
            padding: 14px;
            border-radius: var(--border-radius-md);
            background: rgba(255, 69, 58, 0.1);
            border: 1px solid rgba(255, 69, 58, 0.2);
            color: var(--accent-red);
            font-size: 0.92rem;
            font-weight: 600;
            cursor: pointer;
            font-family: var(--font-fa);
            margin-top: 16px;
            transition: all var(--transition-fast);
        }
        .sign-out-btn:active { transform: scale(0.97); }

        .loading-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.5);
            backdrop-filter: blur(10px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 5000;
        }
        .loading-overlay .spinner {
            width: 40px; height: 40px;
            border: 4px solid var(--bg-glass-border);
            border-top-color: var(--accent-blue);
            border-radius: 50%;
            animation: spin 0.7s linear infinite;
        }
        @keyframes spin { to { transform: rotate(360deg); } }

        /* ====== SETTINGS ====== */
        .settings-group { margin-bottom: 22px; }
        .sg-title {
            font-size: 0.75rem;
            color: var(--text-secondary);
            font-weight: 600;
            margin-bottom: 8px;
            padding: 0 6px;
        }
        .sg-list {
            border-radius: var(--border-radius-lg);
            overflow: hidden;
            background: var(--bg-glass);
            backdrop-filter: blur(var(--blur-amount));
            border: 1px solid var(--bg-glass-border);
        }
        .s-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 15px 18px;
            cursor: pointer;
            transition: background var(--transition-fast);
            border-bottom: 1px solid var(--bg-glass-border);
        }
        .s-item:last-child { border-bottom: none; }
        .s-item:active { background: var(--bg-glass-active); }
        .s-left { display: flex; align-items: center; gap: 12px; }
        .s-icon {
            width: 30px; height: 30px;
            border-radius: 8px;
            display: flex; align-items: center; justify-content: center;
            font-size: 0.9rem;
        }
        .s-label { font-size: 0.92rem; }
        .s-value {
            font-size: 0.82rem;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            gap: 4px;
        }

        /* Toggle */
        .toggle {
            width: 50px; height: 30px;
            border-radius: 15px;
            background: var(--bg-quaternary);
            position: relative;
            cursor: pointer;
            transition: background var(--transition-fast);
            flex-shrink: 0;
        }
        .toggle.on { background: var(--accent-green); }
        .toggle::after {
            content: '';
            position: absolute;
            width: 24px; height: 24px;
            border-radius: 50%;
            background: #fff;
            top: 3px; left: 3px;
            transition: left var(--transition-fast);
            box-shadow: 0 1px 3px rgba(0,0,0,0.2);
        }
        .toggle.on::after { left: 23px; }

        /* ====== TOAST ====== */
        .toast {
            position: fixed;
            top: 70px;
            left: 50%;
            transform: translateX(-50%) translateY(-120px);
            background: var(--bg-secondary);
            backdrop-filter: blur(40px);
            border: 1px solid var(--bg-glass-border);
            border-radius: var(--border-radius-md);
            padding: 13px 22px;
            font-size: 0.88rem;
            z-index: 6000;
            transition: transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            box-shadow: var(--shadow-glass-lg);
            max-width: 340px;
            text-align: center;
        }
        .toast.show { transform: translateX(-50%) translateY(0); }

        /* ====== SCROLLBAR ====== */
        ::-webkit-scrollbar { width: 3px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: var(--bg-quaternary); border-radius: 2px; }

        @media (max-width: 380px) {
            .level-grid { grid-template-columns: 1fr; }
            .section-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body data-theme="dark">

<div class="toast" id="toast"></div>
<div class="loading-overlay" id="loadingOverlay" style="display:none">
    <div class="spinner"></div>
</div>

<div id="app">
    <!-- HEADER -->
    <header class="app-header">
        <div class="header-content">
            <button class="header-btn back-btn hidden" id="backBtn" onclick="goBack()">
                â†’ Ø¨Ø§Ø²Ú¯Ø´Øª
            </button>
            <h1 class="header-title" id="headerTitle">German App</h1>
            <div class="header-right">
                <button class="header-btn" id="headerAction">ğŸ””</button>
            </div>
        </div>
    </header>

    <!-- ========== HOME ========== -->
    <div class="page active" id="page-home">
        <div class="welcome-banner">
            <h1>!Willkommen</h1>
            <p class="welcome-sub">Ø¨Ù‡ Ø§Ù¾Ù„ÛŒÚ©ÛŒØ´Ù† ÛŒØ§Ø¯Ú¯ÛŒØ±ÛŒ Ø²Ø¨Ø§Ù† Ø¢Ù„Ù…Ø§Ù†ÛŒ Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒØ¯</p>
            <div class="welcome-user" id="welcomeUser" style="display:none">
                <div class="user-mini-avatar" id="welcomeAvatar">ğŸ‘¤</div>
                <span class="user-mini-name" id="welcomeName"></span>
            </div>
        </div>

        <div class="stats-row">
            <div class="stat-card glass">
                <div class="stat-emoji">ğŸ”¥</div>
                <div class="stat-value" id="statStreak">0</div>
                <div class="stat-label">Ø±ÙˆØ² Ù…ØªÙˆØ§Ù„ÛŒ</div>
            </div>
            <div class="stat-card glass">
                <div class="stat-emoji">â­</div>
                <div class="stat-value" id="statXP">0</div>
                <div class="stat-label">Ø§Ù…ØªÛŒØ§Ø²</div>
            </div>
            <div class="stat-card glass">
                <div class="stat-emoji">ğŸ“š</div>
                <div class="stat-value" id="statDone">0</div>
                <div class="stat-label">Ø¯Ø±Ø³ ØªÙ…Ø§Ù… Ø´Ø¯Ù‡</div>
            </div>
        </div>

        <h2 class="sec-title">ğŸ“– Ø³Ø·ÙˆØ­ Ú©ØªØ§Ø¨ Menschen</h2>
        <div class="level-grid" id="levelGrid"></div>
    </div>

    <!-- ========== LESSONS LIST ========== -->
    <div class="page" id="page-lessons">
        <h2 class="sec-title" id="lessonsTitle"></h2>
        <div class="level-prog-bar"><div class="level-prog-fill" id="lessonsProg" style="width:0%"></div></div>
        <p style="font-size:0.75rem;color:var(--text-secondary);margin-bottom:18px" id="lessonsProgText"></p>
        <div class="lesson-list" id="lessonList"></div>
    </div>

    <!-- ========== LESSON DETAIL ========== -->
    <div class="page" id="page-detail">
        <div class="lesson-hero" id="lessonHero">
            <h2 id="detailTitle"></h2>
            <p id="detailSub"></p>
        </div>
        <div class="section-grid" id="sectionGrid"></div>
    </div>

    <!-- ========== SECTION CONTENT ========== -->
    <div class="page" id="page-section">
        <div class="tabs" id="sectionTabs"></div>
        <div id="sectionBody"></div>
    </div>

    <!-- ========== SCORES ========== -->
    <div class="page" id="page-scores">
        <h2 class="sec-title">ğŸ† Ø¬Ø¯ÙˆÙ„ Ø§Ù…ØªÛŒØ§Ø²Ø§Øª</h2>
        <div class="my-stats-grid">
            <div class="my-stat glass">
                <div class="ms-num" style="color:var(--accent-orange)" id="scXP">0</div>
                <div class="ms-label">Ø§Ù…ØªÛŒØ§Ø² Ú©Ù„</div>
            </div>
            <div class="my-stat glass">
                <div class="ms-num" style="color:var(--accent-green)" id="scRank">#1</div>
                <div class="ms-label">Ø±ØªØ¨Ù‡ Ø´Ù…Ø§</div>
            </div>
            <div class="my-stat glass">
                <div class="ms-num" style="color:var(--accent-purple)" id="scCorrect">0</div>
                <div class="ms-label">Ù¾Ø§Ø³Ø® ØµØ­ÛŒØ­</div>
            </div>
            <div class="my-stat glass">
                <div class="ms-num" style="color:var(--accent-blue)" id="scWords">0</div>
                <div class="ms-label">ÙˆØ§Ú˜Ù‡ Ø¢Ù…ÙˆØ®ØªÙ‡</div>
            </div>
        </div>
        <h3 class="sec-title">ğŸ‘‘ Ø¨Ø±ØªØ±ÛŒÙ†â€ŒÙ‡Ø§</h3>
        <div id="leaderboard"></div>
    </div>

    <!-- ========== ONLINE / PROFILE ========== -->
    <div class="page" id="page-online">
        <div id="viewLoggedOut">
            <div class="profile-hero glass">
                <div class="profile-avatar gradient-bg">
                    <span>ğŸ‘¤</span>
                </div>
                <h2 class="profile-name">ÙˆØ±ÙˆØ¯ Ø¨Ù‡ Ø­Ø³Ø§Ø¨ Ú©Ø§Ø±Ø¨Ø±ÛŒ</h2>
                <p class="profile-email">Ø¨Ø±Ø§ÛŒ Ø°Ø®ÛŒØ±Ù‡ Ù¾ÛŒØ´Ø±ÙØª Ùˆ Ø±Ù‚Ø§Ø¨Øª Ø¢Ù†Ù„Ø§ÛŒÙ† ÙˆØ§Ø±Ø¯ Ø´ÙˆÛŒØ¯</p>
            </div>

            <button class="google-sign-btn" onclick="googleSignIn()">
                <svg viewBox="0 0 24 24"><path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92a5.06 5.06 0 0 1-2.2 3.32v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.1z"/><path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/><path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/><path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/></svg>
                ÙˆØ±ÙˆØ¯ Ø¨Ø§ Ø­Ø³Ø§Ø¨ Ú¯ÙˆÚ¯Ù„
            </button>

            <div style="text-align:center;margin-top:20px;color:var(--text-tertiary);font-size:0.78rem">
                Ø¨Ø§ ÙˆØ±ÙˆØ¯ØŒ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù¾ÛŒØ´Ø±ÙØª Ø´Ù…Ø§ Ø¯Ø± ÙØ§ÛŒØ±Ø¨ÛŒØ³ Ø°Ø®ÛŒØ±Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯
            </div>
        </div>

        <div id="viewLoggedIn" style="display:none">
            <div class="profile-hero glass">
                <div class="profile-avatar" id="profAvatar">
                    <div class="avatar-ring"></div>
                    <span id="profAvatarContent">ğŸ‘¤</span>
                </div>
                <h2 class="profile-name" id="profName">Ú©Ø§Ø±Ø¨Ø±</h2>
                <p class="profile-email" id="profEmail">email@gmail.com</p>
            </div>

            <div class="profile-stats">
                <div class="ps-item glass">
                    <div class="ps-num" style="color:var(--accent-blue)" id="profLevel">A1.1</div>
                    <div class="ps-label">Ø³Ø·Ø­ ÙØ¹Ù„ÛŒ</div>
                </div>
                <div class="ps-item glass">
                    <div class="ps-num" style="color:var(--accent-green)" id="profProgress">0%</div>
                    <div class="ps-label">Ù¾ÛŒØ´Ø±ÙØª</div>
                </div>
                <div class="ps-item glass">
                    <div class="ps-num" style="color:var(--accent-orange)" id="profXP">0</div>
                    <div class="ps-label">Ø§Ù…ØªÛŒØ§Ø²</div>
                </div>
            </div>

            <div class="glass" style="padding:16px;margin-bottom:12px">
                <div class="sec-title" style="margin-bottom:12px;font-size:0.95rem">ğŸ“Š Ø¢Ù…Ø§Ø± ÛŒØ§Ø¯Ú¯ÛŒØ±ÛŒ</div>
                <div style="display:flex;justify-content:space-between;font-size:0.85rem;margin-bottom:8px">
                    <span style="color:var(--text-secondary)">Ø¯Ø±ÙˆØ³ ØªÚ©Ù…ÛŒÙ„ Ø´Ø¯Ù‡</span>
                    <span style="font-weight:700;font-family:var(--font-en)" id="profLessons">0</span>
                </div>
                <div style="display:flex;justify-content:space-between;font-size:0.85rem;margin-bottom:8px">
                    <span style="color:var(--text-secondary)">ÙˆØ§Ú˜Ù‡â€ŒÙ‡Ø§ÛŒ Ø¢Ù…ÙˆØ®ØªÙ‡</span>
                    <span style="font-weight:700;font-family:var(--font-en)" id="profWords">0</span>
                </div>
                <div style="display:flex;justify-content:space-between;font-size:0.85rem;margin-bottom:8px">
                    <span style="color:var(--text-secondary)">Ù¾Ø§Ø³Ø®â€ŒÙ‡Ø§ÛŒ ØµØ­ÛŒØ­</span>
                    <span style="font-weight:700;font-family:var(--font-en)" id="profCorrect">0</span>
                </div>
                <div style="display:flex;justify-content:space-between;font-size:0.85rem">
                    <span style="color:var(--text-secondary)">Ø±ÙˆØ² Ù…ØªÙˆØ§Ù„ÛŒ</span>
                    <span style="font-weight:700;font-family:var(--font-en)" id="profStreak">0</span>
                </div>
            </div>

            <button class="sign-out-btn" onclick="googleSignOut()">ğŸšª Ø®Ø±ÙˆØ¬ Ø§Ø² Ø­Ø³Ø§Ø¨ Ú©Ø§Ø±Ø¨Ø±ÛŒ</button>
        </div>
    </div>

    <!-- ========== SETTINGS ========== -->
    <div class="page" id="page-settings">
        <h2 class="sec-title">âš™ï¸ ØªÙ†Ø¸ÛŒÙ…Ø§Øª</h2>

        <div class="settings-group">
            <div class="sg-title">Ø¸Ø§Ù‡Ø± Ø¨Ø±Ù†Ø§Ù…Ù‡</div>
            <div class="sg-list">
                <div class="s-item" onclick="toggleDarkMode()">
                    <div class="s-left">
                        <div class="s-icon" style="background:#0a84ff">ğŸŒ™</div>
                        <span class="s-label">Ø­Ø§Ù„Øª ØªØ§Ø±ÛŒÚ©</span>
                    </div>
                    <div class="toggle on" id="togDark"></div>
                </div>
                <div class="s-item" onclick="cycleFont()">
                    <div class="s-left">
                        <div class="s-icon" style="background:#bf5af2">ğŸ”¤</div>
                        <span class="s-label">Ø§Ù†Ø¯Ø§Ø²Ù‡ ÙÙˆÙ†Øª</span>
                    </div>
                    <div class="s-value" id="valFont">Ù…ØªÙˆØ³Ø· â†</div>
                </div>
            </div>
        </div>

        <div class="settings-group">
            <div class="sg-title">ØµØ¯Ø§ Ùˆ ØªÙ„ÙØ¸</div>
            <div class="sg-list">
                <div class="s-item" onclick="toggleSnd()">
                    <div class="s-left">
                        <div class="s-icon" style="background:#30d158">ğŸ”Š</div>
                        <span class="s-label">ØµØ¯Ø§ÛŒ ØªÙ„ÙØ¸</span>
                    </div>
                    <div class="toggle on" id="togSound"></div>
                </div>
                <div class="s-item" onclick="toggleAuto()">
                    <div class="s-left">
                        <div class="s-icon" style="background:#ff9f0a">â–¶ï¸</div>
                        <span class="s-label">Ù¾Ø®Ø´ Ø®ÙˆØ¯Ú©Ø§Ø± ØµØ¯Ø§</span>
                    </div>
                    <div class="toggle" id="togAuto"></div>
                </div>
                <div class="s-item" onclick="cycleRate()">
                    <div class="s-left">
                        <div class="s-icon" style="background:#64d2ff">â©</div>
                        <span class="s-label">Ø³Ø±Ø¹Øª ØªÙ„ÙØ¸</span>
                    </div>
                    <div class="s-value" id="valRate">Ø¹Ø§Ø¯ÛŒ â†</div>
                </div>
            </div>
        </div>

        <div class="settings-group">
            <div class="sg-title">ÛŒØ§Ø¯Ú¯ÛŒØ±ÛŒ</div>
            <div class="sg-list">
                <div class="s-item" onclick="toggleNotif()">
                    <div class="s-left">
                        <div class="s-icon" style="background:#ff375f">ğŸ””</div>
                        <span class="s-label">ÛŒØ§Ø¯Ø¢ÙˆØ±ÛŒ Ø±ÙˆØ²Ø§Ù†Ù‡</span>
                    </div>
                    <div class="toggle on" id="togNotif"></div>
                </div>
            </div>
        </div>

        <div class="settings-group">
            <div class="sg-title">Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§</div>
            <div class="sg-list">
                <div class="s-item" onclick="resetAll()">
                    <div class="s-left">
                        <div class="s-icon" style="background:#ff453a">ğŸ—‘ï¸</div>
                        <span class="s-label" style="color:var(--accent-red)">Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ù‡Ù…Ù‡ Ù¾ÛŒØ´Ø±ÙØª</span>
                    </div>
                    <div class="s-value">â†</div>
                </div>
                <div class="s-item">
                    <div class="s-left">
                        <div class="s-icon" style="background:var(--bg-quaternary)">â„¹ï¸</div>
                        <span class="s-label">Ù†Ø³Ø®Ù‡</span>
                    </div>
                    <div class="s-value">2.0.0</div>
                </div>
            </div>
        </div>
    </div>

    <!-- BOTTOM NAV -->
    <nav class="bottom-nav">
        <button class="nav-item active" data-nav="home" onclick="navTo('home')">
            <span class="nav-icon">ğŸ </span><span class="nav-label">Ø®Ø§Ù†Ù‡</span>
        </button>
        <button class="nav-item" data-nav="scores" onclick="navTo('scores')">
            <span class="nav-icon">ğŸ†</span><span class="nav-label">Ø§Ù…ØªÛŒØ§Ø²Ø§Øª</span>
        </button>
        <button class="nav-item" data-nav="online" onclick="navTo('online')">
            <span class="nav-icon">ğŸ‘¤</span><span class="nav-label">Ù¾Ø±ÙˆÙØ§ÛŒÙ„</span>
        </button>
        <button class="nav-item" data-nav="settings" onclick="navTo('settings')">
            <span class="nav-icon">âš™ï¸</span><span class="nav-label">ØªÙ†Ø¸ÛŒÙ…Ø§Øª</span>
        </button>
    </nav>
</div>

<script>
    // ============================================
    // FIREBASE CONFIGURATION
    // ============================================
    // âš ï¸ Ø´Ù…Ø§ Ø¨Ø§ÛŒØ¯ Ø§ÛŒÙ† Ù…Ù‚Ø§Ø¯ÛŒØ± Ø±Ø§ Ø¨Ø§ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù¾Ø±ÙˆÚ˜Ù‡ Firebase Ø®ÙˆØ¯ØªØ§Ù† Ø¬Ø§ÛŒÚ¯Ø²ÛŒÙ† Ú©Ù†ÛŒØ¯
    // Ù…Ø±Ø§Ø­Ù„:
    // 1. Ø¨Ù‡ console.firebase.google.com Ø¨Ø±ÙˆÛŒØ¯
    // 2. ÛŒÚ© Ù¾Ø±ÙˆÚ˜Ù‡ Ø¨Ø³Ø§Ø²ÛŒØ¯
    // 3. Authentication Ø±Ø§ ÙØ¹Ø§Ù„ Ú©Ù†ÛŒØ¯ Ùˆ Google Sign-In Ø±Ø§ Ø§Ø¶Ø§ÙÙ‡ Ú©Ù†ÛŒØ¯
    // 4. Firestore Database Ø¨Ø³Ø§Ø²ÛŒØ¯
    // 5. Ù…Ù‚Ø§Ø¯ÛŒØ± config Ø±Ø§ Ø§Ø² Project Settings Ú©Ù¾ÛŒ Ú©Ù†ÛŒØ¯

    const firebaseConfig = {
        apiKey: "YOUR_API_KEY",
        authDomain: "YOUR_PROJECT.firebaseapp.com",
        projectId: "YOUR_PROJECT_ID",
        storageBucket: "YOUR_PROJECT.appspot.com",
        messagingSenderId: "YOUR_SENDER_ID",
        appId: "YOUR_APP_ID"
    };

    // Initialize Firebase
    let firebaseApp, auth, db, googleProvider;
    let firebaseReady = false;

    try {
        firebaseApp = firebase.initializeApp(firebaseConfig);
        auth = firebase.auth();
        db = firebase.firestore();
        googleProvider = new firebase.auth.GoogleAuthProvider();
        googleProvider.addScope('profile');
        googleProvider.addScope('email');
        firebaseReady = true;
        console.log('ÙØ§ÛŒØ±Ø¨ÛŒØ³ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Ø´Ø¯');
    } catch(e) {
        console.warn('Ø®Ø·Ø§ Ø¯Ø± Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ ÙØ§ÛŒØ±Ø¨ÛŒØ³:', e.message);
        firebaseReady = false;
    }

    // ============================================
    // COMPLETE BOOK DATA (Menschen)
    // ============================================
    const DATA = {
    "a1-1": {
        name:"A1.1", full:"Menschen A1.1", icon:"ğŸŒ±", desc:"Ù…Ø¨ØªØ¯ÛŒ - Ø¨Ø®Ø´ Ø§ÙˆÙ„", color:"#30d158",
        lessons:[
            {
                id:1, title:"Hallo! Ich bin Nicole", sub:"Ø³Ù„Ø§Ù… Ùˆ Ù…Ø¹Ø±ÙÛŒ Ø®ÙˆØ¯",
                explanation: { title:"Ù…Ø¹Ø±ÙÛŒ Ø®ÙˆØ¯ Ùˆ Ø¯ÛŒÚ¯Ø±Ø§Ù†", blocks:[
                    { heading:"Ù…ÙˆØ¶ÙˆØ¹ Ø¯Ø±Ø³", text:"Ø¯Ø± Ø§ÛŒÙ† Ø¯Ø±Ø³ ÛŒØ§Ø¯ Ù…ÛŒâ€ŒÚ¯ÛŒØ±ÛŒØ¯ Ø®ÙˆØ¯ Ø±Ø§ Ù…Ø¹Ø±ÙÛŒ Ú©Ù†ÛŒØ¯ØŒ Ù†Ø§Ù… Ùˆ Ú©Ø´ÙˆØ±ØªØ§Ù† Ø±Ø§ Ø¨Ú¯ÙˆÛŒÛŒØ¯ Ùˆ Ø³Ù„Ø§Ù… Ùˆ Ø§Ø­ÙˆØ§Ù„Ù¾Ø±Ø³ÛŒ Ú©Ù†ÛŒØ¯. Ù‡Ù…Ú†Ù†ÛŒÙ† ØªÙØ§ÙˆØª Ø®Ø·Ø§Ø¨ Ø±Ø³Ù…ÛŒ (Sie) Ùˆ ØºÛŒØ±Ø±Ø³Ù…ÛŒ (du) Ø±Ø§ ÛŒØ§Ø¯ Ù…ÛŒâ€ŒÚ¯ÛŒØ±ÛŒØ¯." },
                    { heading:"Ù…Ú©Ø§Ù„Ù…Ù‡ Ù†Ù…ÙˆÙ†Ù‡", dialog:[
                        {speaker:"Nicole",text:"Hallo! Ich bin Nicole. Und wie heiÃŸt du?"},
                        {speaker:"Mehdi",text:"Hallo! Ich heiÃŸe Mehdi."},
                        {speaker:"Nicole",text:"Woher kommst du?"},
                        {speaker:"Mehdi",text:"Ich komme aus dem Iran. Und du?"},
                        {speaker:"Nicole",text:"Ich komme aus Deutschland."},
                        {speaker:"Mehdi",text:"Welche Sprachen sprichst du?"},
                        {speaker:"Nicole",text:"Ich spreche Deutsch und Englisch."}
                    ]},
                    { heading:"Ù†Ú©ØªÙ‡ Ù…Ù‡Ù…", text:"Ø¯Ø± Ø¢Ù„Ù…Ø§Ù†ÛŒ du Ø¨Ø±Ø§ÛŒ Ø¯ÙˆØ³ØªØ§Ù† Ùˆ Ø¢Ø´Ù†Ø§ÛŒØ§Ù† Ùˆ Sie (Ø¨Ø§ Ø­Ø±Ù Ø¨Ø²Ø±Ú¯) Ø¨Ø±Ø§ÛŒ Ù…ÙˆÙ‚Ø¹ÛŒØªâ€ŒÙ‡Ø§ÛŒ Ø±Ø³Ù…ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯. ÙØ¹Ù„ Ø¨Ø¹Ø¯ Ø§Ø² Sie Ù…Ø«Ù„ sie (Ø¢Ù†Ù‡Ø§) ØµØ±Ù Ù…ÛŒâ€ŒØ´ÙˆØ¯." },
                    { heading:"Ø­Ø§Ù„Øª Ø±Ø³Ù…ÛŒ", dialog:[
                        {speaker:"Herr M.",text:"Guten Tag! Wie heiÃŸen Sie?"},
                        {speaker:"Frau S.",text:"Ich heiÃŸe Anna Schmidt. Und Sie?"},
                        {speaker:"Herr M.",text:"Ich bin Thomas MÃ¼ller. Woher kommen Sie?"},
                        {speaker:"Frau S.",text:"Aus Ã–sterreich."}
                    ]}
                ]},
                grammar: { title:"Ø¶Ù…Ø§ÛŒØ± Ø´Ø®ØµÛŒ Ùˆ ÙØ¹Ù„â€ŒÙ‡Ø§ÛŒ seinØŒ heiÃŸenØŒ kommen", blocks:[
                    { heading:"Ø¶Ù…Ø§ÛŒØ± Ø´Ø®ØµÛŒ", table:{ headers:["Ø¢Ù„Ù…Ø§Ù†ÛŒ","ÙØ§Ø±Ø³ÛŒ","Ù†Ù…ÙˆÙ†Ù‡"], rows:[
                        ["ich","Ù…Ù†","Ich bin Mehdi."],["du","ØªÙˆ","Du bist nett."],
                        ["er","Ø§Ùˆ (Ù…Ø±Ø¯)","Er ist groÃŸ."],["sie","Ø§Ùˆ (Ø²Ù†)","Sie ist klein."],
                        ["es","Ø¢Ù†","Es ist gut."],["wir","Ù…Ø§","Wir sind hier."],
                        ["ihr","Ø´Ù…Ø§ (ØºÛŒØ±Ø±Ø³Ù…ÛŒ Ø¬Ù…Ø¹)","Ihr seid nett."],["sie/Sie","Ø¢Ù†Ù‡Ø§ / Ø´Ù…Ø§ (Ø±Ø³Ù…ÛŒ)","Sie sind freundlich."]
                    ]}},
                    { heading:"ØµØ±Ù ÙØ¹Ù„ sein (Ø¨ÙˆØ¯Ù†)", table:{ headers:["Ø¶Ù…ÛŒØ±","ÙØ¹Ù„","Ù…Ø«Ø§Ù„"], rows:[
                        ["ich","bin","Ich bin Student."],["du","bist","Du bist nett."],
                        ["er/sie/es","ist","Er ist Lehrer."],["wir","sind","Wir sind Freunde."],
                        ["ihr","seid","Ihr seid toll."],["sie/Sie","sind","Sie sind aus Wien."]
                    ]}},
                    { heading:"ØµØ±Ù ÙØ¹Ù„ heiÃŸen (Ù†Ø§Ù… Ø¯Ø§Ø´ØªÙ†)", table:{ headers:["Ø¶Ù…ÛŒØ±","ÙØ¹Ù„","Ù…Ø«Ø§Ù„"], rows:[
                        ["ich","heiÃŸe","Ich heiÃŸe Mehdi."],["du","heiÃŸt","Wie heiÃŸt du?"],
                        ["er/sie/es","heiÃŸt","Sie heiÃŸt Anna."],["wir","heiÃŸen","Wir heiÃŸen MÃ¼ller."],
                        ["ihr","heiÃŸt","Wie heiÃŸt ihr?"],["sie/Sie","heiÃŸen","Wie heiÃŸen Sie?"]
                    ]}},
                    { heading:"ØµØ±Ù ÙØ¹Ù„ kommen (Ø¢Ù…Ø¯Ù†)", table:{ headers:["Ø¶Ù…ÛŒØ±","ÙØ¹Ù„","Ù…Ø«Ø§Ù„"], rows:[
                        ["ich","komme","Ich komme aus dem Iran."],["du","kommst","Woher kommst du?"],
                        ["er/sie/es","kommt","Er kommt aus Berlin."],["wir","kommen","Wir kommen aus Wien."],
                        ["ihr","kommt","Woher kommt ihr?"],["sie/Sie","kommen","Woher kommen Sie?"]
                    ]}},
                    { heading:"Ø¬Ù…Ù„Ù‡ Ù¾Ø±Ø³Ø´ÛŒ Ø¨Ø§ W-Frage", text:"ÙØ¹Ù„ Ù‡Ù…ÛŒØ´Ù‡ Ø¯Ø± Ø¬Ø§ÛŒÚ¯Ø§Ù‡ Ø¯ÙˆÙ…:", examples:[
                        {de:"Wie heiÃŸt du?",fa:"Ø§Ø³Ù…Øª Ú†ÛŒÙ‡ØŸ"},
                        {de:"Woher kommst du?",fa:"Ø§Ø² Ú©Ø¬Ø§ Ù…ÛŒØ§ÛŒØŸ"},
                        {de:"Wo wohnst du?",fa:"Ú©Ø¬Ø§ Ø²Ù†Ø¯Ú¯ÛŒ Ù…ÛŒâ€ŒÚ©Ù†ÛŒØŸ"}
                    ]},
                    { heading:"Ø¬Ù…Ù„Ù‡ Ù¾Ø±Ø³Ø´ÛŒ Ø¨Ù„Ù‡/Ø®ÛŒØ±", text:"ÙØ¹Ù„ Ø¯Ø± Ø¬Ø§ÛŒÚ¯Ø§Ù‡ Ø§ÙˆÙ„:", examples:[
                        {de:"Bist du Mehdi?",fa:"ØªÙˆ Ù…Ù‡Ø¯ÛŒ Ù‡Ø³ØªÛŒØŸ"},
                        {de:"Kommst du aus dem Iran?",fa:"Ø§Ø² Ø§ÛŒØ±Ø§Ù† Ù…ÛŒØ§ÛŒØŸ"}
                    ]}
                ]},
                vocabulary:[
                    {word:"hallo",article:"",plural:"",trans:"Ø³Ù„Ø§Ù…",ex:"Hallo, wie geht's?",exFa:"Ø³Ù„Ø§Ù…ØŒ Ø­Ø§Ù„Øª Ú†Ø·ÙˆØ±Ù‡ØŸ"},
                    {word:"guten Tag",article:"",plural:"",trans:"Ø±ÙˆØ² Ø¨Ø®ÛŒØ±",ex:"Guten Tag, Herr MÃ¼ller!",exFa:"Ø±ÙˆØ² Ø¨Ø®ÛŒØ± Ø¢Ù‚Ø§ÛŒ Ù…ÙˆÙ„Ø±!"},
                    {word:"guten Morgen",article:"",plural:"",trans:"ØµØ¨Ø­ Ø¨Ø®ÛŒØ±",ex:"Guten Morgen! Wie geht es Ihnen?",exFa:"ØµØ¨Ø­ Ø¨Ø®ÛŒØ±! Ø­Ø§Ù„ØªØ§Ù† Ú†Ø·ÙˆØ± Ø§Ø³ØªØŸ"},
                    {word:"guten Abend",article:"",plural:"",trans:"Ø¹ØµØ± Ø¨Ø®ÛŒØ±",ex:"Guten Abend zusammen!",exFa:"Ø¹ØµØ± Ù‡Ù…Ú¯ÛŒ Ø¨Ø®ÛŒØ±!"},
                    {word:"tschÃ¼s",article:"",plural:"",trans:"Ø®Ø¯Ø§Ø­Ø§ÙØ¸ (ØºÛŒØ±Ø±Ø³Ù…ÛŒ)",ex:"TschÃ¼s, bis morgen!",exFa:"Ø®Ø¯Ø§Ø­Ø§ÙØ¸ØŒ ØªØ§ ÙØ±Ø¯Ø§!"},
                    {word:"auf Wiedersehen",article:"",plural:"",trans:"Ø®Ø¯Ø§Ø­Ø§ÙØ¸ (Ø±Ø³Ù…ÛŒ)",ex:"Auf Wiedersehen!",exFa:"Ø®Ø¯Ø§Ø­Ø§ÙØ¸!"},
                    {word:"Name",article:"der",plural:"die Namen",trans:"Ø§Ø³Ù…",ex:"Mein Name ist Mehdi.",exFa:"Ø§Ø³Ù… Ù…Ù† Ù…Ù‡Ø¯ÛŒ Ø§Ø³Øª."},
                    {word:"Frau",article:"die",plural:"die Frauen",trans:"Ø®Ø§Ù†Ù…",ex:"Frau MÃ¼ller ist Lehrerin.",exFa:"Ø®Ø§Ù†Ù… Ù…ÙˆÙ„Ø± Ù…Ø¹Ù„Ù… Ø§Ø³Øª."},
                    {word:"Herr",article:"der",plural:"die Herren",trans:"Ø¢Ù‚Ø§",ex:"Herr Schmidt kommt aus Berlin.",exFa:"Ø¢Ù‚Ø§ÛŒ Ø§Ø´Ù…ÛŒØª Ø§Ø² Ø¨Ø±Ù„ÛŒÙ† Ù…ÛŒâ€ŒØ¢ÛŒØ¯."},
                    {word:"Land",article:"das",plural:"die LÃ¤nder",trans:"Ú©Ø´ÙˆØ±",ex:"Aus welchem Land kommst du?",exFa:"Ø§Ø² Ú†Ù‡ Ú©Ø´ÙˆØ±ÛŒ Ù…ÛŒâ€ŒØ¢ÛŒÛŒØŸ"},
                    {word:"Sprache",article:"die",plural:"die Sprachen",trans:"Ø²Ø¨Ø§Ù†",ex:"Welche Sprache sprichst du?",exFa:"Ú†Ù‡ Ø²Ø¨Ø§Ù†ÛŒ ØµØ­Ø¨Øª Ù…ÛŒâ€ŒÚ©Ù†ÛŒØŸ"},
                    {word:"Deutsch",article:"",plural:"",trans:"Ø¢Ù„Ù…Ø§Ù†ÛŒ",ex:"Ich lerne Deutsch.",exFa:"Ù…Ù† Ø¢Ù„Ù…Ø§Ù†ÛŒ ÛŒØ§Ø¯ Ù…ÛŒâ€ŒÚ¯ÛŒØ±Ù…."},
                    {word:"Englisch",article:"",plural:"",trans:"Ø§Ù†Ú¯Ù„ÛŒØ³ÛŒ",ex:"Sie spricht Englisch.",exFa:"Ø§Ùˆ Ø§Ù†Ú¯Ù„ÛŒØ³ÛŒ ØµØ­Ø¨Øª Ù…ÛŒâ€ŒÚ©Ù†Ø¯."},
                    {word:"kommen",article:"",plural:"",trans:"Ø¢Ù…Ø¯Ù†",ex:"Ich komme aus dem Iran.",exFa:"Ù…Ù† Ø§Ø² Ø§ÛŒØ±Ø§Ù† Ù…ÛŒâ€ŒØ¢ÛŒÙ…."},
                    {word:"heiÃŸen",article:"",plural:"",trans:"Ù†Ø§Ù… Ø¯Ø§Ø´ØªÙ†",ex:"Wie heiÃŸen Sie?",exFa:"Ø§Ø³Ù… Ø´Ù…Ø§ Ú†ÛŒØ³ØªØŸ"},
                    {word:"sprechen",article:"",plural:"",trans:"ØµØ­Ø¨Øª Ú©Ø±Ø¯Ù†",ex:"Er spricht drei Sprachen.",exFa:"Ø§Ùˆ Ø³Ù‡ Ø²Ø¨Ø§Ù† ØµØ­Ø¨Øª Ù…ÛŒâ€ŒÚ©Ù†Ø¯."},
                    {word:"wohnen",article:"",plural:"",trans:"Ø²Ù†Ø¯Ú¯ÛŒ Ú©Ø±Ø¯Ù†",ex:"Ich wohne in Berlin.",exFa:"Ù…Ù† Ø¯Ø± Ø¨Ø±Ù„ÛŒÙ† Ø²Ù†Ø¯Ú¯ÛŒ Ù…ÛŒâ€ŒÚ©Ù†Ù…."},
                    {word:"lernen",article:"",plural:"",trans:"ÛŒØ§Ø¯ Ú¯Ø±ÙØªÙ†",ex:"Wir lernen Deutsch.",exFa:"Ù…Ø§ Ø¢Ù„Ù…Ø§Ù†ÛŒ ÛŒØ§Ø¯ Ù…ÛŒâ€ŒÚ¯ÛŒØ±ÛŒÙ…."},
                    {word:"sein",article:"",plural:"",trans:"Ø¨ÙˆØ¯Ù†",ex:"Ich bin Student.",exFa:"Ù…Ù† Ø¯Ø§Ù†Ø´Ø¬Ùˆ Ù‡Ø³ØªÙ…."},
                    {word:"und",article:"",plural:"",trans:"Ùˆ",ex:"Ich spreche Deutsch und Englisch.",exFa:"Ù…Ù† Ø¢Ù„Ù…Ø§Ù†ÛŒ Ùˆ Ø§Ù†Ú¯Ù„ÛŒØ³ÛŒ ØµØ­Ø¨Øª Ù…ÛŒâ€ŒÚ©Ù†Ù…."},
                    {word:"auch",article:"",plural:"",trans:"Ù‡Ù…ØŒ Ù‡Ù…Ú†Ù†ÛŒÙ†",ex:"Ich komme auch aus dem Iran.",exFa:"Ù…Ù† Ù‡Ù… Ø§Ø² Ø§ÛŒØ±Ø§Ù† Ù…ÛŒâ€ŒØ¢ÛŒÙ…."},
                    {word:"ja",article:"",plural:"",trans:"Ø¨Ù„Ù‡",ex:"Ja, ich spreche Deutsch.",exFa:"Ø¨Ù„Ù‡ØŒ Ø¢Ù„Ù…Ø§Ù†ÛŒ ØµØ­Ø¨Øª Ù…ÛŒâ€ŒÚ©Ù†Ù…."},
                    {word:"nein",article:"",plural:"",trans:"Ø®ÛŒØ±",ex:"Nein, ich bin nicht mÃ¼de.",exFa:"Ù†Ù‡ØŒ Ø®Ø³ØªÙ‡ Ù†ÛŒØ³ØªÙ…."},
                    {word:"nicht",article:"",plural:"",trans:"Ù†Ù‡ (Ù†ÙÛŒ)",ex:"Er ist nicht hier.",exFa:"Ø§Ùˆ Ø§ÛŒÙ†Ø¬Ø§ Ù†ÛŒØ³Øª."},
                    {word:"wie",article:"",plural:"",trans:"Ú†Ø·ÙˆØ± / Ú†Ú¯ÙˆÙ†Ù‡",ex:"Wie heiÃŸt du?",exFa:"Ø§Ø³Ù…Øª Ú†ÛŒÙ‡ØŸ"},
                    {word:"woher",article:"",plural:"",trans:"Ø§Ø² Ú©Ø¬Ø§",ex:"Woher kommst du?",exFa:"Ø§Ø² Ú©Ø¬Ø§ Ù…ÛŒØ§ÛŒØŸ"},
                    {word:"wo",article:"",plural:"",trans:"Ú©Ø¬Ø§",ex:"Wo wohnst du?",exFa:"Ú©Ø¬Ø§ Ø²Ù†Ø¯Ú¯ÛŒ Ù…ÛŒâ€ŒÚ©Ù†ÛŒØŸ"},
                    {word:"aus",article:"",plural:"",trans:"Ø§Ø²",ex:"Ich komme aus Teheran.",exFa:"Ù…Ù† Ø§Ø² ØªÙ‡Ø±Ø§Ù† Ù…ÛŒâ€ŒØ¢ÛŒÙ…."},
                    {word:"in",article:"",plural:"",trans:"Ø¯Ø±",ex:"Ich wohne in MÃ¼nchen.",exFa:"Ù…Ù† Ø¯Ø± Ù…ÙˆÙ†ÛŒØ® Ø²Ù†Ø¯Ú¯ÛŒ Ù…ÛŒâ€ŒÚ©Ù†Ù…."}
                ],
                exercises:[
                    {type:"mc",q:"Â«Ù…Ù† Ù…Ù‡Ø¯ÛŒ Ù‡Ø³ØªÙ…Â» Ø¨Ù‡ Ø¢Ù„Ù…Ø§Ù†ÛŒ Ú†Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯ØŸ",opts:["Ich bin Mehdi.","Ich heiÃŸe Mehdi.","Ù‡Ø± Ø¯Ùˆ Ø¯Ø±Ø³Øª Ø§Ø³Øª.","Ich komme Mehdi."],ans:2},
                    {type:"mc",q:"Wie _____ du?",opts:["heiÃŸt","heiÃŸe","heiÃŸen","heiÃŸt ihr"],ans:0},
                    {type:"mc",q:"Woher _____ Sie?",opts:["kommst","kommt","kommen","komme"],ans:2},
                    {type:"mc",q:"Er _____ aus Berlin.",opts:["komme","kommst","kommt","kommen"],ans:2},
                    {type:"mc",q:"_____ du Deutsch?",opts:["Sprichst","Spreche","Sprecht","Sprechen"],ans:0},
                    {type:"mc",q:"Wir _____ Studenten.",opts:["bin","bist","ist","sind"],ans:3},
                    {type:"mc",q:"Ich _____ in MÃ¼nchen.",opts:["wohne","wohnst","wohnt","wohnen"],ans:0},
                    {type:"fill",q:'Ich _____ Anna. (heiÃŸen)',a:"heiÃŸe"},
                    {type:"fill",q:'Woher _____ du? (kommen)',a:"kommst"},
                    {type:"fill",q:'Er _____ Lehrer. (sein)',a:"ist"},
                    {type:"mc",q:"Ú©Ø¯Ø§Ù… ÛŒÚ© Ø³Ù„Ø§Ù… Ø±Ø³Ù…ÛŒ Ø§Ø³ØªØŸ",opts:["Hallo!","Guten Tag!","Hi!","TschÃ¼s!"],ans:1},
                    {type:"mc",q:"Auf Wiedersehen ÛŒØ¹Ù†ÛŒ Ú†Ù‡ØŸ",opts:["Ø³Ù„Ø§Ù…","Ø®Ø¯Ø§Ø­Ø§ÙØ¸ (Ø±Ø³Ù…ÛŒ)","ØµØ¨Ø­ Ø¨Ø®ÛŒØ±","Ø´Ø¨ Ø¨Ø®ÛŒØ±"],ans:1}
                ]
            },
            // Lessons 2-12 abbreviated but with full structure
            {id:2,title:"Ich bin Journalistin",sub:"Ø´ØºÙ„â€ŒÙ‡Ø§ Ùˆ Ø­Ø±ÙÙ‡â€ŒÙ‡Ø§",
                explanation:{title:"Ù…Ø¹Ø±ÙÛŒ Ø´ØºÙ„",blocks:[{heading:"Ù…ÙˆØ¶ÙˆØ¹",text:"ÛŒØ§Ø¯ Ù…ÛŒâ€ŒÚ¯ÛŒØ±ÛŒØ¯ Ø´ØºÙ„ØªØ§Ù† Ø±Ø§ Ø¨Ú¯ÙˆÛŒÛŒØ¯ Ùˆ ÙØ±Ù‚ Ù…Ø°Ú©Ø±/Ù…Ø¤Ù†Ø« Ø´ØºÙ„â€ŒÙ‡Ø§ Ø±Ø§ Ø¨Ø¯Ø§Ù†ÛŒØ¯. Ù…Ø«Ù„Ø§Ù‹ Lehrer (Ù…Ø¹Ù„Ù… Ù…Ø±Ø¯) Ùˆ Lehrerin (Ù…Ø¹Ù„Ù… Ø²Ù†)."},{heading:"Ù…Ú©Ø§Ù„Ù…Ù‡",dialog:[{speaker:"A",text:"Was bist du von Beruf?"},{speaker:"B",text:"Ich bin Journalistin."},{speaker:"A",text:"Wo arbeitest du?"},{speaker:"B",text:"Ich arbeite bei einer Zeitung."}]}]},
                grammar:{title:"ÙØ¹Ù„ arbeiten - Ù…Ø°Ú©Ø± Ùˆ Ù…Ø¤Ù†Ø« Ø´ØºÙ„",blocks:[{heading:"ØµØ±Ù arbeiten",table:{headers:["Ø¶Ù…ÛŒØ±","ÙØ¹Ù„"],rows:[["ich","arbeite"],["du","arbeitest"],["er/sie","arbeitet"],["wir","arbeiten"],["ihr","arbeitet"],["sie/Sie","arbeiten"]]}},{heading:"Ø´ØºÙ„â€ŒÙ‡Ø§ Ù…Ø°Ú©Ø±/Ù…Ø¤Ù†Ø«",table:{headers:["Ù…Ø°Ú©Ø±","Ù…Ø¤Ù†Ø«","ÙØ§Ø±Ø³ÛŒ"],rows:[["Lehrer","Lehrerin","Ù…Ø¹Ù„Ù…"],["Arzt","Ã„rztin","Ù¾Ø²Ø´Ú©"],["Student","Studentin","Ø¯Ø§Ù†Ø´Ø¬Ùˆ"],["Ingenieur","Ingenieurin","Ù…Ù‡Ù†Ø¯Ø³"],["Koch","KÃ¶chin","Ø¢Ø´Ù¾Ø²"]]}}]},
                vocabulary:[
                    {word:"Beruf",article:"der",plural:"die Berufe",trans:"Ø´ØºÙ„",ex:"Was ist dein Beruf?",exFa:"Ø´ØºÙ„Øª Ú†ÛŒÙ‡ØŸ"},
                    {word:"Arzt",article:"der",plural:"die Ã„rzte",trans:"Ù¾Ø²Ø´Ú© (Ù…Ø±Ø¯)",ex:"Er ist Arzt.",exFa:"Ø§Ùˆ Ù¾Ø²Ø´Ú© Ø§Ø³Øª."},
                    {word:"Ã„rztin",article:"die",plural:"die Ã„rztinnen",trans:"Ù¾Ø²Ø´Ú© (Ø²Ù†)",ex:"Sie ist Ã„rztin.",exFa:"Ø§Ùˆ Ù¾Ø²Ø´Ú© Ø§Ø³Øª."},
                    {word:"Lehrer",article:"der",plural:"die Lehrer",trans:"Ù…Ø¹Ù„Ù… (Ù…Ø±Ø¯)",ex:"Mein Vater ist Lehrer.",exFa:"Ù¾Ø¯Ø±Ù… Ù…Ø¹Ù„Ù… Ø§Ø³Øª."},
                    {word:"Lehrerin",article:"die",plural:"die Lehrerinnen",trans:"Ù…Ø¹Ù„Ù… (Ø²Ù†)",ex:"Frau MÃ¼ller ist Lehrerin.",exFa:"Ø®Ø§Ù†Ù… Ù…ÙˆÙ„Ø± Ù…Ø¹Ù„Ù… Ø§Ø³Øª."},
                    {word:"arbeiten",article:"",plural:"",trans:"Ú©Ø§Ø± Ú©Ø±Ø¯Ù†",ex:"Ich arbeite bei BMW.",exFa:"Ù…Ù† Ø¯Ø± Ø¨ÛŒâ€ŒØ§Ù…â€ŒÙˆ Ú©Ø§Ø± Ù…ÛŒâ€ŒÚ©Ù†Ù…."},
                    {word:"Krankenhaus",article:"das",plural:"die KrankenhÃ¤user",trans:"Ø¨ÛŒÙ…Ø§Ø±Ø³ØªØ§Ù†",ex:"Sie arbeitet im Krankenhaus.",exFa:"Ø§Ùˆ Ø¯Ø± Ø¨ÛŒÙ…Ø§Ø±Ø³ØªØ§Ù† Ú©Ø§Ø± Ù…ÛŒâ€ŒÚ©Ù†Ø¯."},
                    {word:"Schule",article:"die",plural:"die Schulen",trans:"Ù…Ø¯Ø±Ø³Ù‡",ex:"Er arbeitet in einer Schule.",exFa:"Ø§Ùˆ Ø¯Ø± Ù…Ø¯Ø±Ø³Ù‡ Ú©Ø§Ø± Ù…ÛŒâ€ŒÚ©Ù†Ø¯."}
                ],
                exercises:[
                    {type:"mc",q:"Was bist du von _____?",opts:["Beruf","Arbeit","Name","Land"],ans:0},
                    {type:"mc",q:"Ù…Ø¤Ù†Ø« Arzt Ú†ÛŒØ³ØªØŸ",opts:["Arztin","Ã„rztin","Arzte","Ã„rzte"],ans:1},
                    {type:"fill",q:"Sie _____ Lehrerin. (sein)",a:"ist"},
                    {type:"mc",q:"Ich _____ als Ingenieur.",opts:["arbeite","arbeitest","arbeitet","arbeiten"],ans:0}
                ]
            },
            {id:3,title:"Das ist mein Bruder",sub:"Ø®Ø§Ù†ÙˆØ§Ø¯Ù‡ Ùˆ Ø¶Ù…Ø§ÛŒØ± Ù…Ù„Ú©ÛŒ",
                explanation:{title:"Ø®Ø§Ù†ÙˆØ§Ø¯Ù‡",blocks:[{heading:"Ù…ÙˆØ¶ÙˆØ¹",text:"Ø§Ø¹Ø¶Ø§ÛŒ Ø®Ø§Ù†ÙˆØ§Ø¯Ù‡ Ùˆ Ø¶Ù…Ø§ÛŒØ± Ù…Ù„Ú©ÛŒ mein/dein/sein/ihr."},{heading:"Ù…Ú©Ø§Ù„Ù…Ù‡",dialog:[{speaker:"Lisa",text:"Hast du Geschwister?"},{speaker:"Tom",text:"Ja, mein Bruder heiÃŸt Max."}]}]},
                grammar:{title:"ÙØ¹Ù„ haben Ùˆ Ø¶Ù…Ø§ÛŒØ± Ù…Ù„Ú©ÛŒ",blocks:[{heading:"ØµØ±Ù haben",table:{headers:["Ø¶Ù…ÛŒØ±","ÙØ¹Ù„"],rows:[["ich","habe"],["du","hast"],["er/sie","hat"],["wir","haben"],["ihr","habt"],["sie/Sie","haben"]]}},{heading:"Ø¶Ù…Ø§ÛŒØ± Ù…Ù„Ú©ÛŒ",table:{headers:["Ø¶Ù…ÛŒØ±","Ù…Ø°Ú©Ø±/Ø®Ù†Ø«ÛŒ","Ù…Ø¤Ù†Ø«/Ø¬Ù…Ø¹"],rows:[["ich","mein","meine"],["du","dein","deine"],["er","sein","seine"],["sie","ihr","ihre"]]}}]},
                vocabulary:[
                    {word:"Familie",article:"die",plural:"die Familien",trans:"Ø®Ø§Ù†ÙˆØ§Ø¯Ù‡",ex:"Meine Familie ist groÃŸ.",exFa:"Ø®Ø§Ù†ÙˆØ§Ø¯Ù‡â€ŒØ§Ù… Ø¨Ø²Ø±Ú¯ Ø§Ø³Øª."},
                    {word:"Vater",article:"der",plural:"die VÃ¤ter",trans:"Ù¾Ø¯Ø±",ex:"Mein Vater ist 50.",exFa:"Ù¾Ø¯Ø±Ù… ÛµÛ° Ø³Ø§Ù„Ù‡ Ø§Ø³Øª."},
                    {word:"Mutter",article:"die",plural:"die MÃ¼tter",trans:"Ù…Ø§Ø¯Ø±",ex:"Meine Mutter kocht gern.",exFa:"Ù…Ø§Ø¯Ø±Ù… Ø¯ÙˆØ³Øª Ø¯Ø§Ø±Ø¯ Ø¢Ø´Ù¾Ø²ÛŒ Ú©Ù†Ø¯."},
                    {word:"Bruder",article:"der",plural:"die BrÃ¼der",trans:"Ø¨Ø±Ø§Ø¯Ø±",ex:"Mein Bruder heiÃŸt Ali.",exFa:"Ø¨Ø±Ø§Ø¯Ø±Ù… Ø§Ø³Ù…Ø´ Ø¹Ù„ÛŒ Ø§Ø³Øª."},
                    {word:"Schwester",article:"die",plural:"die Schwestern",trans:"Ø®ÙˆØ§Ù‡Ø±",ex:"Meine Schwester ist Ã„rztin.",exFa:"Ø®ÙˆØ§Ù‡Ø±Ù… Ù¾Ø²Ø´Ú© Ø§Ø³Øª."},
                    {word:"Kind",article:"das",plural:"die Kinder",trans:"Ø¨Ú†Ù‡",ex:"Sie hat zwei Kinder.",exFa:"Ø§Ùˆ Ø¯Ùˆ Ø¨Ú†Ù‡ Ø¯Ø§Ø±Ø¯."},
                    {word:"Eltern",article:"die",plural:"",trans:"ÙˆØ§Ù„Ø¯ÛŒÙ†",ex:"Meine Eltern wohnen in Teheran.",exFa:"ÙˆØ§Ù„Ø¯ÛŒÙ†Ù… Ø¯Ø± ØªÙ‡Ø±Ø§Ù† Ø²Ù†Ø¯Ú¯ÛŒ Ù…ÛŒâ€ŒÚ©Ù†Ù†Ø¯."},
                    {word:"verheiratet",article:"",plural:"",trans:"Ù…ØªØ£Ù‡Ù„",ex:"Er ist verheiratet.",exFa:"Ø§Ùˆ Ù…ØªØ£Ù‡Ù„ Ø§Ø³Øª."}
                ],
                exercises:[
                    {type:"mc",q:"Ich _____ zwei BrÃ¼der.",opts:["habe","hast","hat","haben"],ans:0},
                    {type:"mc",q:"_____ Schwester heiÃŸt Mina.",opts:["Mein","Meine","Meinen","Meiner"],ans:1},
                    {type:"fill",q:"Er _____ eine Tochter. (haben)",a:"hat"}
                ]
            },
            // Lessons 4-12 with minimal but complete structure
            ...[
                {id:4,title:"Der Tisch ist schÃ¶n!",sub:"Ø§Ø´ÛŒØ§Ø¡ØŒ Ø±Ù†Ú¯â€ŒÙ‡Ø§ Ùˆ Ø­Ø±Ù ØªØ¹Ø±ÛŒÙ"},
                {id:5,title:"Was ist das?",sub:"Ø§Ø¹Ø¯Ø§Ø¯ Ùˆ Ø§Ù„ÙØ¨Ø§"},
                {id:6,title:"Ich brauche kein Auto",sub:"Akkusativ Ùˆ Ù†ÛŒØ§Ø²Ù‡Ø§"},
                {id:7,title:"Du kannst wirklich toll...!",sub:"ÙØ¹Ù„ Ù…ÙˆØ¯Ø§Ù„ kÃ¶nnen"},
                {id:8,title:"Kein Problem. Ich habe Zeit!",sub:"Ø³Ø§Ø¹Øª Ùˆ Ø±ÙˆØ²Ù‡Ø§ÛŒ Ù‡ÙØªÙ‡"},
                {id:9,title:"Ich mÃ¶chte ...",sub:"Ø³ÙØ§Ø±Ø´ Ø¯Ø§Ø¯Ù† Ø¨Ø§ mÃ¶chten"},
                {id:10,title:"Ich steige jetzt aus",sub:"ÙØ¹Ù„â€ŒÙ‡Ø§ÛŒ Ø¬Ø¯Ø§Ø´Ø¯Ù†ÛŒ"},
                {id:11,title:"Was hast du gemacht?",sub:"Ø²Ù…Ø§Ù† Perfekt"},
                {id:12,title:"Was ist passiert?",sub:"Perfekt ÙØ¹Ù„â€ŒÙ‡Ø§ÛŒ Ø¨ÛŒâ€ŒÙ‚Ø§Ø¹Ø¯Ù‡"}
            ].map(l => ({
                ...l,
                explanation:{title:l.sub,blocks:[{heading:"Ù…ÙˆØ¶ÙˆØ¹ Ø¯Ø±Ø³",text:`Ø¯Ø± Ø¯Ø±Ø³ ${l.id} Ø¨Ø§ Ù…ÙˆØ¶ÙˆØ¹ Â«${l.sub}Â» Ø¢Ø´Ù†Ø§ Ù…ÛŒâ€ŒØ´ÙˆÛŒØ¯. Ù…Ø­ØªÙˆØ§ÛŒ Ú©Ø§Ù…Ù„ Ø¨Ù‡ Ø²ÙˆØ¯ÛŒ Ø§Ø¶Ø§ÙÙ‡ Ø®ÙˆØ§Ù‡Ø¯ Ø´Ø¯.`}]},
                grammar:{title:"Ú¯Ø±Ø§Ù…Ø± Ø¯Ø±Ø³ "+l.id,blocks:[{heading:"Ù‚ÙˆØ§Ø¹Ø¯ Ø¯Ø³ØªÙˆØ±ÛŒ",text:"Ù…Ø­ØªÙˆØ§ÛŒ Ú¯Ø±Ø§Ù…Ø± Ø¨Ù‡ Ø²ÙˆØ¯ÛŒ ØªÚ©Ù…ÛŒÙ„ Ù…ÛŒâ€ŒØ´ÙˆØ¯."}]},
                vocabulary:[{word:"Beispiel",article:"das",plural:"die Beispiele",trans:"Ù…Ø«Ø§Ù„",ex:"Das ist ein Beispiel.",exFa:"Ø§ÛŒÙ† ÛŒÚ© Ù…Ø«Ø§Ù„ Ø§Ø³Øª."}],
                exercises:[{type:"mc",q:"ØªÙ…Ø±ÛŒÙ† Ù†Ù…ÙˆÙ†Ù‡",opts:["Ú¯Ø²ÛŒÙ†Ù‡ Û±","Ú¯Ø²ÛŒÙ†Ù‡ Û²","Ú¯Ø²ÛŒÙ†Ù‡ Û³","Ú¯Ø²ÛŒÙ†Ù‡ Û´"],ans:0}]
            }))
        ]
    },
    // Other levels
    ...Object.fromEntries(
        [["a1-2","A1.2","Menschen A1.2","ğŸŒ¿","Ù…Ø¨ØªØ¯ÛŒ - Ø¨Ø®Ø´ Ø¯ÙˆÙ…","#64d2ff"],
         ["a2-1","A2.1","Menschen A2.1","ğŸŒ³","Ù¾Ø§ÛŒÙ‡ - Ø¨Ø®Ø´ Ø§ÙˆÙ„","#0a84ff"],
         ["a2-2","A2.2","Menschen A2.2","ğŸŒ²","Ù¾Ø§ÛŒÙ‡ - Ø¨Ø®Ø´ Ø¯ÙˆÙ…","#bf5af2"],
         ["b1-1","B1.1","Menschen B1.1","ğŸ”ï¸","Ù…ØªÙˆØ³Ø· - Ø¨Ø®Ø´ Ø§ÙˆÙ„","#ff9f0a"],
         ["b1-2","B1.2","Menschen B1.2","â›°ï¸","Ù…ØªÙˆØ³Ø· - Ø¨Ø®Ø´ Ø¯ÙˆÙ…","#ff375f"],
         ["b2-1","B2.1","Menschen B2.1","ğŸ†","Ù¾ÛŒØ´Ø±ÙØªÙ‡ - Ø¨Ø®Ø´ Ø§ÙˆÙ„","#ff453a"],
         ["b2-2","B2.2","Menschen B2.2","ğŸ‘‘","Ù¾ÛŒØ´Ø±ÙØªÙ‡ - Ø¨Ø®Ø´ Ø¯ÙˆÙ…","#ffd60a"]
        ].map(([k,n,f,i,d,c]) => [k, {
            name:n, full:f, icon:i, desc:d, color:c,
            lessons: Array.from({length:12},(_,idx)=>({
                id:idx+1, title:`Lektion ${idx+1}`, sub:`Ø¯Ø±Ø³ ${idx+1} - ${n}`,
                explanation:{title:`Ø¯Ø±Ø³ ${idx+1}`,blocks:[{heading:"Ù…ÙˆØ¶ÙˆØ¹",text:"Ù…Ø­ØªÙˆØ§ÛŒ Ø§ÛŒÙ† Ø¯Ø±Ø³ Ø¨Ù‡ Ø²ÙˆØ¯ÛŒ Ø§Ø¶Ø§ÙÙ‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯."}]},
                grammar:{title:"Ú¯Ø±Ø§Ù…Ø±",blocks:[{heading:"Ù‚ÙˆØ§Ø¹Ø¯",text:"Ù…Ø­ØªÙˆØ§ÛŒ Ú¯Ø±Ø§Ù…Ø± Ø¨Ù‡ Ø²ÙˆØ¯ÛŒ Ø§Ø¶Ø§ÙÙ‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯."}]},
                vocabulary:[{word:"Wort",article:"das",plural:"die WÃ¶rter",trans:"Ú©Ù„Ù…Ù‡",ex:"Das ist ein Wort.",exFa:"Ø§ÛŒÙ† ÛŒÚ© Ú©Ù„Ù…Ù‡ Ø§Ø³Øª."}],
                exercises:[{type:"mc",q:"ØªÙ…Ø±ÛŒÙ† Ù†Ù…ÙˆÙ†Ù‡",opts:["Ø§Ù„Ù","Ø¨","Ø¬","Ø¯"],ans:0}]
            }))
        }])
    )
    };

    // ============================================
    // APP STATE
    // ============================================
    let state = {
        page: 'home',
        level: null,
        lesson: null,
        section: null,
        navStack: [], // â† Ù…Ù‡Ù…: Ø§Ø³ØªÚ© Ù†Ø§ÙˆØ¨Ø±ÛŒ Ø¨Ø±Ø§ÛŒ Ø¯Ú©Ù…Ù‡ Ø¨Ø§Ø²Ú¯Ø´Øª
        user: null,
        settings: { dark:true, sound:true, auto:false, rate:1, font:'medium', notif:true },
        progress: {},
        xp: 0, streak: 0, correct: 0, words: 0
    };

    function load() {
        try {
            const s = JSON.parse(localStorage.getItem('ga_state'));
            if(s) { state = {...state,...s}; applyTheme(); }
        } catch(e){}
    }

    function save() {
        try {
            localStorage.setItem('ga_state', JSON.stringify({
                settings:state.settings, progress:state.progress,
                xp:state.xp, streak:state.streak, correct:state.correct, words:state.words
            }));
            // Ø°Ø®ÛŒØ±Ù‡ Ø¯Ø± ÙØ§ÛŒØ±Ø¨ÛŒØ³ Ø§Ú¯Ø± ÙˆØ§Ø±Ø¯ Ø´Ø¯Ù‡
            if(state.user && firebaseReady) {
                db.collection('users').doc(state.user.uid).set({
                    progress:state.progress, xp:state.xp, streak:state.streak,
                    correct:state.correct, words:state.words,
                    displayName: state.user.displayName,
                    photoURL: state.user.photoURL
                }, {merge:true}).catch(e => console.warn('Ø®Ø·Ø§ Ø¯Ø± Ø°Ø®ÛŒØ±Ù‡ ÙØ§ÛŒØ±Ø¨ÛŒØ³:', e));
            }
        } catch(e){}
    }

    function applyTheme() {
        document.body.setAttribute('data-theme', state.settings.dark ? 'dark' : 'light');
        const t = document.getElementById('togDark');
        if(t) t.classList.toggle('on', state.settings.dark);
        const sizes = {small:'14px',medium:'16px',large:'18px'};
        document.documentElement.style.fontSize = sizes[state.settings.font]||'16px';
    }

    // ============================================
    // NAVIGATION - Ø§ØµÙ„Ø§Ø­ Ø´Ø¯Ù‡ Ø¨Ø¯ÙˆÙ† Ø®Ø±ÙˆØ¬ Ø§Ø² Ø¨Ø±Ù†Ø§Ù…Ù‡
    // ============================================
    function navTo(page) {
        // Ø°Ø®ÛŒØ±Ù‡ ÙˆØ¶Ø¹ÛŒØª Ù‚Ø¨Ù„ÛŒ ÙÙ‚Ø· Ø§Ú¯Ø± Ø§Ø² ØµÙØ­Ø§Øª Ø§ØµÙ„ÛŒ Ù†Ø¨Ø§Ø´Ø¯
        state.navStack = [];
        state.level = null;
        state.lesson = null;
        state.section = null;

        showPage(page);

        // Ø¢Ù¾Ø¯ÛŒØª Ù…Ù†ÙˆÛŒ Ù¾Ø§ÛŒÛŒÙ†
        document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
        const nav = document.querySelector(`.nav-item[data-nav="${page}"]`);
        if(nav) nav.classList.add('active');

        // Ù‡Ø¯Ø±
        const back = document.getElementById('backBtn');
        back.classList.add('hidden');

        const titles = {home:'German App',scores:'Ø§Ù…ØªÛŒØ§Ø²Ø§Øª',online:'Ù¾Ø±ÙˆÙØ§ÛŒÙ„',settings:'ØªÙ†Ø¸ÛŒÙ…Ø§Øª'};
        document.getElementById('headerTitle').textContent = titles[page]||'German App';

        state.page = page;
        if(page==='scores') renderLeaderboard();
    }

    function showPage(pageId) {
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        const el = document.getElementById('page-'+pageId);
        if(el) el.classList.add('active');
    }

    // ===== Ø¯Ú©Ù…Ù‡ Ø¨Ø§Ø²Ú¯Ø´Øª Ø§ØµÙ„Ø§Ø­ Ø´Ø¯Ù‡ =====
    function goBack() {
        if(state.navStack.length > 0) {
            const prev = state.navStack.pop();
            if(prev.type === 'section') {
                // Ø¨Ø§Ø²Ú¯Ø´Øª Ø§Ø² Ù…Ø­ØªÙˆØ§ÛŒ Ø¨Ø®Ø´ Ø¨Ù‡ ØµÙØ­Ù‡ Ø¬Ø²Ø¦ÛŒØ§Øª Ø¯Ø±Ø³
                openLessonDetail(prev.level, prev.lesson);
            } else if(prev.type === 'detail') {
                // Ø¨Ø§Ø²Ú¯Ø´Øª Ø§Ø² Ø¬Ø²Ø¦ÛŒØ§Øª Ø¯Ø±Ø³ Ø¨Ù‡ Ù„ÛŒØ³Øª Ø¯Ø±ÙˆØ³
                openLessons(prev.level);
            } else if(prev.type === 'lessons') {
                // Ø¨Ø§Ø²Ú¯Ø´Øª Ø§Ø² Ù„ÛŒØ³Øª Ø¯Ø±ÙˆØ³ Ø¨Ù‡ Ø®Ø§Ù†Ù‡
                navTo('home');
            }
        } else {
            navTo('home');
        }
    }

    function showBackBtn() {
        document.getElementById('backBtn').classList.remove('hidden');
    }

    // ============================================
    // HOME - Ø³Ø·ÙˆØ­
    // ============================================
    function renderLevels() {
        const grid = document.getElementById('levelGrid');
        grid.innerHTML = '';
        const cls = {'a1-1':'level-a11','a1-2':'level-a12','a2-1':'level-a21','a2-2':'level-a22',
                     'b1-1':'level-b11','b1-2':'level-b12','b2-1':'level-b21','b2-2':'level-b22'};
        Object.entries(DATA).forEach(([k,v]) => {
            const prog = calcProg(k);
            const card = document.createElement('div');
            card.className = `level-card glass glass-interactive ${cls[k]||''}`;
            card.onclick = () => openLessons(k);
            card.innerHTML = `
                <div class="level-icon">${v.icon}</div>
                <div class="level-name">${v.name}</div>
                <div class="level-desc">${v.desc}</div>
                <div class="level-progress"><div class="level-progress-bar" style="width:${prog}%"></div></div>
            `;
            grid.appendChild(card);
        });
    }

    function calcProg(lk) {
        const pr = state.progress[lk]||{};
        const total = DATA[lk].lessons.length * 4;
        let done = 0;
        Object.values(pr).forEach(l => {
            done += (l.exp?1:0)+(l.gram?1:0)+(l.voc?1:0)+(l.ex?1:0);
        });
        return total>0 ? Math.round(done/total*100) : 0;
    }

    // ============================================
    // LESSONS LIST
    // ============================================
    function openLessons(lk) {
        state.level = lk;
        state.navStack.push({type:'lessons', level:lk});

        const lv = DATA[lk];
        showPage('lessons');
        showBackBtn();
        document.getElementById('headerTitle').textContent = lv.full;

        const prog = calcProg(lk);
        document.getElementById('lessonsTitle').innerHTML = `${lv.icon} ${lv.full}`;
        document.getElementById('lessonsProg').style.width = prog+'%';
        document.getElementById('lessonsProgText').textContent = `${prog}Ùª ØªÚ©Ù…ÛŒÙ„ Ø´Ø¯Ù‡`;

        const list = document.getElementById('lessonList');
        list.innerHTML = '';
        const colors = ['#30d158','#0a84ff','#bf5af2','#ff9f0a','#ff375f','#64d2ff',
                        '#ff453a','#ffd60a','#5e5ce6','#30d158','#0a84ff','#bf5af2'];
        lv.lessons.forEach((ls,i) => {
            const lp = state.progress[lk]?.[ls.id]||{};
            const d = (lp.exp?1:0)+(lp.gram?1:0)+(lp.voc?1:0)+(lp.ex?1:0);
            const item = document.createElement('div');
            item.className = 'lesson-item glass glass-interactive';
            item.onclick = () => openLessonDetail(lk, ls.id);
            item.innerHTML = `
                <div class="lesson-num" style="background:${colors[i%12]}">${ls.id}</div>
                <div class="lesson-info">
                    <div class="lesson-title-text">${ls.title}</div>
                    <div class="lesson-sub-text">${ls.sub} â€¢ ${d}/4</div>
                </div>
                <div class="lesson-status">${d===4?'âœ…':d>0?'ğŸ”„':'ğŸ“˜'}</div>
            `;
            list.appendChild(item);
        });
    }

    // ============================================
    // LESSON DETAIL
    // ============================================
    function openLessonDetail(lk, lid) {
        state.level = lk;
        state.lesson = lid;
        // Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ø¢Ø®Ø±ÛŒÙ† Ø¢ÛŒØªÙ… Ø§Ú¯Ø± section Ø¨ÙˆØ¯Ù‡
        if(state.navStack.length && state.navStack[state.navStack.length-1].type==='section') {
            state.navStack.pop();
        }
        if(!state.navStack.length || state.navStack[state.navStack.length-1].type!=='detail') {
            state.navStack.push({type:'detail', level:lk, lesson:lid});
        }

        const lv = DATA[lk];
        const ls = lv.lessons.find(l=>l.id===lid);
        showPage('detail');
        showBackBtn();
        document.getElementById('headerTitle').textContent = `${lv.name} - Ø¯Ø±Ø³ ${lid}`;
        document.getElementById('detailTitle').textContent = ls.title;
        document.getElementById('detailSub').textContent = ls.sub;

        const lp = state.progress[lk]?.[lid]||{};
        const grid = document.getElementById('sectionGrid');
        grid.innerHTML = [
            {key:'exp',icon:'ğŸ“–',name:'ØªÙˆØ¶ÛŒØ­ Ø¯Ø±Ø³',sub:'Ù…Ø·Ø§Ù„Ø¹Ù‡ Ú©Ù†ÛŒØ¯'},
            {key:'gram',icon:'ğŸ“',name:'Ú¯Ø±Ø§Ù…Ø±',sub:'Ù‚ÙˆØ§Ø¹Ø¯ Ø¯Ø³ØªÙˆØ±ÛŒ'},
            {key:'voc',icon:'ğŸ—£ï¸',name:'ÙˆØ§Ú˜Ù‡â€ŒÙ‡Ø§',sub:'Ù„ØºØ§Øª Ø¬Ø¯ÛŒØ¯'},
            {key:'ex',icon:'âœï¸',name:'ØªÙ…Ø±ÛŒÙ†',sub:'Ø¢Ø²Ù…ÙˆÙ† Ø¯Ø§Ù†Ø´'}
        ].map(s => `
            <div class="section-btn glass glass-interactive" onclick="openSection('${s.key}')">
                <div class="s-icon">${s.icon}</div>
                <div class="s-name">${s.name}</div>
                <div class="s-sub">${s.sub}</div>
                ${lp[s.key] ? '<div class="s-done">âœ… Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ø´Ø¯Ù‡</div>' : ''}
            </div>
        `).join('');
    }

    // ============================================
    // SECTION CONTENT
    // ============================================
    function openSection(sec) {
        state.section = sec;
        state.navStack.push({type:'section', level:state.level, lesson:state.lesson, section:sec});

        showPage('section');
        showBackBtn();

        // ØªØ¨â€ŒÙ‡Ø§
        const tabs = document.getElementById('sectionTabs');
        const allSecs = [{k:'exp',l:'ğŸ“– ØªÙˆØ¶ÛŒØ­'},{k:'gram',l:'ğŸ“ Ú¯Ø±Ø§Ù…Ø±'},{k:'voc',l:'ğŸ—£ï¸ ÙˆØ§Ú˜Ù‡â€ŒÙ‡Ø§'},{k:'ex',l:'âœï¸ ØªÙ…Ø±ÛŒÙ†'}];
        tabs.innerHTML = allSecs.map(s =>
            `<div class="tab-btn ${s.k===sec?'active':''}" onclick="switchTab('${s.k}')">${s.l}</div>`
        ).join('');

        renderSection(sec);
        markDone(sec);
    }

    function switchTab(sec) {
        state.section = sec;
        document.querySelectorAll('.tab-btn').forEach(t => t.classList.remove('active'));
        event.target.classList.add('active');
        renderSection(sec);
        markDone(sec);
    }

    function markDone(sec) {
        if(!state.progress[state.level]) state.progress[state.level]={};
        if(!state.progress[state.level][state.lesson]) state.progress[state.level][state.lesson]={};
        state.progress[state.level][state.lesson][sec] = true;
        save();
        updateStats();
    }

    function renderSection(sec) {
        const ls = DATA[state.level].lessons.find(l=>l.id===state.lesson);
        const body = document.getElementById('sectionBody');
        if(sec==='exp') body.innerHTML = buildExplanation(ls.explanation);
        else if(sec==='gram') body.innerHTML = buildGrammar(ls.grammar);
        else if(sec==='voc') body.innerHTML = buildVocab(ls.vocabulary);
        else if(sec==='ex') body.innerHTML = buildExercises(ls.exercises);
    }

    // ===== Ø³Ø§Ø®Øª Ù…Ø­ØªÙˆØ§ÛŒ ØªÙˆØ¶ÛŒØ­ =====
    function buildExplanation(d) {
        return `<h2 class="sec-title">ğŸ“– ${d.title}</h2>` +
            d.blocks.map(b => {
                let h = `<div class="exp-block glass"><h3>${b.heading}</h3>`;
                if(b.text) h += `<p>${b.text}</p>`;
                if(b.dialog) {
                    h += `<div class="dialog-box">${
                        b.dialog.map(l => `<div class="dialog-line"><span class="d-speaker">${l.speaker}:</span><span>${l.text}</span></div>`).join('')
                    }</div>`;
                }
                return h + `</div>`;
            }).join('');
    }

    // ===== Ø³Ø§Ø®Øª Ù…Ø­ØªÙˆØ§ÛŒ Ú¯Ø±Ø§Ù…Ø± =====
    function buildGrammar(d) {
        return `<h2 class="sec-title">ğŸ“ ${d.title}</h2>` +
            d.blocks.map(b => {
                let h = `<div class="g-block glass"><h3>${b.heading}</h3>`;
                if(b.text) h += `<p>${b.text}</p>`;
                if(b.table) {
                    h += `<table class="g-table"><thead><tr>${b.table.headers.map(x=>`<th>${x}</th>`).join('')}</tr></thead>
                    <tbody>${b.table.rows.map(r=>`<tr>${r.map(c=>`<td>${c}</td>`).join('')}</tr>`).join('')}</tbody></table>`;
                }
                if(b.examples) {
                    b.examples.forEach(e => {
                        h += `<div class="g-example"><div class="g-de">${e.de}</div><div class="g-fa">${e.fa}</div></div>`;
                    });
                }
                return h + `</div>`;
            }).join('');
    }

    // ===== Ø³Ø§Ø®Øª ÙˆØ§Ú˜Ù‡â€ŒÙ‡Ø§ Ø¨Ø§ ØµØ¯Ø§ =====
    function buildVocab(words) {
        state.words = Math.max(state.words, words.length);
        save();
        return `<h2 class="sec-title">ğŸ—£ï¸ ÙˆØ§Ú˜Ù‡â€ŒÙ‡Ø§ (${words.length} Ú©Ù„Ù…Ù‡)</h2>
        <div class="vocab-list">${words.map((w,i) => `
            <div class="v-card glass">
                <div class="v-top">
                    <div class="v-word-group">
                        ${w.article ? `<span class="v-article">${w.article}</span>` : ''}
                        <span class="v-word">${w.word}</span>
                        ${w.plural ? `<span class="v-plural">| ${w.plural}</span>` : ''}
                    </div>
                    <button class="v-speak" onclick="speak('${(w.article?w.article+' ':'') + w.word}', this)" title="ØªÙ„ÙØ¸ Ø¢Ù„Ù…Ø§Ù†ÛŒ">ğŸ”Š</button>
                </div>
                <div class="v-trans">${w.trans}</div>
                <div class="v-example">
                    <div class="ex-de">${w.ex}</div>
                    <div class="ex-fa">${w.exFa}</div>
                </div>
            </div>
        `).join('')}</div>`;
    }

    // ===== Ø³Ø§Ø®Øª ØªÙ…Ø±ÛŒÙ†â€ŒÙ‡Ø§ =====
    function buildExercises(exs) {
        return `<h2 class="sec-title">âœï¸ ØªÙ…Ø±ÛŒÙ†â€ŒÙ‡Ø§ (${exs.length} Ø³Ø¤Ø§Ù„)</h2>
        <div class="ex-container">${exs.map((e,i) => {
            if(e.type==='mc') {
                const letters = ['Ø§Ù„Ù','Ø¨','Ø¬','Ø¯'];
                return `<div class="ex-card glass" id="ex${i}">
                    <div class="ex-type">Ú†Ù†Ø¯ Ú¯Ø²ÛŒÙ†Ù‡â€ŒØ§ÛŒ</div>
                    <div class="ex-question">${i+1}. ${e.q}</div>
                    <div class="ex-options">${e.opts.map((o,j) =>
                        `<div class="ex-opt" onclick="checkMC(${i},${j},${e.ans})" id="opt${i}_${j}">
                            <span class="opt-letter">${letters[j]}</span><span>${o}</span>
                        </div>`
                    ).join('')}</div>
                    <div class="feedback" id="fb${i}"></div>
                </div>`;
            } else {
                return `<div class="ex-card glass" id="ex${i}">
                    <div class="ex-type">Ø¬Ø§ÛŒ Ø®Ø§Ù„ÛŒ</div>
                    <div class="ex-question">${i+1}. ${e.q}</div>
                    <input class="fill-input" id="fi${i}" placeholder="Ù¾Ø§Ø³Ø®..." dir="ltr" autocomplete="off">
                    <button class="check-answer-btn" onclick="checkFill(${i},'${e.a}')">Ø¨Ø±Ø±Ø³ÛŒ Ù¾Ø§Ø³Ø® âœ“</button>
                    <div class="feedback" id="fb${i}"></div>
                </div>`;
            }
        }).join('')}</div>`;
    }

    function checkMC(ei, sel, ans) {
        const opts = document.querySelectorAll(`#ex${ei} .ex-opt`);
        const fb = document.getElementById(`fb${ei}`);
        opts.forEach((o,j) => { o.classList.add('disabled'); o.classList.remove('correct','wrong'); });
        if(sel===ans) {
            opts[sel].classList.add('correct');
            fb.className='feedback ok'; fb.textContent='âœ… Ø¢ÙØ±ÛŒÙ†! Ù¾Ø§Ø³Ø® Ø¯Ø±Ø³Øª Ø§Ø³Øª.';
            state.xp+=10; state.correct++;
        } else {
            opts[sel].classList.add('wrong');
            opts[ans].classList.add('correct');
            fb.className='feedback no'; fb.textContent=`âŒ Ù†Ø§Ø¯Ø±Ø³Øª. Ù¾Ø§Ø³Ø® ØµØ­ÛŒØ­: ${opts[ans].querySelector('span:last-child').textContent}`;
        }
        save(); updateStats();
    }

    function checkFill(ei, ans) {
        const inp = document.getElementById(`fi${ei}`);
        const fb = document.getElementById(`fb${ei}`);
        const val = inp.value.trim().toLowerCase();
        if(val===ans.toLowerCase()) {
            fb.className='feedback ok'; fb.textContent='âœ… Ø¢ÙØ±ÛŒÙ†! Ù¾Ø§Ø³Ø® Ø¯Ø±Ø³Øª Ø§Ø³Øª.';
            inp.style.borderColor='var(--accent-green)';
            state.xp+=15; state.correct++;
        } else {
            fb.className='feedback no'; fb.textContent=`âŒ Ù†Ø§Ø¯Ø±Ø³Øª. Ù¾Ø§Ø³Ø® ØµØ­ÛŒØ­: ${ans}`;
            inp.style.borderColor='var(--accent-red)';
        }
        save(); updateStats();
    }

    // ============================================
    // TEXT TO SPEECH - Ø§ØµÙ„Ø§Ø­ Ø´Ø¯Ù‡
    // ============================================
    let voices = [];

    function loadVoices() {
        voices = speechSynthesis.getVoices();
    }

    if('speechSynthesis' in window) {
        speechSynthesis.onvoiceschanged = loadVoices;
        loadVoices();
    }

    function speak(text, btn) {
        if(!state.settings.sound) {
            toast('ğŸ”‡ ØµØ¯Ø§ ØºÛŒØ±ÙØ¹Ø§Ù„ Ø§Ø³Øª. Ø§Ø² ØªÙ†Ø¸ÛŒÙ…Ø§Øª ÙØ¹Ø§Ù„ Ú©Ù†ÛŒØ¯.');
            return;
        }

        if(!('speechSynthesis' in window)) {
            toast('âš ï¸ Ù…Ø±ÙˆØ±Ú¯Ø± Ø´Ù…Ø§ Ù‚Ø§Ø¨Ù„ÛŒØª ØªÙ„ÙØ¸ ØµÙˆØªÛŒ Ù†Ø¯Ø§Ø±Ø¯. Ù„Ø·ÙØ§Ù‹ Ø§Ø² Chrome Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯.');
            return;
        }

        // Ù„ØºÙˆ ØµØ¯Ø§Ù‡Ø§ÛŒ Ù‚Ø¨Ù„ÛŒ
        speechSynthesis.cancel();

        const utter = new SpeechSynthesisUtterance(text);
        utter.lang = 'de-DE';
        utter.rate = state.settings.rate;
        utter.pitch = 1;
        utter.volume = 1;

        // Ù¾ÛŒØ¯Ø§ Ú©Ø±Ø¯Ù† ØµØ¯Ø§ÛŒ Ø¢Ù„Ù…Ø§Ù†ÛŒ
        if(voices.length === 0) voices = speechSynthesis.getVoices();

        const deVoice = voices.find(v => v.lang === 'de-DE') ||
                        voices.find(v => v.lang.startsWith('de')) ||
                        voices.find(v => v.name.toLowerCase().includes('german'));

        if(deVoice) {
            utter.voice = deVoice;
        }

        if(btn) {
            btn.classList.add('playing');
            utter.onend = () => btn.classList.remove('playing');
            utter.onerror = (e) => {
                btn.classList.remove('playing');
                console.warn('Ø®Ø·Ø§ÛŒ ØªÙ„ÙØ¸:', e);
            };
        }

        // Ú©Ù…ÛŒ ØªØ£Ø®ÛŒØ± Ø¨Ø±Ø§ÛŒ Ø§Ø·Ù…ÛŒÙ†Ø§Ù†
        setTimeout(() => {
            speechSynthesis.speak(utter);
        }, 50);
    }

    // ============================================
    // STATS UPDATE
    // ============================================
    function updateStats() {
        let done = 0;
        Object.values(state.progress).forEach(lv => {
            Object.values(lv).forEach(ls => {
                if(ls.exp && ls.gram && ls.voc && ls.ex) done++;
            });
        });

        document.getElementById('statStreak').textContent = state.streak;
        document.getElementById('statXP').textContent = state.xp;
        document.getElementById('statDone').textContent = done;
        document.getElementById('scXP').textContent = state.xp;
        document.getElementById('scCorrect').textContent = state.correct;
        document.getElementById('scWords').textContent = state.words;

        // Ù¾Ø±ÙˆÙØ§ÛŒÙ„
        if(state.user) {
            document.getElementById('profXP').textContent = state.xp;
            document.getElementById('profLessons').textContent = done;
            document.getElementById('profWords').textContent = state.words;
            document.getElementById('profCorrect').textContent = state.correct;
            document.getElementById('profStreak').textContent = state.streak;

            const totalProg = Object.keys(DATA).reduce((s,k) => s + calcProg(k), 0) / Object.keys(DATA).length;
            document.getElementById('profProgress').textContent = Math.round(totalProg) + '%';
        }
    }

    // ============================================
    // LEADERBOARD
    // ============================================
    function renderLeaderboard() {
        const leaders = [
            {name: state.user?.displayName || 'Ø´Ù…Ø§', avatar: state.user?.photoURL || null, emoji:'ğŸ‘¤', level:'A1.1', score:state.xp, isMe:true},
            {name:'Sara M.',avatar:null,emoji:'ğŸ‘©',level:'B1.2',score:4520},
            {name:'Ali R.',avatar:null,emoji:'ğŸ‘¨',level:'A2.2',score:3280},
            {name:'Mina K.',avatar:null,emoji:'ğŸ‘©â€ğŸ¦±',level:'B2.1',score:2940},
            {name:'Reza T.',avatar:null,emoji:'ğŸ§‘',level:'A1.2',score:1850},
            {name:'Negar P.',avatar:null,emoji:'ğŸ‘©â€ğŸ”¬',level:'A2.1',score:1420}
        ].sort((a,b) => b.score - a.score);

        const myRank = leaders.findIndex(l=>l.isMe) + 1;
        document.getElementById('scRank').textContent = '#' + myRank;

        document.getElementById('leaderboard').innerHTML = leaders.map((l,i) => {
            const rc = i<3 ? `r${i+1}` : '';
            const avatarHTML = l.avatar
                ? `<img src="${l.avatar}" alt="">`
                : l.emoji;
            return `<div class="lb-item glass ${l.isMe?'':''}">
                <div class="lb-rank ${rc}">${i+1}</div>
                <div class="lb-avatar">${avatarHTML}</div>
                <div class="lb-info">
                    <div class="lb-name">${l.name} ${l.isMe?'(Ø´Ù…Ø§)':''}</div>
                    <div class="lb-level">${l.level}</div>
                </div>
                <div class="lb-score">${l.score} XP</div>
            </div>`;
        }).join('');
    }

    // ============================================
    // GOOGLE AUTH - ÙˆØ§Ù‚Ø¹ÛŒ Ø¨Ø§ Firebase
    // ============================================
    function showLoading() { document.getElementById('loadingOverlay').style.display = 'flex'; }
    function hideLoading() { document.getElementById('loadingOverlay').style.display = 'none'; }

    async function googleSignIn() {
        if(!firebaseReady) {
            toast('âš ï¸ ÙØ§ÛŒØ±Ø¨ÛŒØ³ Ù‡Ù†ÙˆØ² Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Ù†Ø´Ø¯Ù‡. Ù„Ø·ÙØ§Ù‹ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Firebase Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.');
            return;
        }

        showLoading();

        try {
            const result = await auth.signInWithPopup(googleProvider);
            const user = result.user;

            state.user = {
                uid: user.uid,
                displayName: user.displayName,
                email: user.email,
                photoURL: user.photoURL
            };

            // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù¾ÛŒØ´Ø±ÙØª Ø§Ø² ÙØ§ÛŒØ±Ø¨ÛŒØ³
            try {
                const doc = await db.collection('users').doc(user.uid).get();
                if(doc.exists) {
                    const d = doc.data();
                    if(d.progress) state.progress = d.progress;
                    if(d.xp) state.xp = d.xp;
                    if(d.streak) state.streak = d.streak;
                    if(d.correct) state.correct = d.correct;
                    if(d.words) state.words = d.words;
                }
            } catch(e) { console.warn('Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø¯Ø§Ø¯Ù‡:', e); }

            save();
            updateProfileUI();
            updateStats();
            renderLevels();
            toast('âœ… ÙˆØ±ÙˆØ¯ Ù…ÙˆÙÙ‚ÛŒØªâ€ŒØ¢Ù…ÛŒØ²! Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒØ¯ ' + user.displayName);
        } catch(error) {
            console.error('Ø®Ø·Ø§ÛŒ ÙˆØ±ÙˆØ¯:', error);
            if(error.code === 'auth/popup-closed-by-user') {
                toast('ÙˆØ±ÙˆØ¯ Ù„ØºÙˆ Ø´Ø¯');
            } else if(error.code === 'auth/unauthorized-domain') {
                toast('âš ï¸ Ø§ÛŒÙ† Ø¯Ø§Ù…Ù†Ù‡ Ø¯Ø± Firebase Ù…Ø¬Ø§Ø² Ù†ÛŒØ³Øª. Ø¯Ø§Ù…Ù†Ù‡ Ø±Ø§ Ø¯Ø± Firebase Console Ø§Ø¶Ø§ÙÙ‡ Ú©Ù†ÛŒØ¯.');
            } else {
                toast('âŒ Ø®Ø·Ø§ Ø¯Ø± ÙˆØ±ÙˆØ¯: ' + error.message);
            }
        }

        hideLoading();
    }

    async function googleSignOut() {
        if(firebaseReady) {
            try { await auth.signOut(); } catch(e){}
        }
        state.user = null;
        save();
        updateProfileUI();
        toast('Ø§Ø² Ø­Ø³Ø§Ø¨ Ø®Ø§Ø±Ø¬ Ø´Ø¯ÛŒØ¯');
    }

    function updateProfileUI() {
        const loggedOut = document.getElementById('viewLoggedOut');
        const loggedIn = document.getElementById('viewLoggedIn');
        const welcomeUser = document.getElementById('welcomeUser');

        if(state.user) {
            loggedOut.style.display = 'none';
            loggedIn.style.display = 'block';
            welcomeUser.style.display = 'flex';

            document.getElementById('profName').textContent = state.user.displayName || 'Ú©Ø§Ø±Ø¨Ø±';
            document.getElementById('profEmail').textContent = state.user.email || '';
            document.getElementById('welcomeName').textContent = state.user.displayName || 'Ú©Ø§Ø±Ø¨Ø±';

            // Ø¢ÙˆØ§ØªØ§Ø±
            const profAv = document.getElementById('profAvatarContent');
            const welcomeAv = document.getElementById('welcomeAvatar');

            if(state.user.photoURL) {
                profAv.innerHTML = `<img src="${state.user.photoURL}" alt="">`;
                welcomeAv.innerHTML = `<img src="${state.user.photoURL}" alt="">`;
            } else {
                profAv.textContent = 'ğŸ‘¤';
                welcomeAv.textContent = 'ğŸ‘¤';
            }
        } else {
            loggedOut.style.display = 'block';
            loggedIn.style.display = 'none';
            welcomeUser.style.display = 'none';
        }
    }

    // Ø¨Ø±Ø±Ø³ÛŒ ÙˆØ¶Ø¹ÛŒØª ÙˆØ±ÙˆØ¯ Ù‡Ù†Ú¯Ø§Ù… Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ
    if(firebaseReady) {
        auth.onAuthStateChanged(user => {
            if(user) {
                state.user = {
                    uid: user.uid,
                    displayName: user.displayName,
                    email: user.email,
                    photoURL: user.photoURL
                };
                updateProfileUI();
                updateStats();
                // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø¯Ø§Ø¯Ù‡ Ø§Ø² ÙØ§ÛŒØ±Ø¨ÛŒØ³
                db.collection('users').doc(user.uid).get().then(doc => {
                    if(doc.exists) {
                        const d = doc.data();
                        if(d.progress) state.progress = d.progress;
                        if(d.xp) state.xp = d.xp;
                        if(d.streak) state.streak = d.streak;
                        if(d.correct) state.correct = d.correct;
                        if(d.words) state.words = d.words;
                        save(); updateStats(); renderLevels();
                    }
                }).catch(e => console.warn(e));
            }
        });
    }

    // ============================================
    // SETTINGS
    // ============================================
    function toggleDarkMode() {
        state.settings.dark = !state.settings.dark;
        applyTheme();
        save();
        toast(state.settings.dark ? 'ğŸŒ™ Ø­Ø§Ù„Øª ØªØ§Ø±ÛŒÚ© ÙØ¹Ø§Ù„ Ø´Ø¯' : 'â˜€ï¸ Ø­Ø§Ù„Øª Ø±ÙˆØ´Ù† ÙØ¹Ø§Ù„ Ø´Ø¯');
    }

    function toggleSnd() {
        state.settings.sound = !state.settings.sound;
        document.getElementById('togSound').classList.toggle('on', state.settings.sound);
        save();
        toast(state.settings.sound ? 'ğŸ”Š ØµØ¯Ø§ ÙØ¹Ø§Ù„ Ø´Ø¯' : 'ğŸ”‡ ØµØ¯Ø§ ØºÛŒØ±ÙØ¹Ø§Ù„ Ø´Ø¯');
    }

    function toggleAuto() {
        state.settings.auto = !state.settings.auto;
        document.getElementById('togAuto').classList.toggle('on', state.settings.auto);
        save();
    }

    function toggleNotif() {
        state.settings.notif = !state.settings.notif;
        document.getElementById('togNotif').classList.toggle('on', state.settings.notif);
        save();
    }

    function cycleFont() {
        const fs = ['small','medium','large'];
        const labels = ['Ú©ÙˆÚ†Ú©','Ù…ØªÙˆØ³Ø·','Ø¨Ø²Ø±Ú¯'];
        const i = (fs.indexOf(state.settings.font)+1)%3;
        state.settings.font = fs[i];
        document.getElementById('valFont').textContent = labels[i]+' â†';
        applyTheme();
        save();
    }

    function cycleRate() {
        const rs = [0.7, 1, 1.3];
        const labels = ['Ø¢Ù‡Ø³ØªÙ‡','Ø¹Ø§Ø¯ÛŒ','Ø³Ø±ÛŒØ¹'];
        const i = (rs.indexOf(state.settings.rate)+1)%3;
        state.settings.rate = rs[i];
        document.getElementById('valRate').textContent = labels[i]+' â†';
        save();
    }

    function resetAll() {
        if(confirm('Ø¢ÛŒØ§ Ù…Ø·Ù…Ø¦Ù†ÛŒØ¯ØŸ ØªÙ…Ø§Ù… Ù¾ÛŒØ´Ø±ÙØª Ø´Ù…Ø§ Ù¾Ø§Ú© Ø®ÙˆØ§Ù‡Ø¯ Ø´Ø¯.')) {
            state.progress={}; state.xp=0; state.streak=0; state.correct=0; state.words=0;
            save(); updateStats(); renderLevels();
            toast('ğŸ—‘ï¸ Ù‡Ù…Ù‡ Ù¾ÛŒØ´Ø±ÙØª Ù¾Ø§Ú© Ø´Ø¯');
        }
    }

    // ============================================
    // TOAST
    // ============================================
    function toast(msg) {
        const t = document.getElementById('toast');
        t.textContent = msg;
        t.classList.add('show');
        clearTimeout(t._timer);
        t._timer = setTimeout(() => t.classList.remove('show'), 3500);
    }

    // ============================================
    // STREAK
    // ============================================
    function checkStreak() {
        const today = new Date().toDateString();
        const last = localStorage.getItem('ga_last_visit');
        if(last !== today) {
            const yesterday = new Date(Date.now()-86400000).toDateString();
            if(last === yesterday) state.streak++;
            else if(!last) state.streak = 1;
            else state.streak = 1;
            localStorage.setItem('ga_last_visit', today);
            save();
        }
    }

    // ============================================
    // INIT
    // ============================================
    function init() {
        load();
        applyTheme();
        renderLevels();
        updateStats();
        updateProfileUI();
        checkStreak();
        renderLeaderboard();

        // ØªÙ†Ø¸ÛŒÙ…Ø§Øª UI
        document.getElementById('togDark').classList.toggle('on', state.settings.dark);
        document.getElementById('togSound').classList.toggle('on', state.settings.sound);
        document.getElementById('togAuto').classList.toggle('on', state.settings.auto);
        document.getElementById('togNotif').classList.toggle('on', state.settings.notif);

        const fontLabels = {small:'Ú©ÙˆÚ†Ú©',medium:'Ù…ØªÙˆØ³Ø·',large:'Ø¨Ø²Ø±Ú¯'};
        document.getElementById('valFont').textContent = (fontLabels[state.settings.font]||'Ù…ØªÙˆØ³Ø·') + ' â†';

        const rateLabels = {0.7:'Ø¢Ù‡Ø³ØªÙ‡',1:'Ø¹Ø§Ø¯ÛŒ',1.3:'Ø³Ø±ÛŒØ¹'};
        document.getElementById('valRate').textContent = (rateLabels[state.settings.rate]||'Ø¹Ø§Ø¯ÛŒ') + ' â†';
    }

    init();
</script>
</body>
</html>