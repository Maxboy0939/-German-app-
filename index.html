<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Menschen A1.1 - Online</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Vazirmatn:wght@300;400;500;600;700;800;900&display=swap');

        :root {
            --bg-primary: #000000;
            --bg-secondary: #0a0a0f;
            --mesh1: radial-gradient(ellipse 600px 400px at 15% 15%, rgba(88,86,214,0.18) 0%, transparent 70%);
            --mesh2: radial-gradient(ellipse 500px 500px at 85% 75%, rgba(175,82,222,0.14) 0%, transparent 70%);
            --mesh3: radial-gradient(ellipse 400px 300px at 50% 40%, rgba(10,132,255,0.1) 0%, transparent 70%);
            --mesh4: radial-gradient(ellipse 350px 350px at 30% 80%, rgba(48,209,88,0.06) 0%, transparent 70%);
            --liquid-bg: rgba(255,255,255,0.08);
            --liquid-bg-heavy: rgba(255,255,255,0.12);
            --liquid-bg-light: rgba(255,255,255,0.05);
            --liquid-border: rgba(255,255,255,0.18);
            --liquid-border-light: rgba(255,255,255,0.1);
            --liquid-inner-shadow: inset 0 1px 1px rgba(255,255,255,0.15);
            --liquid-outer-shadow: 0 8px 40px rgba(0,0,0,0.4), 0 2px 8px rgba(0,0,0,0.3);
            --liquid-outer-shadow-lg: 0 16px 64px rgba(0,0,0,0.5), 0 4px 16px rgba(0,0,0,0.3);
            --liquid-blur: blur(60px) saturate(200%);
            --liquid-blur-sm: blur(40px) saturate(180%);
            --liquid-refraction: linear-gradient(165deg, rgba(255,255,255,0.2) 0%, rgba(255,255,255,0.05) 25%, transparent 50%, rgba(255,255,255,0.03) 75%, rgba(255,255,255,0.1) 100%);
            --liquid-caustic: radial-gradient(ellipse at 30% 20%, rgba(255,255,255,0.12) 0%, transparent 50%);
            --text-primary: #ffffff;
            --text-secondary: rgba(255,255,255,0.6);
            --text-tertiary: rgba(255,255,255,0.35);
            --accent-blue: #0a84ff;
            --accent-purple: #bf5af2;
            --accent-indigo: #5856d6;
            --gold: #ffd60a;
            --green: #30d158;
            --red: #ff453a;
            --orange: #ff9f0a;
            --header-gradient: linear-gradient(145deg, rgba(88,86,214,0.85), rgba(175,82,222,0.75), rgba(10,132,255,0.65));
        }

        .light-mode {
            --bg-primary: #f2f1f6;
            --bg-secondary: #e5e4e9;
            --mesh1: radial-gradient(ellipse 600px 400px at 15% 15%, rgba(88,86,214,0.1) 0%, transparent 70%);
            --mesh2: radial-gradient(ellipse 500px 500px at 85% 75%, rgba(175,82,222,0.08) 0%, transparent 70%);
            --mesh3: radial-gradient(ellipse 400px 300px at 50% 40%, rgba(10,132,255,0.06) 0%, transparent 70%);
            --mesh4: radial-gradient(ellipse 350px 350px at 30% 80%, rgba(48,209,88,0.04) 0%, transparent 70%);
            --liquid-bg: rgba(255,255,255,0.65);
            --liquid-bg-heavy: rgba(255,255,255,0.8);
            --liquid-bg-light: rgba(255,255,255,0.5);
            --liquid-border: rgba(255,255,255,0.85);
            --liquid-border-light: rgba(255,255,255,0.6);
            --liquid-inner-shadow: inset 0 1px 2px rgba(255,255,255,0.9);
            --liquid-outer-shadow: 0 8px 40px rgba(0,0,0,0.08), 0 2px 8px rgba(0,0,0,0.05);
            --liquid-outer-shadow-lg: 0 16px 64px rgba(0,0,0,0.1), 0 4px 16px rgba(0,0,0,0.06);
            --liquid-blur: blur(60px) saturate(180%);
            --liquid-blur-sm: blur(40px) saturate(160%);
            --liquid-refraction: linear-gradient(165deg, rgba(255,255,255,0.7) 0%, rgba(255,255,255,0.3) 25%, transparent 50%, rgba(255,255,255,0.2) 75%, rgba(255,255,255,0.5) 100%);
            --liquid-caustic: radial-gradient(ellipse at 30% 20%, rgba(255,255,255,0.5) 0%, transparent 50%);
            --text-primary: #1c1c1e;
            --text-secondary: rgba(0,0,0,0.5);
            --text-tertiary: rgba(0,0,0,0.25);
            --accent-blue: #007aff;
            --accent-purple: #af52de;
            --accent-indigo: #5856d6;
            --gold: #ff9500;
            --green: #34c759;
            --red: #ff3b30;
            --orange: #ff9500;
            --header-gradient: linear-gradient(145deg, rgba(88,86,214,0.9), rgba(175,82,222,0.8), rgba(10,132,255,0.7));
        }

        * { margin:0; padding:0; box-sizing:border-box; }

        body {
            font-family: 'Vazirmatn', -apple-system, system-ui, sans-serif;
            background: var(--bg-primary);
            min-height: 100vh;
            color: var(--text-primary);
            user-select: none;
            overflow-x: hidden;
            -webkit-tap-highlight-color: transparent;
            -webkit-font-smoothing: antialiased;
            transition: background 0.5s ease;
            padding-bottom: 90px;
        }

        .ambient-bg {
            position:fixed; inset:0;
            background: var(--mesh1), var(--mesh2), var(--mesh3), var(--mesh4);
            z-index:0; pointer-events:none;
        }

        .ambient-orb { position:fixed; border-radius:50%; pointer-events:none; z-index:0; }
        .ambient-orb:nth-child(1) { width:350px;height:350px;background:radial-gradient(circle,rgba(88,86,214,0.2) 0%,transparent 70%);top:-8%;left:-5%;animation:od1 24s ease-in-out infinite;filter:blur(60px); }
        .ambient-orb:nth-child(2) { width:280px;height:280px;background:radial-gradient(circle,rgba(175,82,222,0.15) 0%,transparent 70%);bottom:5%;right:-8%;animation:od2 20s ease-in-out infinite;filter:blur(50px); }
        .ambient-orb:nth-child(3) { width:220px;height:220px;background:radial-gradient(circle,rgba(10,132,255,0.12) 0%,transparent 70%);top:35%;left:40%;animation:od3 28s ease-in-out infinite;filter:blur(70px); }
        .light-mode .ambient-orb { opacity:0.5; }
        @keyframes od1 { 0%,100%{transform:translate(0,0) scale(1);}50%{transform:translate(-20px,40px) scale(0.95);} }
        @keyframes od2 { 0%,100%{transform:translate(0,0);}50%{transform:translate(25px,-35px);} }
        @keyframes od3 { 0%,100%{transform:translate(0,0);}50%{transform:translate(-30px,-20px);} }

        .app-container { max-width:480px; margin:0 auto; padding:8px; min-height:100vh; position:relative; z-index:1; }

        /* ===== Liquid Glass ===== */
        .liquid-glass {
            background:var(--liquid-bg); backdrop-filter:var(--liquid-blur); -webkit-backdrop-filter:var(--liquid-blur);
            border:1px solid var(--liquid-border); border-radius:22px;
            box-shadow:var(--liquid-outer-shadow),var(--liquid-inner-shadow);
            position:relative; overflow:hidden;
            transition:all 0.4s cubic-bezier(0.34,1.56,0.64,1);
        }
        .liquid-glass::before { content:''; position:absolute; inset:0; background:var(--liquid-refraction); border-radius:inherit; pointer-events:none; z-index:1; }
        .liquid-glass::after { content:''; position:absolute; top:-20%;left:-10%;width:80%;height:60%; background:var(--liquid-caustic); border-radius:inherit; pointer-events:none; z-index:2; animation:cm 10s ease-in-out infinite; }
        @keyframes cm { 0%,100%{transform:translate(0,0);opacity:0.6;}50%{transform:translate(10px,5px);opacity:0.8;} }

        .liquid-glass-lg {
            background:var(--liquid-bg-heavy); backdrop-filter:var(--liquid-blur); -webkit-backdrop-filter:var(--liquid-blur);
            border:1.5px solid var(--liquid-border); border-radius:28px;
            box-shadow:var(--liquid-outer-shadow-lg),var(--liquid-inner-shadow);
            position:relative; overflow:hidden;
        }
        .liquid-glass-lg::before { content:''; position:absolute; inset:0; background:var(--liquid-refraction); border-radius:inherit; pointer-events:none; z-index:1; }
        .liquid-glass-lg::after { content:''; position:absolute; top:-25%;left:-15%;width:90%;height:65%; background:var(--liquid-caustic); border-radius:inherit; pointer-events:none; z-index:2; animation:cm 12s ease-in-out infinite; }

        /* ===== Header ===== */
        .header {
            text-align:center; padding:30px 20px 24px;
            background:var(--header-gradient); border-radius:28px;
            margin-bottom:10px; position:relative; overflow:hidden;
            box-shadow:0 16px 56px rgba(88,86,214,0.35),inset 0 1px 1px rgba(255,255,255,0.25);
        }
        .header::before { content:''; position:absolute; inset:0; background:linear-gradient(180deg,rgba(255,255,255,0.2) 0%,transparent 50%,rgba(0,0,0,0.1) 100%); z-index:1; }
        .header::after { content:''; position:absolute; top:-60%;left:-20%;width:140%;height:80%; background:radial-gradient(ellipse,rgba(255,255,255,0.15) 0%,transparent 60%); animation:hl 10s ease-in-out infinite; z-index:0; }
        @keyframes hl { 0%,100%{transform:translate(0,0) scale(1);}50%{transform:translate(-5px,8px) scale(0.97);} }
        .header .shimmer { position:absolute;top:0;left:-100%;width:60%;height:100%;background:linear-gradient(90deg,transparent,rgba(255,255,255,0.08),transparent);transform:skewX(-20deg);animation:sh 5s ease-in-out infinite;z-index:3; }
        @keyframes sh { 0%,100%{left:-100%;}50%{left:150%;} }
        .header h1 { font-size:1.4em; font-weight:800; position:relative; z-index:4; color:white; text-shadow:0 2px 16px rgba(0,0,0,0.2); }
        .header p { font-size:0.78em; opacity:0.85; position:relative; z-index:4; margin-top:4px; color:white; }

        /* ===== Bottom Tab Bar ===== */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 100%;
            max-width: 480px;
            z-index: 100;
            padding: 6px 8px;
            padding-bottom: max(6px, env(safe-area-inset-bottom));
            background: var(--liquid-bg-heavy);
            backdrop-filter: blur(80px) saturate(200%);
            -webkit-backdrop-filter: blur(80px) saturate(200%);
            border-top: 1px solid var(--liquid-border);
            box-shadow: 0 -4px 30px rgba(0,0,0,0.3);
            display: flex;
            gap: 2px;
        }

        .light-mode .bottom-nav {
            box-shadow: 0 -4px 30px rgba(0,0,0,0.06);
        }

        .tab-btn {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 3px;
            padding: 8px 4px 6px;
            background: none;
            border: none;
            color: var(--text-tertiary);
            font-family: inherit;
            font-size: 0.6em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            border-radius: 14px;
            position: relative;
        }

        .tab-btn .tab-icon { font-size: 1.9em; transition: transform 0.3s; }
        .tab-btn.active { color: var(--accent-indigo); }
        .tab-btn.active .tab-icon { transform: scale(1.15); }
        .tab-btn:active { transform: scale(0.88); }

        .tab-btn .tab-badge {
            position: absolute;
            top: 2px;
            right: calc(50% - 18px);
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--green);
            box-shadow: 0 0 8px rgba(48,209,88,0.5);
        }

        /* ===== Score Bar ===== */
        .score-bar { display:grid; grid-template-columns:1fr 1fr 1fr; gap:8px; margin-bottom:10px; }
        .score-card { padding:14px 6px; text-align:center; }
        .score-card:active { transform:scale(0.94); }
        .score-card .number { font-size:1.5em; font-weight:800; position:relative; z-index:3; background:linear-gradient(135deg,var(--gold),var(--orange)); -webkit-background-clip:text; -webkit-text-fill-color:transparent; background-clip:text; }
        .score-card .label { font-size:0.6em; color:var(--text-secondary); margin-top:3px; font-weight:500; position:relative; z-index:3; }
        .level-badge { display:inline-block; background:var(--header-gradient); padding:4px 12px; border-radius:20px; font-size:0.63em; font-weight:700; color:white; -webkit-text-fill-color:white; }

        /* ===== Tab Pages ===== */
        .tab-page { display:none; }
        .tab-page.active { display:block; animation:su 0.4s; }

        /* ===== Lektion List ===== */
        .lektion-list { display:flex; flex-direction:column; gap:8px; }
        .lektion-btn { padding:15px 16px; color:var(--text-primary); cursor:pointer; display:flex; align-items:center; gap:14px; }
        .lektion-btn:active { transform:scale(0.97); }
        .lektion-btn .icon { font-size:1.9em; width:48px; height:48px; display:flex; align-items:center; justify-content:center; background:rgba(88,86,214,0.12); border:1px solid rgba(88,86,214,0.15); border-radius:14px; flex-shrink:0; position:relative; z-index:3; }
        .lektion-btn .info { text-align:right; flex:1; position:relative; z-index:3; }
        .lektion-btn .info .title { font-weight:700; font-size:0.9em; }
        .lektion-btn .info .subtitle { font-size:0.7em; color:var(--text-secondary); margin-top:2px; }
        .lektion-btn .arrow { font-size:0.85em; color:var(--text-tertiary); position:relative; z-index:3; }

        /* ===== Sub Menu ===== */
        .sub-menu { display:none; gap:8px; }
        .sub-menu.show { display:grid; grid-template-columns:1fr 1fr; animation:su 0.5s; }
        .sub-btn { padding:28px 10px; color:var(--text-primary); cursor:pointer; text-align:center; }
        .sub-btn:active { transform:scale(0.92); }
        .sub-btn .sicon { font-size:2.3em; display:block; margin-bottom:10px; position:relative; z-index:3; }
        .sub-btn span:last-child { position:relative; z-index:3; font-weight:600; font-size:0.86em; }

        /* ===== Content ===== */
        .content-area { display:none; }
        .content-area.show { display:block; animation:su 0.5s; }

        .card { padding:22px 18px; margin-bottom:10px; }
        .card h2 { color:var(--accent-purple); font-size:1em; font-weight:700; margin-bottom:14px; display:flex; align-items:center; gap:8px; position:relative; z-index:3; }
        .card h3 { color:var(--gold); font-size:0.9em; font-weight:700; margin:16px 0 8px; position:relative; z-index:3; }
        .card p { line-height:2; font-size:0.85em; position:relative; z-index:3; }
        .card ul { padding-right:20px; line-height:2.2; font-size:0.85em; position:relative; z-index:3; }

        .back-btn {
            width:100%; padding:14px; color:var(--text-primary); font-family:inherit; font-size:0.9em; font-weight:600; cursor:pointer; margin:8px 0 14px;
            background:var(--liquid-bg); backdrop-filter:var(--liquid-blur-sm); -webkit-backdrop-filter:var(--liquid-blur-sm);
            border:1px solid var(--liquid-border-light); border-radius:18px; box-shadow:var(--liquid-outer-shadow),var(--liquid-inner-shadow);
            position:relative; overflow:hidden;
        }
        .back-btn::before { content:''; position:absolute; inset:0; background:var(--liquid-refraction); border-radius:inherit; pointer-events:none; }
        .back-btn:active { transform:scale(0.96); }

        .next-btn {
            display:none; width:100%; background:var(--header-gradient); border:1px solid rgba(255,255,255,0.15);
            border-radius:18px; padding:16px; color:white; font-family:inherit; font-size:0.98em; font-weight:700;
            cursor:pointer; margin-bottom:12px; box-shadow:0 8px 32px rgba(88,86,214,0.3),inset 0 1px 1px rgba(255,255,255,0.2);
            position:relative; overflow:hidden;
        }
        .next-btn::before { content:''; position:absolute; inset:0; background:linear-gradient(180deg,rgba(255,255,255,0.15) 0%,transparent 50%); pointer-events:none; }
        .next-btn:active { transform:scale(0.95); }
        .next-btn.show { display:block; animation:fi 0.3s; }

        /* Table & Grammar */
        .word-table { width:100%; border-collapse:collapse; direction:ltr; font-size:0.83em; position:relative; z-index:3; }
        .word-table th { background:rgba(88,86,214,0.1); padding:10px 8px; text-align:center; font-weight:600; font-size:0.82em; color:var(--accent-indigo); border-radius:8px; }
        .word-table td { padding:10px 8px; border-bottom:1px solid var(--liquid-border-light); text-align:center; }
        .de { color:var(--accent-blue); font-weight:600; }
        .fa { color:var(--gold); font-weight:500; }

        .grammar-box { background:rgba(88,86,214,0.08); border:1px solid rgba(88,86,214,0.15); border-radius:16px; padding:16px; margin:10px 0; direction:ltr; text-align:left; line-height:2.3; font-size:0.88em; position:relative; z-index:3; }
        .grammar-box .highlight { color:var(--gold); font-weight:700; }

        /* Flashcard */
        .flashcard {
            background:linear-gradient(160deg,rgba(88,86,214,0.2),rgba(175,82,222,0.12));
            backdrop-filter:var(--liquid-blur); -webkit-backdrop-filter:var(--liquid-blur);
            border:1px solid rgba(88,86,214,0.25); border-radius:28px; padding:46px 20px; text-align:center;
            margin-bottom:12px; min-height:190px; display:flex; flex-direction:column; justify-content:center;
            cursor:pointer; transition:all 0.5s cubic-bezier(0.34,1.56,0.64,1); position:relative; overflow:hidden;
            box-shadow:0 16px 48px rgba(88,86,214,0.2),inset 0 1px 2px rgba(255,255,255,0.2);
        }
        .flashcard::before { content:''; position:absolute; inset:0; background:var(--liquid-refraction); pointer-events:none; z-index:1; }
        .flashcard:active { transform:scale(0.96); }
        .flashcard .word { font-size:2.2em; font-weight:800; direction:ltr; position:relative; z-index:3; }
        .flashcard .meaning { font-size:1.3em; color:var(--gold); font-weight:600; display:none; position:relative; z-index:3; margin-top:12px; }
        .flashcard .tap-hint { font-size:0.7em; color:var(--text-secondary); position:relative; z-index:3; margin-top:16px; }

        .fc-nav { display:flex; gap:8px; margin-bottom:12px; }
        .fc-nav button {
            flex:1; padding:13px; border-radius:16px; border:1px solid var(--liquid-border-light);
            background:var(--liquid-bg); backdrop-filter:var(--liquid-blur-sm); -webkit-backdrop-filter:var(--liquid-blur-sm);
            color:var(--text-primary); font-family:inherit; font-size:0.9em; font-weight:600; cursor:pointer;
            box-shadow:var(--liquid-outer-shadow),var(--liquid-inner-shadow); position:relative; overflow:hidden;
        }
        .fc-nav button:active { transform:scale(0.92); }
        .fc-counter { text-align:center; color:var(--text-secondary); margin-bottom:10px; font-size:0.8em; }

        /* Quiz */
        .quiz-area { display:none; }
        .question-card { padding:22px 18px; margin-bottom:12px; }
        .question-number { font-size:0.73em; color:var(--accent-purple); font-weight:600; margin-bottom:10px; position:relative; z-index:3; }
        .question-text { font-size:0.93em; line-height:1.8; font-weight:500; position:relative; z-index:3; }
        .question-hint { font-size:0.78em; color:var(--gold); font-weight:500; margin-top:6px; position:relative; z-index:3; }
        .question-sentence { font-size:1.1em; direction:ltr; text-align:left; background:rgba(0,0,0,0.12); backdrop-filter:blur(15px); padding:16px; border-radius:18px; margin:14px 0; line-height:2; font-weight:600; position:relative; z-index:3; border:1px solid rgba(255,255,255,0.06); }
        .light-mode .question-sentence { background:rgba(0,0,0,0.04); }
        .blank { color:var(--gold); border-bottom:2px dashed var(--gold); padding:2px 10px; }
        .options { display:grid; grid-template-columns:1fr 1fr; gap:8px; margin-bottom:12px; }

        .option-btn {
            background:var(--liquid-bg); backdrop-filter:var(--liquid-blur-sm); -webkit-backdrop-filter:var(--liquid-blur-sm);
            border:1.5px solid var(--liquid-border-light); border-radius:18px; padding:14px;
            color:var(--text-primary); font-family:inherit; font-size:0.93em; font-weight:600; cursor:pointer;
            transition:all 0.4s cubic-bezier(0.34,1.56,0.64,1); direction:ltr; text-align:center;
            box-shadow:var(--liquid-outer-shadow),var(--liquid-inner-shadow); position:relative; overflow:hidden;
        }
        .option-btn::before { content:''; position:absolute; inset:0; background:var(--liquid-refraction); border-radius:inherit; pointer-events:none; }
        .option-btn:active { transform:scale(0.92); }
        .option-btn.correct { background:rgba(48,209,88,0.12); border-color:var(--green); color:var(--green); animation:cp 0.6s; }
        .option-btn.wrong { background:rgba(255,69,58,0.12); border-color:var(--red); color:var(--red); animation:sk 0.5s; }
        .option-btn:disabled { opacity:0.3; cursor:default; }

        @keyframes cp { 0%{transform:scale(1);}30%{transform:scale(1.06);}100%{transform:scale(1);} }

        .explanation { display:none; background:rgba(88,86,214,0.08); border:1px solid rgba(88,86,214,0.15); border-radius:18px; padding:16px; margin-bottom:12px; font-size:0.84em; line-height:1.9; backdrop-filter:blur(20px); -webkit-backdrop-filter:blur(20px); }
        .explanation.show { display:block; animation:fi 0.3s; }

        .progress-bar { width:100%; height:5px; background:var(--liquid-bg); border-radius:3px; margin-bottom:14px; overflow:hidden; }
        .progress-fill { height:100%; background:var(--header-gradient); border-radius:3px; transition:width 0.6s; box-shadow:0 0 14px rgba(88,86,214,0.4); }

        .result-card { display:none; text-align:center; padding:44px 20px; }
        .result-card .emoji { font-size:4.5em; margin-bottom:16px; animation:bi 0.6s; }
        .result-card h2 { font-size:1.4em; font-weight:800; position:relative; z-index:3; }
        .result-card .result-score { font-size:2.8em; background:linear-gradient(135deg,var(--gold),var(--orange)); -webkit-background-clip:text; -webkit-text-fill-color:transparent; background-clip:text; font-weight:800; margin:16px 0; }
        .result-card p { color:var(--text-secondary); margin-bottom:24px; position:relative; z-index:3; }

        @keyframes bi { 0%{transform:scale(0) rotate(-10deg);opacity:0;}50%{transform:scale(1.15) rotate(5deg);}100%{transform:scale(1) rotate(0);opacity:1;} }
        @keyframes fi { from{opacity:0;transform:translateY(6px);}to{opacity:1;transform:translateY(0);} }
        @keyframes su { from{opacity:0;transform:translateY(28px);}to{opacity:1;transform:translateY(0);} }
        @keyframes sk { 0%,100%{transform:translateX(0);}20%{transform:translateX(-6px);}40%{transform:translateX(6px);}60%{transform:translateX(-4px);}80%{transform:translateX(4px);} }

        /* ===== Google Sign-In ===== */
        .google-btn {
            width:100%; padding:16px; border-radius:18px;
            border:1px solid var(--liquid-border);
            background:var(--liquid-bg); backdrop-filter:var(--liquid-blur-sm); -webkit-backdrop-filter:var(--liquid-blur-sm);
            color:var(--text-primary); font-family:inherit; font-size:0.95em; font-weight:700;
            cursor:pointer; display:flex; align-items:center; justify-content:center; gap:12px;
            box-shadow:var(--liquid-outer-shadow),var(--liquid-inner-shadow);
            transition:all 0.3s; position:relative; overflow:hidden; margin-bottom:12px;
        }
        .google-btn::before { content:''; position:absolute; inset:0; background:var(--liquid-refraction); border-radius:inherit; pointer-events:none; }
        .google-btn:active { transform:scale(0.96); }
        .google-btn img { width:24px; height:24px; position:relative; z-index:3; }
        .google-btn span { position:relative; z-index:3; }

        .signout-btn {
            width:100%; padding:14px; border-radius:16px;
            background:rgba(255,69,58,0.1); border:1px solid rgba(255,69,58,0.2);
            color:var(--red); font-family:inherit; font-size:0.88em; font-weight:600;
            cursor:pointer; margin-top:12px;
        }
        .signout-btn:active { transform:scale(0.96); }

        /* ===== Profile Card ===== */
        .profile-card { padding:30px 20px; text-align:center; margin-bottom:10px; }
        .profile-avatar-lg {
            width:90px; height:90px; border-radius:50%;
            display:flex; align-items:center; justify-content:center;
            margin:0 auto 14px; position:relative; z-index:3;
            border:3px solid rgba(255,255,255,0.2);
            box-shadow:0 8px 32px rgba(88,86,214,0.3);
            overflow:hidden; background:var(--header-gradient);
        }
        .profile-avatar-lg img { width:100%; height:100%; object-fit:cover; }
        .profile-avatar-lg .avatar-letter { font-size:2.5em; color:white; font-weight:800; }
        .profile-name-lg { font-size:1.3em; font-weight:800; position:relative; z-index:3; }
        .profile-email { font-size:0.75em; color:var(--text-secondary); margin-top:4px; position:relative; z-index:3; }

        .profile-stats { display:grid; grid-template-columns:1fr 1fr 1fr; gap:8px; margin-bottom:10px; }
        .profile-stat { padding:18px 8px; text-align:center; }
        .profile-stat .sv { font-size:1.5em; font-weight:800; position:relative; z-index:3; background:linear-gradient(135deg,var(--accent-blue),var(--accent-purple)); -webkit-background-clip:text; -webkit-text-fill-color:transparent; background-clip:text; }
        .profile-stat .sl { font-size:0.6em; color:var(--text-secondary); margin-top:4px; position:relative; z-index:3; }

        /* ===== Leaderboard ===== */
        .lb-header { text-align:center; padding:24px 16px; margin-bottom:12px; }
        .lb-title { font-size:1.3em; font-weight:800; position:relative; z-index:3; background:linear-gradient(135deg,var(--gold),var(--orange)); -webkit-background-clip:text; -webkit-text-fill-color:transparent; background-clip:text; }
        .lb-sub { font-size:0.75em; color:var(--text-secondary); margin-top:4px; position:relative; z-index:3; }
        .online-dot { width:8px;height:8px;border-radius:50%;background:var(--green);display:inline-block;margin-right:4px;box-shadow:0 0 8px rgba(48,209,88,0.5);animation:pd 2s ease-in-out infinite; }
        @keyframes pd { 0%,100%{opacity:1;}50%{opacity:0.7;} }

        .podium { display:flex; align-items:flex-end; justify-content:center; gap:6px; margin-bottom:14px; padding:10px 0; }
        .podium-item { text-align:center; cursor:pointer; transition:all 0.4s cubic-bezier(0.34,1.56,0.64,1); }
        .podium-item:active { transform:scale(0.92); }
        .podium-item.first { order:2; }
        .podium-item.second { order:1; }
        .podium-item.third { order:3; }

        .podium-avatar { width:52px;height:52px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:1.4em;margin:0 auto 6px;position:relative;box-shadow:0 4px 20px rgba(0,0,0,0.2);overflow:hidden; }
        .podium-avatar img { width:100%;height:100%;object-fit:cover; }
        .podium-item.first .podium-avatar { width:68px;height:68px;font-size:1.8em;background:linear-gradient(145deg,#ffd60a,#ff9f0a);box-shadow:0 8px 32px rgba(255,214,10,0.35);border:2px solid rgba(255,255,255,0.3); }
        .podium-item.second .podium-avatar { background:linear-gradient(145deg,#c0c0c0,#a0a0a0);border:2px solid rgba(255,255,255,0.2); }
        .podium-item.third .podium-avatar { background:linear-gradient(145deg,#cd7f32,#b5651d);border:2px solid rgba(255,255,255,0.15); }
        .podium-medal { position:absolute;bottom:-4px;right:-4px;font-size:0.7em;background:var(--liquid-bg-heavy);border-radius:50%;width:22px;height:22px;display:flex;align-items:center;justify-content:center;border:1px solid var(--liquid-border-light);backdrop-filter:blur(20px); }
        .podium-name { font-size:0.7em; font-weight:700; margin-bottom:2px; }
        .podium-score-text { font-size:0.6em; color:var(--gold); font-weight:700; }
        .podium-bar { width:78px;border-radius:12px 12px 0 0;margin-top:8px;position:relative;overflow:hidden; }
        .podium-item.first .podium-bar { height:85px;background:linear-gradient(180deg,rgba(255,214,10,0.25),rgba(255,159,10,0.15));border:1px solid rgba(255,214,10,0.2); }
        .podium-item.second .podium-bar { height:62px;background:linear-gradient(180deg,rgba(192,192,192,0.2),rgba(160,160,160,0.1));border:1px solid rgba(192,192,192,0.15); }
        .podium-item.third .podium-bar { height:42px;background:linear-gradient(180deg,rgba(205,127,50,0.2),rgba(181,101,29,0.1));border:1px solid rgba(205,127,50,0.15); }
        .podium-bar .podium-rank { position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);font-size:1.5em;font-weight:900;opacity:0.15; }

        .lb-list { margin-bottom:12px; }
        .lb-item { display:flex; align-items:center; gap:12px; padding:14px 16px; cursor:pointer; position:relative; z-index:3; border-bottom:1px solid var(--liquid-border-light); }
        .lb-item:last-child { border-bottom:none; }
        .lb-item:active { background:rgba(88,86,214,0.06); }
        .lb-item.is-me { background:rgba(88,86,214,0.08); border:1px solid rgba(88,86,214,0.15); border-radius:16px; margin:4px 0; }

        .lb-rank { width:28px; font-size:0.85em; font-weight:800; text-align:center; flex-shrink:0; }
        .lb-avatar-sm { width:42px;height:42px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:1.2em;flex-shrink:0;border:1.5px solid var(--liquid-border-light);overflow:hidden;background:rgba(88,86,214,0.12); }
        .lb-avatar-sm img { width:100%;height:100%;object-fit:cover; }
        .lb-avatar-sm .lb-online { position:absolute;bottom:0;right:0;width:10px;height:10px;border-radius:50%;border:2px solid var(--bg-primary); }
        .lb-online.on { background:var(--green); }
        .lb-online.off { background:rgba(255,255,255,0.2); }

        .lb-info { flex:1; }
        .lb-name { font-size:0.86em; font-weight:700; }
        .lb-name .me-badge { font-size:0.6em;background:var(--header-gradient);color:white;padding:2px 8px;border-radius:8px;margin-right:6px;display:inline-block; }
        .lb-details { font-size:0.66em; color:var(--text-secondary); margin-top:2px; }
        .lb-score { text-align:left; flex-shrink:0; }
        .lb-score-val { font-size:1.05em; font-weight:800; color:var(--gold); }
        .lb-score-label { font-size:0.56em; color:var(--text-tertiary); }

        .loading-spinner { text-align:center; padding:40px; position:relative; z-index:3; }
        .loading-spinner .spin { font-size:2.5em; animation:spin 1s linear infinite; display:inline-block; }
        @keyframes spin { 0%{transform:rotate(0deg);}100%{transform:rotate(360deg);} }
        .loading-spinner p { font-size:0.82em; color:var(--text-secondary); margin-top:10px; }

        .auth-prompt { text-align:center; padding:40px 20px; position:relative; z-index:3; }
        .auth-prompt .auth-icon { font-size:4em; margin-bottom:16px; }
        .auth-prompt p { font-size:0.88em; color:var(--text-secondary); line-height:1.8; margin-bottom:20px; }

        /* ===== Settings ===== */
        .settings-group { padding:6px 0; margin-bottom:10px; }
        .settings-group-title { font-size:0.72em; color:var(--text-secondary); font-weight:600; padding:0 18px 8px; text-transform:uppercase; }
        .setting-item { display:flex; align-items:center; justify-content:space-between; padding:14px 18px; cursor:pointer; position:relative; z-index:3; }
        .setting-item:not(:last-child) { border-bottom:1px solid var(--liquid-border-light); }
        .setting-item:active { background:rgba(88,86,214,0.06); }
        .setting-item .setting-left { display:flex; align-items:center; gap:12px; }
        .setting-item .setting-icon { width:32px;height:32px;border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:1em; }
        .setting-icon.blue { background:rgba(10,132,255,0.15); }
        .setting-icon.purple { background:rgba(175,82,222,0.15); }
        .setting-icon.green { background:rgba(48,209,88,0.15); }
        .setting-icon.red { background:rgba(255,69,58,0.15); }
        .setting-icon.orange { background:rgba(255,159,10,0.15); }
        .setting-icon.teal { background:rgba(106,196,220,0.15); }
        .setting-item .setting-label { font-size:0.86em; font-weight:500; }
        .setting-item .setting-right { color:var(--text-tertiary); font-size:0.83em; }

        .toggle-switch { width:48px;height:28px;border-radius:14px;background:rgba(255,255,255,0.1);border:1px solid rgba(255,255,255,0.15);position:relative;cursor:pointer;transition:all 0.3s; }
        .toggle-switch.active { background:var(--green);border-color:var(--green); }
        .toggle-switch::after { content:'';width:22px;height:22px;border-radius:50%;background:white;position:absolute;top:2px;right:2px;transition:all 0.3s cubic-bezier(0.34,1.56,0.64,1);box-shadow:0 2px 6px rgba(0,0,0,0.2); }
        .toggle-switch.active::after { right:calc(100% - 24px); }
        .light-mode .toggle-switch { background:rgba(0,0,0,0.08);border-color:rgba(0,0,0,0.1); }

        /* Toast */
        .toast { position:fixed;bottom:100px;left:50%;transform:translateX(-50%) translateY(100px);background:var(--liquid-bg-heavy);backdrop-filter:var(--liquid-blur);-webkit-backdrop-filter:var(--liquid-blur);border:1px solid var(--liquid-border);border-radius:16px;padding:14px 24px;color:var(--text-primary);font-family:inherit;font-size:0.85em;font-weight:600;z-index:1000;box-shadow:var(--liquid-outer-shadow-lg);transition:transform 0.5s cubic-bezier(0.34,1.56,0.64,1);white-space:nowrap; }
        .toast.show { transform:translateX(-50%) translateY(0); }

        ::-webkit-scrollbar { width:3px; }
        ::-webkit-scrollbar-track { background:transparent; }
        ::-webkit-scrollbar-thumb { background:rgba(88,86,214,0.3);border-radius:2px; }

        @media (max-width:360px) {
            .header h1 { font-size:1.2em; }
            .podium-avatar { width:44px!important;height:44px!important; }
            .podium-item.first .podium-avatar { width:58px!important;height:58px!important; }
            .podium-bar { width:65px!important; }
        }
    </style>
</head>
<body>

<div class="ambient-bg"></div>
<div class="ambient-orb"></div>
<div class="ambient-orb"></div>
<div class="ambient-orb"></div>

<div class="toast" id="toast"></div>

<div class="app-container">

    <div class="header" id="mainHeader">
        <div class="shimmer"></div>
        <h1 id="headerTitle">ğŸ“š Menschen A1.1</h1>
        <p id="headerSub">Ø¢Ù…ÙˆØ²Ø´ Ø²Ø¨Ø§Ù† Ø¢Ù„Ù…Ø§Ù†ÛŒ - Ø³Ø·Ø­ A1</p>
    </div>

    <!-- ===== TAB: HOME ===== -->
    <div class="tab-page active" id="pageHome">
        <div class="score-bar">
            <div class="score-card liquid-glass"><div class="number" id="totalScore">0</div><div class="label">Ø§Ù…ØªÛŒØ§Ø²</div></div>
            <div class="score-card liquid-glass"><div class="number" id="streak">0</div><div class="label">ğŸ”¥ Ù¾Ø´Øªâ€ŒØ³Ø±Ù‡Ù…</div></div>
            <div class="score-card liquid-glass"><div class="number"><span class="level-badge" id="levelBadge">Ù…Ø¨ØªØ¯ÛŒ</span></div><div class="label">Ø³Ø·Ø­</div></div>
        </div>
        <div id="mainMenu"><div class="lektion-list" id="lektionList"></div></div>
        <div class="sub-menu" id="subMenu">
            <div class="sub-btn liquid-glass" onclick="showSection('words')"><span class="sicon">ğŸ“</span><span>ÙˆØ§Ú˜Ù‡â€ŒÙ‡Ø§</span></div>
            <div class="sub-btn liquid-glass" onclick="showSection('grammar')"><span class="sicon">ğŸ“–</span><span>Ú¯Ø±Ø§Ù…Ø±</span></div>
            <div class="sub-btn liquid-glass" onclick="showSection('lesson')"><span class="sicon">ğŸ“‹</span><span>Ø¯Ø±Ø³</span></div>
            <div class="sub-btn liquid-glass" onclick="showSection('exercise')"><span class="sicon">âœï¸</span><span>ØªÙ…Ø±ÛŒÙ†</span></div>
        </div>
        <button class="back-btn" id="subMenuBack" style="display:none" onclick="goHome()">ğŸ  Ø¨Ø§Ø²Ú¯Ø´Øª</button>
        <div class="content-area" id="wordsArea"></div>
        <div class="content-area" id="grammarArea"></div>
        <div class="content-area" id="lessonArea"></div>
        <div class="quiz-area" id="quizArea">
            <div class="progress-bar"><div class="progress-fill" id="progressFill" style="width:0%"></div></div>
            <div class="question-card liquid-glass-lg"><div class="question-number" id="questionNumber"></div><div class="question-text" id="questionText"></div><div class="question-hint" id="questionHint"></div><div class="question-sentence" id="questionSentence"></div></div>
            <div class="options" id="optionsContainer"></div>
            <div class="explanation" id="explanation"></div>
            <button class="next-btn" id="nextBtn" onclick="nextQuestion()">Ø³Ø¤Ø§Ù„ Ø¨Ø¹Ø¯ÛŒ â¡ï¸</button>
            <button class="back-btn" onclick="backToSubMenu()">â¬…ï¸ Ø¨Ø§Ø²Ú¯Ø´Øª</button>
        </div>
        <div class="result-card liquid-glass-lg" id="resultCard">
            <div class="emoji" id="resultEmoji"></div>
            <h2 id="resultTitle"></h2>
            <div class="result-score" id="resultScore"></div>
            <p id="resultText"></p>
            <button class="next-btn show" onclick="backToSubMenu()" style="display:block">â¬…ï¸ Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ Ø¯Ø±Ø³</button>
            <button class="back-btn" onclick="goHome()">ğŸ  Ù…Ù†ÙˆÛŒ Ø§ØµÙ„ÛŒ</button>
        </div>
    </div>

    <!-- ===== TAB: LEADERBOARD ===== -->
    <div class="tab-page" id="pageLeaderboard">
        <div class="lb-header liquid-glass-lg">
            <div class="lb-title">ğŸ† ØªØ§Ø¨Ù„Ùˆ Ø§Ù…ØªÛŒØ§Ø²Ø§Øª</div>
            <div class="lb-sub"><span class="online-dot"></span><span id="onlineCount">Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ...</span></div>
        </div>
        <div id="podiumArea"></div>
        <div class="lb-list liquid-glass-lg" id="lbList">
            <div class="loading-spinner"><div class="spin">â³</div><p>Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ...</p></div>
        </div>
    </div>

    <!-- ===== TAB: PROFILE ===== -->
    <div class="tab-page" id="pageProfile">
        <!-- Not signed in -->
        <div id="authPrompt">
            <div class="auth-prompt liquid-glass-lg">
                <div class="auth-icon">ğŸ”</div>
                <p>Ø¨Ø±Ø§ÛŒ Ø°Ø®ÛŒØ±Ù‡ Ø§Ù…ØªÛŒØ§Ø² Ùˆ Ø±Ù‚Ø§Ø¨Øª Ø¢Ù†Ù„Ø§ÛŒÙ†<br>Ø¨Ø§ Ø­Ø³Ø§Ø¨ Ú¯ÙˆÚ¯Ù„ ÙˆØ§Ø±Ø¯ Ø´ÙˆÛŒØ¯</p>
                <button class="google-btn" onclick="googleSignIn()">
                    <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" alt="Google">
                    <span>ÙˆØ±ÙˆØ¯ Ø¨Ø§ Ø­Ø³Ø§Ø¨ Google</span>
                </button>
            </div>
        </div>
        <!-- Signed in -->
        <div id="profileContent" style="display:none">
            <div class="profile-card liquid-glass-lg">
                <div class="profile-avatar-lg" id="profileAvatar"><span class="avatar-letter" id="avatarLetter">ğŸ‘¤</span></div>
                <div class="profile-name-lg" id="profileName">Ú©Ø§Ø±Ø¨Ø±</div>
                <div class="profile-email" id="profileEmail"></div>
            </div>
            <div class="profile-stats">
                <div class="profile-stat liquid-glass"><div class="sv" id="pStatScore">0</div><div class="sl">Ø§Ù…ØªÛŒØ§Ø²</div></div>
                <div class="profile-stat liquid-glass"><div class="sv" id="pStatStreak">0</div><div class="sl">ğŸ”¥ Ø§Ø³ØªØ±ÛŒÚ©</div></div>
                <div class="profile-stat liquid-glass"><div class="sv" id="pStatDays">0</div><div class="sl">Ø±ÙˆØ² ÙØ¹Ø§Ù„ÛŒØª</div></div>
            </div>
            <div class="profile-stat liquid-glass" style="padding:18px;text-align:center;margin-bottom:10px">
                <div class="sv" id="pStatRank">-</div>
                <div class="sl">Ø±ØªØ¨Ù‡ Ø´Ù…Ø§ Ø¯Ø± ØªØ§Ø¨Ù„Ùˆ Ø§Ù…ØªÛŒØ§Ø²Ø§Øª</div>
            </div>
            <button class="signout-btn" onclick="googleSignOut()">ğŸšª Ø®Ø±ÙˆØ¬ Ø§Ø² Ø­Ø³Ø§Ø¨</button>
        </div>
    </div>

    <!-- ===== TAB: SETTINGS ===== -->
    <div class="tab-page" id="pageSettings">
        <div class="settings-group liquid-glass-lg">
            <div class="settings-group-title">Ø¸Ø§Ù‡Ø±ÛŒ</div>
            <div class="setting-item" onclick="toggleTheme()"><div class="setting-left"><div class="setting-icon purple">ğŸ¨</div><span class="setting-label">ØªÙ… ØªØ§Ø±ÛŒÚ© / Ø±ÙˆØ´Ù†</span></div><div class="toggle-switch" id="themeToggle"></div></div>
        </div>
        <div class="settings-group liquid-glass-lg">
            <div class="settings-group-title">ÛŒØ§Ø¯Ú¯ÛŒØ±ÛŒ</div>
            <div class="setting-item" onclick="toggleHints()"><div class="setting-left"><div class="setting-icon green">ğŸ’¡</div><span class="setting-label">Ù†Ù…Ø§ÛŒØ´ Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒÛŒ</span></div><div class="toggle-switch active" id="hintToggle"></div></div>
            <div class="setting-item" onclick="toggleAutoNext()"><div class="setting-left"><div class="setting-icon orange">â­ï¸</div><span class="setting-label">Ø±ÙØªÙ† Ø®ÙˆØ¯Ú©Ø§Ø± Ø¨Ù‡ Ø³Ø¤Ø§Ù„ Ø¨Ø¹Ø¯</span></div><div class="toggle-switch" id="autoNextToggle"></div></div>
        </div>
        <div class="settings-group liquid-glass-lg">
            <div class="settings-group-title">Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§</div>
            <div class="setting-item" onclick="resetProgress()"><div class="setting-left"><div class="setting-icon red">ğŸ—‘ï¸</div><span class="setting-label">Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ù¾ÛŒØ´Ø±ÙØª</span></div><div class="setting-right">â†</div></div>
        </div>
        <div class="settings-group liquid-glass-lg">
            <div class="settings-group-title">Ø¯Ø±Ø¨Ø§Ø±Ù‡</div>
            <div class="setting-item"><div class="setting-left"><div class="setting-icon teal">â„¹ï¸</div><span class="setting-label">Ù†Ø³Ø®Ù‡</span></div><div class="setting-right">3.0 Online</div></div>
            <div class="setting-item"><div class="setting-left"><div class="setting-icon purple">ğŸ”—</div><span class="setting-label">Ø§ØªØµØ§Ù„</span></div><div class="setting-right" id="connStatus">Firebase</div></div>
        </div>
    </div>

</div>

<!-- ===== Bottom Navigation ===== -->
<nav class="bottom-nav">
    <button class="tab-btn active" onclick="switchTab('Home',this)" id="tabHome">
        <span class="tab-icon">ğŸ </span>
        <span>Ø®Ø§Ù†Ù‡</span>
    </button>
    <button class="tab-btn" onclick="switchTab('Leaderboard',this)" id="tabLeaderboard">
        <span class="tab-icon">ğŸ†</span>
        <span>Ø±ØªØ¨Ù‡â€ŒØ¨Ù†Ø¯ÛŒ</span>
        <div class="tab-badge"></div>
    </button>
    <button class="tab-btn" onclick="switchTab('Profile',this)" id="tabProfile">
        <span class="tab-icon">ğŸ‘¤</span>
        <span>Ø­Ø³Ø§Ø¨</span>
    </button>
    <button class="tab-btn" onclick="switchTab('Settings',this)" id="tabSettings">
        <span class="tab-icon">âš™ï¸</span>
        <span>ØªÙ†Ø¸ÛŒÙ…Ø§Øª</span>
    </button>
</nav>

<!-- ========================================== -->
<!-- FIREBASE SDK -->
<!-- ========================================== -->
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

<script>
    // â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
    // â•‘  ğŸ”§ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Firebase - Ø§ÛŒÙ† Ø¨Ø®Ø´ Ø±Ø§ Ø¹ÙˆØ¶ Ú©Ù†ÛŒØ¯  â•‘
    // â•‘                                              â•‘
    // â•‘  Û±. Ø¨Ù‡ console.firebase.google.com Ø¨Ø±ÙˆÛŒØ¯     â•‘
    // â•‘  Û². Ù¾Ø±ÙˆÚ˜Ù‡ Ø¬Ø¯ÛŒØ¯ Ø¨Ø³Ø§Ø²ÛŒØ¯                       â•‘
    // â•‘  Û³. Authentication > Google Ø±Ø§ ÙØ¹Ø§Ù„ Ú©Ù†ÛŒØ¯      â•‘
    // â•‘  Û´. Firestore Database Ø¨Ø³Ø§Ø²ÛŒØ¯                 â•‘
    // â•‘  Ûµ. Config Ø²ÛŒØ± Ø±Ø§ Ø¨Ø§ Ù…Ø§Ù„ Ø®ÙˆØ¯ØªØ§Ù† Ø¹ÙˆØ¶ Ú©Ù†ÛŒØ¯      â•‘
    // â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    const firebaseConfig = {
        apiKey: "AIzaSyDZ5Dp5c8wqVQrqPwAob1pM1VPvakGd_W0",
        authDomain: "german-app-e7d9c.firebaseapp.com",
        projectId: "german-app-e7d9c",
        storageBucket: "german-app-e7d9c.firebasestorage.app",
        messagingSenderId: "396305678669",
        appId: "1:396305678669:web:a63130ed963ed93db4f704"
    };

    // Firebase Init
    let db, auth, currentUser = null;
    let firebaseReady = false;

    try {
        firebase.initializeApp(firebaseConfig);
        db = firebase.firestore();
        auth = firebase.auth();
        firebaseReady = true;
        console.log('âœ… Firebase initialized');
    } catch(e) {
        console.warn('âš ï¸ Firebase not configured. Running offline.', e);
    }

    // ===== LESSON DATA =====
    const lektionInfo=[{num:1,icon:"ğŸ“—",title:"Lektion 1",subtitle:"Hallo! Ich bin Nicole"},{num:2,icon:"ğŸ“˜",title:"Lektion 2",subtitle:"Der Familienname ist MÃ¼ller"},{num:3,icon:"ğŸ“™",title:"Lektion 3",subtitle:"Das ist mein Bruder"},{num:4,icon:"ğŸ“•",title:"Lektion 4",subtitle:"Du hast einen Bruder?"},{num:5,icon:"ğŸ“’",title:"Lektion 5",subtitle:"Was ist das?"},{num:6,icon:"ğŸ““",title:"Lektion 6",subtitle:"Das ist kein CafÃ©"},{num:7,icon:"ğŸ“”",title:"Lektion 7",subtitle:"Ich bin Journalistin"},{num:8,icon:"ğŸ“—",title:"Lektion 8",subtitle:"Mein Tag"},{num:9,icon:"ğŸ“˜",title:"Lektion 9",subtitle:"Was mÃ¶chtest du?"},{num:10,icon:"ğŸ“™",title:"Lektion 10",subtitle:"Ich steige ein"},{num:11,icon:"ğŸ“•",title:"Lektion 11",subtitle:"Was hast du gemacht?"},{num:12,icon:"ğŸ“’",title:"Lektion 12",subtitle:"Was ist passiert?"}];

    const L={
    1:{t:"Lektion 1: Hallo!",w:[{d:"Hallo",f:"Ø³Ù„Ø§Ù…"},{d:"Guten Morgen",f:"ØµØ¨Ø­ Ø¨Ø®ÛŒØ±"},{d:"TschÃ¼s",f:"Ø®Ø¯Ø§Ø­Ø§ÙØ¸"},{d:"ich",f:"Ù…Ù†"},{d:"du",f:"ØªÙˆ"},{d:"er",f:"Ø§Ùˆ (Ù…Ø±Ø¯)"},{d:"sie",f:"Ø§Ùˆ (Ø²Ù†)"},{d:"Sie",f:"Ø´Ù…Ø§"},{d:"heiÃŸen",f:"Ù†Ø§Ù… Ø¯Ø§Ø´ØªÙ†"},{d:"kommen",f:"Ø¢Ù…Ø¯Ù†"},{d:"wohnen",f:"Ø²Ù†Ø¯Ú¯ÛŒ Ú©Ø±Ø¯Ù†"},{d:"sprechen",f:"ØµØ­Ø¨Øª Ú©Ø±Ø¯Ù†"},{d:"sein",f:"Ø¨ÙˆØ¯Ù†"},{d:"der Name",f:"Ø§Ø³Ù…"},{d:"Deutschland",f:"Ø¢Ù„Ù…Ø§Ù†"},{d:"Deutsch",f:"Ø¢Ù„Ù…Ø§Ù†ÛŒ"},{d:"Ja",f:"Ø¨Ù„Ù‡"},{d:"Nein",f:"Ù†Ù‡"}],g:{t:"Ú¯Ø±Ø§Ù…Ø± Û±",s:[{t:"ÙØ¹Ù„ sein",c:"",tb:"ich <span class='highlight'>bin</span>\ndu <span class='highlight'>bist</span>\ner/sie <span class='highlight'>ist</span>\nSie <span class='highlight'>sind</span>",ex:["Ich <b>bin</b> Nicole."]},{t:"ØµØ±Ù ÙØ¹Ù„",c:"",tb:"ich komm<span class='highlight'>e</span>\ndu komm<span class='highlight'>st</span>\ner komm<span class='highlight'>t</span>",ex:["Ich <b>komme</b> aus Iran."]}]},l:{t:"Ø¯Ø±Ø³ Û±",s:[{t:"ğŸ¯ Ù‡Ø¯Ù",c:"â€¢ Ù…Ø¹Ø±ÙÛŒ Ø®ÙˆØ¯\nâ€¢ Ø³Ù„Ø§Ù… Ùˆ Ø®Ø¯Ø§Ø­Ø§ÙØ¸ÛŒ"}]},e:[{s:"Ich ___ Nicole.",o:["bin","bist","ist","sind"],c:0,h:"Ù…Ù† Ù‡Ø³ØªÙ…",x:"ich bin"},{s:"Wie ___ du?",o:["heiÃŸen","heiÃŸt","heiÃŸe","heiÃŸst"],c:1,h:"Ø§Ø³Ù…ØªØŸ",x:"du heiÃŸt"},{s:"Ich ___ aus Iran.",o:["kommt","kommen","kommst","komme"],c:3,h:"",x:"ich komme"},{s:"Er ___ in Berlin.",o:["wohne","wohnst","wohnt","wohnen"],c:2,h:"",x:"er wohnt"},{s:"Du ___ Student.",o:["bin","bist","ist","sind"],c:1,h:"",x:"du bist"}],ge:[{s:"ich ___ (sein)",o:["bin","bist","ist","sind"],c:0,h:"",x:"ich bin"},{s:"du ___ (sein)",o:["bin","bist","ist","sind"],c:1,h:"",x:"du bist"},{s:"er ___ (sein)",o:["bin","bist","ist","sind"],c:2,h:"",x:"er ist"}]},
    2:{t:"Lektion 2",w:[{d:"der Familienname",f:"Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ"},{d:"die Adresse",f:"Ø¢Ø¯Ø±Ø³"},{d:"buchstabieren",f:"Ù‡Ø¬ÛŒ Ú©Ø±Ø¯Ù†"},{d:"langsam",f:"Ø¢Ù‡Ø³ØªÙ‡"},{d:"bitte",f:"Ù„Ø·ÙØ§Ù‹"},{d:"danke",f:"Ù…Ù…Ù†ÙˆÙ†"},{d:"Entschuldigung",f:"Ø¨Ø¨Ø®Ø´ÛŒØ¯"}],g:{t:"Ú¯Ø±Ø§Ù…Ø± Û²",s:[{t:"Ø§Ø¹Ø¯Ø§Ø¯",c:"",tb:"21=<span class='highlight'>ein</span>und<span class='highlight'>zwanzig</span>\n30=dreiÃŸig\n100=hundert",ex:["25=fÃ¼nfundzwanzig"]}]},l:{t:"Ø¯Ø±Ø³ Û²",s:[{t:"ğŸ¯",c:"â€¢ Ø§Ø¹Ø¯Ø§Ø¯ Û²Û°-Û±Û°Û°"}]},e:[{s:"25 = ___",o:["zweiundfÃ¼nfzig","fÃ¼nfundzwanzig","fÃ¼nfzehn","zwanzig"],c:1,h:"",x:"fÃ¼nfundzwanzig"},{s:"Bitte sprechen Sie ___.",o:["schnell","langsam","laut","gut"],c:1,h:"",x:"langsam"}],ge:[{s:"dreiÃŸig=___",o:["13","30","3","33"],c:1,h:"",x:"30"}]},
    3:{t:"Lektion 3",w:[{d:"die Familie",f:"Ø®Ø§Ù†ÙˆØ§Ø¯Ù‡"},{d:"der Vater",f:"Ù¾Ø¯Ø±"},{d:"die Mutter",f:"Ù…Ø§Ø¯Ø±"},{d:"der Bruder",f:"Ø¨Ø±Ø§Ø¯Ø±"},{d:"die Schwester",f:"Ø®ÙˆØ§Ù‡Ø±"},{d:"verheiratet",f:"Ù…ØªØ£Ù‡Ù„"},{d:"ledig",f:"Ù…Ø¬Ø±Ø¯"}],g:{t:"Ú¯Ø±Ø§Ù…Ø± Û³",s:[{t:"Ø¶Ù…Ø§ÛŒØ± Ù…Ù„Ú©ÛŒ",c:"",tb:"<span class='highlight'>mein</span> Vater\n<span class='highlight'>meine</span> Mutter",ex:["mein Bruder"]}]},l:{t:"Ø¯Ø±Ø³ Û³",s:[{t:"ğŸ¯",c:"â€¢ Ø®Ø§Ù†ÙˆØ§Ø¯Ù‡"}]},e:[{s:"Das ist ___ Bruder.(Ù…Ù†)",o:["mein","meine","dein","deine"],c:0,h:"Ù…Ø°Ú©Ø±",x:"mein"},{s:"Wie alt ___ du?",o:["bin","bist","ist","sind"],c:1,h:"",x:"bist"}],ge:[{s:"der Vaterâ†’___(Ù…Ù†)",o:["mein","meine","meinen","meinem"],c:0,h:"",x:"mein"}]},
    4:{t:"Lektion 4",w:[{d:"haben",f:"Ø¯Ø§Ø´ØªÙ†"},{d:"der Hund",f:"Ø³Ú¯"},{d:"die Katze",f:"Ú¯Ø±Ø¨Ù‡"},{d:"schÃ¶n",f:"Ø²ÛŒØ¨Ø§"},{d:"ein/eine",f:"ÛŒÚ©"},{d:"kein/keine",f:"Ù‡ÛŒÚ†"}],g:{t:"Ú¯Ø±Ø§Ù…Ø± Û´",s:[{t:"haben",c:"",tb:"ich <span class='highlight'>habe</span>\ndu <span class='highlight'>hast</span>\ner <span class='highlight'>hat</span>",ex:["Ich habe einen Bruder."]}]},l:{t:"Ø¯Ø±Ø³ Û´",s:[{t:"ğŸ¯",c:"â€¢ haben\nâ€¢ Ø§Ú©ÙˆØ²Ø§ØªÛŒÙˆ"}]},e:[{s:"Ich ___ einen Bruder.",o:["habe","hast","hat","haben"],c:0,h:"",x:"ich habe"},{s:"Ich habe ___ Hund.",o:["ein","eine","einen","einer"],c:2,h:"derâ†’einen",x:"einen"}],ge:[{s:"ich ___(haben)",o:["habe","hast","hat","haben"],c:0,h:"",x:"habe"}]},
    5:{t:"Lektion 5",w:[{d:"der Tisch",f:"Ù…ÛŒØ²"},{d:"die Lampe",f:"Ù„Ø§Ù…Ù¾"},{d:"das Buch",f:"Ú©ØªØ§Ø¨"},{d:"neu",f:"Ù†Ùˆ"},{d:"kaputt",f:"Ø®Ø±Ø§Ø¨"},{d:"teuer",f:"Ú¯Ø±Ø§Ù†"}],g:{t:"Ú¯Ø±Ø§Ù…Ø± Ûµ",s:[{t:"Ø¢Ø±ØªÛŒÚ©Ù„",c:"",tb:"<span class='highlight'>der</span> Tisch\n<span class='highlight'>die</span> Lampe\n<span class='highlight'>das</span> Buch",ex:["Der Tisch ist groÃŸ."]}]},l:{t:"Ø¯Ø±Ø³ Ûµ",s:[{t:"ğŸ¯",c:"â€¢ der/die/das"}]},e:[{s:"___ Tisch ist groÃŸ.",o:["Der","Die","Das","Den"],c:0,h:"",x:"Der"},{s:"___ Buch ist gut.",o:["Der","Die","Das","Den"],c:2,h:"",x:"Das"}],ge:[{s:"derâ†’___",o:["ein","eine","einen","einer"],c:0,h:"",x:"ein"}]},
    6:{t:"Lektion 6",w:[{d:"das CafÃ©",f:"Ú©Ø§ÙÙ‡"},{d:"der Supermarkt",f:"Ø³ÙˆÙ¾Ø±Ù…Ø§Ø±Ú©Øª"},{d:"die Bank",f:"Ø¨Ø§Ù†Ú©"},{d:"hier",f:"Ø§ÛŒÙ†Ø¬Ø§"},{d:"dort",f:"Ø¢Ù†Ø¬Ø§"},{d:"links",f:"Ú†Ù¾"},{d:"rechts",f:"Ø±Ø§Ø³Øª"}],g:{t:"Ú¯Ø±Ø§Ù…Ø± Û¶",s:[{t:"Es gibt",c:"",tb:"Es gibt <span class='highlight'>einen</span> Supermarkt.",ex:["Hier gibt es ein CafÃ©."]}]},l:{t:"Ø¯Ø±Ø³ Û¶",s:[{t:"ğŸ¯",c:"â€¢ Ù…Ú©Ø§Ù†â€ŒÙ‡Ø§"}]},e:[{s:"Das ist ___ CafÃ©.(Ù†ÙÛŒ)",o:["kein","keine","keinen","keiner"],c:0,h:"",x:"kein"},{s:"Wo ___ der Bahnhof?",o:["bin","bist","ist","sind"],c:2,h:"",x:"ist"}],ge:[{s:"ein CafÃ©â†’___(Ù†ÙÛŒ)",o:["kein","keine","keinen","nicht"],c:0,h:"",x:"kein"}]},
    7:{t:"Lektion 7",w:[{d:"der Beruf",f:"Ø´ØºÙ„"},{d:"der Arzt",f:"Ø¯Ú©ØªØ±"},{d:"der Lehrer",f:"Ù…Ø¹Ù„Ù…"},{d:"arbeiten",f:"Ú©Ø§Ø± Ú©Ø±Ø¯Ù†"},{d:"bei",f:"Ù†Ø²Ø¯"},{d:"als",f:"Ø¨Ù‡ Ø¹Ù†ÙˆØ§Ù†"}],g:{t:"Ú¯Ø±Ø§Ù…Ø± Û·",s:[{t:"Ø´ØºÙ„",c:"",tb:"Ich bin <span class='highlight'>Arzt</span>. âœ…",ex:["Ich bin Ingenieur."]}]},l:{t:"Ø¯Ø±Ø³ Û·",s:[{t:"ğŸ¯",c:"â€¢ Ø´ØºÙ„â€ŒÙ‡Ø§"}]},e:[{s:"Ich bin ___.",o:["Arzt","ein Arzt","der Arzt","einen Arzt"],c:0,h:"",x:"Arzt"},{s:"Er arbeitet ___ BMW.",o:["in","bei","als","mit"],c:1,h:"",x:"bei"}],ge:[{s:"Lehrerâ†’die ___",o:["Lehrerin","Lehrerein","Lehrern","Lehrin"],c:0,h:"",x:"Lehrerin"}]},
    8:{t:"Lektion 8",w:[{d:"aufstehen",f:"Ø¨Ù„Ù†Ø¯ Ø´Ø¯Ù†"},{d:"frÃ¼hstÃ¼cken",f:"ØµØ¨Ø­Ø§Ù†Ù‡"},{d:"einkaufen",f:"Ø®Ø±ÛŒØ¯"},{d:"kochen",f:"Ø¢Ø´Ù¾Ø²ÛŒ"},{d:"schlafen",f:"Ø®ÙˆØ§Ø¨ÛŒØ¯Ù†"}],g:{t:"Ú¯Ø±Ø§Ù…Ø± Û¸",s:[{t:"ÙØ¹Ù„ Ø¬Ø¯Ø§Ø´Ø¯Ù†ÛŒ",c:"",tb:"<span class='highlight'>auf</span>stehenâ†’ich <span class='highlight'>stehe</span>...<span class='highlight'>auf</span>",ex:["Ich stehe um 7 auf."]}]},l:{t:"Ø¯Ø±Ø³ Û¸",s:[{t:"ğŸ¯",c:"â€¢ ÙØ¹Ù„ Ø¬Ø¯Ø§Ø´Ø¯Ù†ÛŒ"}]},e:[{s:"Ich ___ um 7 ___.(aufstehen)",o:["stehe...auf","aufstehe","stehe...ein","kaufe...auf"],c:0,h:"",x:"stehe...auf"},{s:"7:30=___",o:["halb sieben","halb acht","sieben Uhr","acht Uhr"],c:1,h:"âš ï¸",x:"halb acht"}],ge:[{s:"aufstehenâ†’ich___",o:["stehe...auf","aufstehe","stehauf","steheauf"],c:0,h:"",x:"stehe...auf"}]},
    9:{t:"Lektion 9",w:[{d:"mÃ¶chten",f:"Ø®ÙˆØ§Ø³ØªÙ†"},{d:"essen",f:"Ø®ÙˆØ±Ø¯Ù†"},{d:"trinken",f:"Ù†ÙˆØ´ÛŒØ¯Ù†"},{d:"der Kaffee",f:"Ù‚Ù‡ÙˆÙ‡"},{d:"das Wasser",f:"Ø¢Ø¨"},{d:"lecker",f:"Ø®ÙˆØ´Ù…Ø²Ù‡"}],g:{t:"Ú¯Ø±Ø§Ù…Ø± Û¹",s:[{t:"mÃ¶chten",c:"",tb:"ich <span class='highlight'>mÃ¶chte</span>\ndu <span class='highlight'>mÃ¶chtest</span>",ex:["Ich mÃ¶chte Kaffee."]}]},l:{t:"Ø¯Ø±Ø³ Û¹",s:[{t:"ğŸ¯",c:"â€¢ Ø³ÙØ§Ø±Ø´ ØºØ°Ø§"}]},e:[{s:"Ich ___ einen Kaffee.",o:["mÃ¶chte","mÃ¶chtest","mÃ¶chten","mÃ¶chtet"],c:0,h:"",x:"mÃ¶chte"},{s:"Was ___ du?(essen)",o:["esst","esse","isst","essen"],c:2,h:"",x:"isst"}],ge:[{s:"ich ___(mÃ¶chten)",o:["mÃ¶chte","mÃ¶chtest","mÃ¶chten","mÃ¶chtet"],c:0,h:"",x:"mÃ¶chte"}]},
    10:{t:"Lektion 10",w:[{d:"die U-Bahn",f:"Ù…ØªØ±Ùˆ"},{d:"der Bus",f:"Ø§ØªÙˆØ¨ÙˆØ³"},{d:"das Auto",f:"Ù…Ø§Ø´ÛŒÙ†"},{d:"fahren",f:"Ø±ÙØªÙ†"},{d:"einsteigen",f:"Ø³ÙˆØ§Ø± Ø´Ø¯Ù†"}],g:{t:"Ú¯Ø±Ø§Ù…Ø± Û±Û°",s:[{t:"mit+Ø¯Ø§ØªÛŒÙˆ",c:"",tb:"mit <span class='highlight'>dem</span> Bus\nmit <span class='highlight'>der</span> U-Bahn",ex:["Ich fahre mit dem Bus."]}]},l:{t:"Ø¯Ø±Ø³ Û±Û°",s:[{t:"ğŸ¯",c:"â€¢ Ø­Ù…Ù„â€ŒÙˆÙ†Ù‚Ù„"}]},e:[{s:"Ich ___ mit der U-Bahn.",o:["fahre","fÃ¤hrst","fÃ¤hrt","fahren"],c:0,h:"",x:"fahre"},{s:"mit ___ Bus",o:["der","dem","den","die"],c:1,h:"Ø¯Ø§ØªÛŒÙˆ",x:"dem"}],ge:[{s:"ich ___(fahren)",o:["fahre","fÃ¤hrst","fÃ¤hrt","fahren"],c:0,h:"",x:"fahre"}]},
    11:{t:"Lektion 11",w:[{d:"gemacht",f:"Ø§Ù†Ø¬Ø§Ù… Ø¯Ø§Ø¯Ù‡"},{d:"gekauft",f:"Ø®Ø±ÛŒØ¯Ù‡"},{d:"gegessen",f:"Ø®ÙˆØ±Ø¯Ù‡"},{d:"getrunken",f:"Ù†ÙˆØ´ÛŒØ¯Ù‡"},{d:"gefahren",f:"Ø±ÙØªÙ‡"},{d:"heute",f:"Ø§Ù…Ø±ÙˆØ²"},{d:"gestern",f:"Ø¯ÛŒØ±ÙˆØ²"}],g:{t:"Ú¯Ø±Ø§Ù…Ø± Û±Û±",s:[{t:"Perfekt",c:"",tb:"Ich <span class='highlight'>habe</span> <span class='highlight'>getrunken</span>.\nSie <span class='highlight'>ist</span> <span class='highlight'>gefahren</span>.",ex:["Ich habe gelernt."]}]},l:{t:"Ø¯Ø±Ø³ Û±Û±",s:[{t:"ğŸ¯",c:"â€¢ Ø²Ù…Ø§Ù† Ú¯Ø°Ø´ØªÙ‡"}]},e:[{s:"Ich ___ Kaffee getrunken.",o:["habe","bin","hat","ist"],c:0,h:"",x:"habe"},{s:"Sie ___ gefahren.",o:["habe","hat","bin","ist"],c:3,h:"sein",x:"ist"},{s:"machenâ†’___",o:["gemacht","gemachen","gemakt","macht"],c:0,h:"",x:"gemacht"}],ge:[{s:"lernenâ†’___",o:["gelernt","gelearnt","lernt","gelarnt"],c:0,h:"",x:"gelernt"}]},
    12:{t:"Lektion 12",w:[{d:"passieren",f:"Ø§ØªÙØ§Ù‚ Ø§ÙØªØ§Ø¯Ù†"},{d:"der Kopf",f:"Ø³Ø±"},{d:"das Fieber",f:"ØªØ¨"},{d:"krank",f:"Ù…Ø±ÛŒØ¶"},{d:"wehtun",f:"Ø¯Ø±Ø¯ Ú©Ø±Ø¯Ù†"},{d:"mÃ¼ssen",f:"Ø¨Ø§ÛŒØ¯"},{d:"die Medizin",f:"Ø¯Ø§Ø±Ùˆ"}],g:{t:"Ú¯Ø±Ø§Ù…Ø± Û±Û²",s:[{t:"mÃ¼ssen",c:"",tb:"ich <span class='highlight'>muss</span>\ndu <span class='highlight'>musst</span>",ex:["Ich muss zum Arzt."]}]},l:{t:"Ø¯Ø±Ø³ Û±Û²",s:[{t:"ğŸ¯",c:"â€¢ Ø¨ÛŒÙ…Ø§Ø±ÛŒ"}]},e:[{s:"Mein Kopf ___ weh.",o:["tut","tust","macht","hat"],c:0,h:"",x:"tut"},{s:"Ich ___ zum Arzt.",o:["mÃ¼ssen","muss","musst","mÃ¼sst"],c:1,h:"",x:"muss"}],ge:[{s:"ich ___(mÃ¼ssen)",o:["muss","musst","mÃ¼ssen","mÃ¼sst"],c:0,h:"",x:"muss"}]}
    };

    // ===== STATE =====
    let cL=1, cQ=[], cI=0, qS=0, cCI=0, cF=false;
    let tS = parseInt(localStorage.getItem('ms'))||0;
    let st = parseInt(localStorage.getItem('mt'))||0;
    let settings = JSON.parse(localStorage.getItem('appSettings'))||{hints:true,autoNext:false};
    let leaderboardCache = [];

    // ===== UTILITIES =====
    function showToast(msg) {
        const t=document.getElementById('toast');
        t.textContent=msg;t.classList.add('show');
        setTimeout(()=>t.classList.remove('show'),2500);
    }

    function trackDay() {
        let d=JSON.parse(localStorage.getItem('activeDays'))||[];
        const t=new Date().toISOString().split('T')[0];
        if(!d.includes(t)){d.push(t);localStorage.setItem('activeDays',JSON.stringify(d));}
    }
    function getActiveDays(){return(JSON.parse(localStorage.getItem('activeDays'))||[]).length;}
    trackDay();

    function updateScoreUI() {
        document.getElementById('totalScore').textContent=tS;
        document.getElementById('streak').textContent=st;
        let l='Ù…Ø¨ØªØ¯ÛŒ';
        if(tS>=500)l='â­ Ø­Ø±ÙÙ‡â€ŒØ§ÛŒ';else if(tS>=300)l='ğŸ¥‡ Ù¾ÛŒØ´Ø±ÙØªÙ‡';else if(tS>=150)l='ğŸ¥ˆ Ù…ØªÙˆØ³Ø·';else if(tS>=50)l='ğŸ¥‰ Ù…Ø¨ØªØ¯ÛŒ+';
        document.getElementById('levelBadge').textContent=l;
        localStorage.setItem('ms',tS);localStorage.setItem('mt',st);
    }

    // ===== TAB NAVIGATION =====
    function switchTab(name, btn) {
        document.querySelectorAll('.tab-btn').forEach(t=>t.classList.remove('active'));
        document.querySelectorAll('.tab-page').forEach(p=>p.classList.remove('active'));
        btn.classList.add('active');
        document.getElementById('page'+name).classList.add('active');

        if(name==='Home') { document.getElementById('headerTitle').textContent='ğŸ“š Menschen A1.1'; document.getElementById('headerSub').textContent='Ø¢Ù…ÙˆØ²Ø´ Ø²Ø¨Ø§Ù† Ø¢Ù„Ù…Ø§Ù†ÛŒ'; }
        else if(name==='Leaderboard') { document.getElementById('headerTitle').textContent='ğŸ† Ø±ØªØ¨Ù‡â€ŒØ¨Ù†Ø¯ÛŒ'; document.getElementById('headerSub').textContent='Ø±Ù‚Ø§Ø¨Øª Ø¨Ø§ Ø¯ÛŒÚ¯Ø±Ø§Ù†'; loadLeaderboard(); }
        else if(name==='Profile') { document.getElementById('headerTitle').textContent='ğŸ‘¤ Ø­Ø³Ø§Ø¨ Ú©Ø§Ø±Ø¨Ø±ÛŒ'; document.getElementById('headerSub').textContent='Ù¾Ø±ÙˆÙØ§ÛŒÙ„ Ø´Ù…Ø§'; updateProfileUI(); }
        else if(name==='Settings') { document.getElementById('headerTitle').textContent='âš™ï¸ ØªÙ†Ø¸ÛŒÙ…Ø§Øª'; document.getElementById('headerSub').textContent='Ø´Ø®ØµÛŒâ€ŒØ³Ø§Ø²ÛŒ'; updateSettingsUI(); }
    }

    // ===== GOOGLE AUTH =====
    function googleSignIn() {
        if (!firebaseReady) {
            showToast('âš ï¸ Ø§Ø¨ØªØ¯Ø§ Firebase Ø±Ø§ ØªÙ†Ø¸ÛŒÙ… Ú©Ù†ÛŒØ¯');
            return;
        }
        const provider = new firebase.auth.GoogleAuthProvider();
        provider.addScope('profile');
        provider.addScope('email');
        auth.signInWithPopup(provider).then(result => {
            currentUser = result.user;
            showToast('âœ… Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒØ¯ ' + currentUser.displayName);
            syncUserToFirestore();
            updateProfileUI();
        }).catch(err => {
            console.error('Auth error:', err);
            if(err.code === 'auth/popup-closed-by-user') {
                showToast('ÙˆØ±ÙˆØ¯ Ù„ØºÙˆ Ø´Ø¯');
            } else if(err.code === 'auth/configuration-not-found') {
                showToast('âš ï¸ Firebase Config Ù†Ø§Ø¯Ø±Ø³Øª Ø§Ø³Øª');
            } else {
                showToast('âŒ Ø®Ø·Ø§: ' + err.message);
            }
        });
    }

    function googleSignOut() {
        if(auth) {
            auth.signOut().then(()=>{
                currentUser=null;
                showToast('ğŸ‘‹ Ø®Ø§Ø±Ø¬ Ø´Ø¯ÛŒØ¯');
                updateProfileUI();
            });
        }
    }

    // Listen for auth state
    if(firebaseReady) {
        auth.onAuthStateChanged(user => {
            currentUser = user;
            updateProfileUI();
            if(user) {
                syncUserToFirestore();
                document.getElementById('connStatus').textContent = 'ğŸŸ¢ Ù…ØªØµÙ„';
            } else {
                document.getElementById('connStatus').textContent = 'ğŸ”´ Ø¢ÙÙ„Ø§ÛŒÙ†';
            }
        });
    }

    // ===== FIRESTORE SYNC =====
    function syncUserToFirestore() {
        if(!firebaseReady || !currentUser) return;
        const ref = db.collection('users').doc(currentUser.uid);
        ref.set({
            displayName: currentUser.displayName || 'Ú©Ø§Ø±Ø¨Ø±',
            photoURL: currentUser.photoURL || '',
            email: currentUser.email || '',
            score: tS,
            streak: st,
            level: tS>=500?'A1+':tS>=300?'A1':'A1.1',
            lastActive: firebase.firestore.FieldValue.serverTimestamp(),
            activeDays: getActiveDays(),
            updatedAt: firebase.firestore.FieldValue.serverTimestamp()
        }, {merge: true}).catch(e=>console.warn('Sync error:',e));
    }

    function updateScoreOnline() {
        updateScoreUI();
        syncUserToFirestore();
    }

    // ===== LEADERBOARD =====
    function loadLeaderboard() {
        if(!firebaseReady) {
            document.getElementById('lbList').innerHTML = '<div class="loading-spinner" style="padding:30px"><p style="font-size:0.85em;color:var(--text-secondary)">âš ï¸ Firebase ØªÙ†Ø¸ÛŒÙ… Ù†Ø´Ø¯Ù‡<br>Ø¨Ø±Ø§ÛŒ Ø±ØªØ¨Ù‡â€ŒØ¨Ù†Ø¯ÛŒ Ø¢Ù†Ù„Ø§ÛŒÙ†ØŒ Firebase Ø±Ø§ Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Ú©Ù†ÛŒØ¯</p></div>';
            document.getElementById('podiumArea').innerHTML = '';
            document.getElementById('onlineCount').textContent = 'Ø¢ÙÙ„Ø§ÛŒÙ†';
            return;
        }
        document.getElementById('lbList').innerHTML = '<div class="loading-spinner"><div class="spin">â³</div><p>Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ...</p></div>';

        db.collection('users')
            .orderBy('score', 'desc')
            .limit(50)
            .get()
            .then(snapshot => {
                leaderboardCache = [];
                snapshot.forEach(doc => {
                    leaderboardCache.push({id: doc.id, ...doc.data()});
                });
                renderLeaderboard(leaderboardCache);
            })
            .catch(err => {
                console.error('Leaderboard error:', err);
                document.getElementById('lbList').innerHTML = '<div class="loading-spinner"><p>âŒ Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ</p></div>';
            });

        // Count online (active in last 5 min)
        const fiveMinAgo = new Date(Date.now() - 5*60*1000);
        db.collection('users')
            .where('lastActive', '>', fiveMinAgo)
            .get()
            .then(snap => {
                document.getElementById('onlineCount').textContent = snap.size + ' Ù†ÙØ± Ø¢Ù†Ù„Ø§ÛŒÙ†';
            }).catch(()=>{});
    }

    function renderLeaderboard(users) {
        if(!users || users.length === 0) {
            document.getElementById('podiumArea').innerHTML = '';
            document.getElementById('lbList').innerHTML = '<div class="loading-spinner"><p>Ù‡Ù†ÙˆØ² Ú©Ø³ÛŒ Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… Ù†Ú©Ø±Ø¯Ù‡!</p></div>';
            return;
        }

        // Podium top 3
        const top3 = users.slice(0,3);
        const medals = ['ğŸ¥ˆ','ğŸ¥‡','ğŸ¥‰'];
        const classes = ['second','first','third'];
        const order = [1,0,2];
        let podiumHTML = '';

        order.forEach((idx,dIdx) => {
            const u = top3[idx];
            if(!u) return;
            const isMe = currentUser && u.id === currentUser.uid;
            const name = u.displayName || 'Ú©Ø§Ø±Ø¨Ø±';
            const photo = u.photoURL;
            const avatarHTML = photo ?
                `<img src="${photo}" alt="">` :
                name.charAt(0).toUpperCase();

            podiumHTML += `
            <div class="podium-item ${classes[dIdx]}">
                <div class="podium-avatar" ${isMe?'style="border-color:var(--accent-indigo)"':''}>
                    ${avatarHTML}
                    <div class="podium-medal">${medals[idx]}</div>
                </div>
                <div class="podium-name">${isMe?'Ø´Ù…Ø§':name.split(' ')[0]}</div>
                <div class="podium-score-text">${u.score||0} â­</div>
                <div class="podium-bar"><span class="podium-rank">${idx+1}</span></div>
            </div>`;
        });
        document.getElementById('podiumArea').innerHTML = podiumHTML;

        // List (4th+)
        let listHTML = '';
        users.forEach((u,i) => {
            if(i<3) return;
            const isMe = currentUser && u.id === currentUser.uid;
            const name = u.displayName || 'Ú©Ø§Ø±Ø¨Ø±';
            const photo = u.photoURL;
            const avatarHTML = photo ?
                `<img src="${photo}" alt="">` :
                `<span style="font-size:1.2em">${name.charAt(0).toUpperCase()}</span>`;
            const lastActive = u.lastActive ? u.lastActive.toDate() : null;
            const isOnline = lastActive && (Date.now() - lastActive.getTime()) < 5*60*1000;

            listHTML += `
            <div class="lb-item ${isMe?'is-me':''}">
                <div class="lb-rank">${i+1}</div>
                <div class="lb-avatar-sm" ${isMe?'style="border-color:var(--accent-indigo)"':''}>
                    ${avatarHTML}
                </div>
                <div class="lb-info">
                    <div class="lb-name">${isMe?'<span class="me-badge">Ø´Ù…Ø§</span>':''}${name}</div>
                    <div class="lb-details">${isOnline?'ğŸŸ¢ Ø¢Ù†Ù„Ø§ÛŒÙ†':'ğŸ”˜ Ø¢ÙÙ„Ø§ÛŒÙ†'} â€¢ Ø³Ø·Ø­ ${u.level||'A1'} â€¢ ğŸ”¥${u.streak||0}</div>
                </div>
                <div class="lb-score">
                    <div class="lb-score-val">${u.score||0}</div>
                    <div class="lb-score-label">Ø§Ù…ØªÛŒØ§Ø²</div>
                </div>
            </div>`;
        });
        document.getElementById('lbList').innerHTML = listHTML || '<div class="loading-spinner"><p>Ù„ÛŒØ³Øª Ø®Ø§Ù„ÛŒ</p></div>';
    }

    // ===== PROFILE UI =====
    function updateProfileUI() {
        if(currentUser) {
            document.getElementById('authPrompt').style.display='none';
            document.getElementById('profileContent').style.display='block';

            document.getElementById('profileName').textContent = currentUser.displayName||'Ú©Ø§Ø±Ø¨Ø±';
            document.getElementById('profileEmail').textContent = currentUser.email||'';

            const avatarEl = document.getElementById('profileAvatar');
            if(currentUser.photoURL) {
                avatarEl.innerHTML = `<img src="${currentUser.photoURL}" alt="" style="width:100%;height:100%;object-fit:cover;">`;
            } else {
                avatarEl.innerHTML = `<span class="avatar-letter">${(currentUser.displayName||'U').charAt(0).toUpperCase()}</span>`;
            }

            document.getElementById('pStatScore').textContent = tS;
            document.getElementById('pStatStreak').textContent = st;
            document.getElementById('pStatDays').textContent = getActiveDays();

            // Get rank
            if(firebaseReady) {
                db.collection('users').where('score','>',tS).get().then(snap=>{
                    document.getElementById('pStatRank').textContent = '#' + (snap.size + 1);
                }).catch(()=>{
                    document.getElementById('pStatRank').textContent = '-';
                });
            }
        } else {
            document.getElementById('authPrompt').style.display='block';
            document.getElementById('profileContent').style.display='none';
        }
    }

    // ===== HOME NAVIGATION =====
    function hideHomeContent() {
        document.getElementById('mainMenu').style.display='none';
        document.getElementById('subMenu').classList.remove('show');
        document.getElementById('subMenuBack').style.display='none';
        ['wordsArea','grammarArea','lessonArea'].forEach(id=>document.getElementById(id).classList.remove('show'));
        document.getElementById('quizArea').style.display='none';
        document.getElementById('resultCard').style.display='none';
    }

    function goHome() {
        hideHomeContent();
        document.getElementById('mainMenu').style.display='block';
        document.getElementById('headerTitle').textContent='ğŸ“š Menschen A1.1';
        document.getElementById('headerSub').textContent='Ø¢Ù…ÙˆØ²Ø´ Ø²Ø¨Ø§Ù† Ø¢Ù„Ù…Ø§Ù†ÛŒ';
        updateScoreUI();
    }

    function openLektion(n) {
        cL=n; hideHomeContent();
        document.getElementById('subMenu').classList.add('show');
        document.getElementById('subMenuBack').style.display='block';
        document.getElementById('headerTitle').textContent='ğŸ“š '+L[n].t;
        document.getElementById('headerSub').textContent='Ø¨Ø®Ø´ Ù…ÙˆØ±Ø¯ Ù†Ø¸Ø± Ø±Ùˆ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†';
    }

    function backToSubMenu() {
        hideHomeContent();
        document.getElementById('subMenu').classList.add('show');
        document.getElementById('subMenuBack').style.display='block';
    }

    function showSection(t) {
        hideHomeContent();
        const l=L[cL];
        if(t==='words')sW(l);else if(t==='grammar')sG(l);else if(t==='lesson')sL(l);else if(t==='exercise')sEM(l);
    }

    // ===== WORDS =====
    function sW(l){const a=document.getElementById('wordsArea');let h='<div class="card liquid-glass-lg"><h2>ğŸ“ ÙˆØ§Ú˜Ù‡â€ŒÙ‡Ø§</h2><div class="flashcard" onclick="fWC()"><div class="word" id="wW"></div><div class="meaning" id="wM"></div><div class="tap-hint" id="wH">ğŸ‘† Ù„Ù…Ø³ Ú©Ù†</div></div><div class="fc-counter" id="wC"></div><div class="fc-nav"><button onclick="pWC()">â¬…ï¸</button><button onclick="nWC()">â¡ï¸</button></div></div>';h+='<div class="card liquid-glass-lg"><h2>ğŸ“‹ Ù„ÛŒØ³Øª</h2><table class="word-table"><tr><th>Ø¢Ù„Ù…Ø§Ù†ÛŒ</th><th>ÙØ§Ø±Ø³ÛŒ</th></tr>';l.w.forEach(w=>{h+='<tr><td class="de">'+w.d+'</td><td class="fa">'+w.f+'</td></tr>';});h+='</table></div><button class="back-btn" onclick="backToSubMenu()">â¬…ï¸ Ø¨Ø§Ø²Ú¯Ø´Øª</button>';a.innerHTML=h;a.classList.add('show');cCI=0;dWC(l);}
    function dWC(l){if(!l)l=L[cL];const w=l.w[cCI];document.getElementById('wW').textContent=w.d;document.getElementById('wM').textContent=w.f;document.getElementById('wM').style.display='none';document.getElementById('wH').style.display='block';document.getElementById('wC').textContent=(cCI+1)+' / '+l.w.length;cF=false;}
    function fWC(){const m=document.getElementById('wM'),h=document.getElementById('wH');if(!cF){m.style.display='block';h.style.display='none';cF=true;}else{m.style.display='none';h.style.display='block';cF=false;}}
    function nWC(){cCI=(cCI+1)%L[cL].w.length;dWC(L[cL]);}
    function pWC(){cCI=(cCI-1+L[cL].w.length)%L[cL].w.length;dWC(L[cL]);}

    // ===== GRAMMAR / LESSON =====
    function sG(l){const a=document.getElementById('grammarArea');let h='';l.g.s.forEach(s=>{h+='<div class="card liquid-glass-lg"><h3>'+s.t+'</h3>';if(s.c)h+='<p>'+s.c+'</p>';h+='<div class="grammar-box">'+s.tb.replace(/\n/g,'<br>')+'</div>';if(s.ex){h+='<h3>Ù…Ø«Ø§Ù„:</h3><ul>';s.ex.forEach(e=>h+='<li>'+e+'</li>');h+='</ul>';}h+='</div>';});h+='<button class="back-btn" onclick="backToSubMenu()">â¬…ï¸ Ø¨Ø§Ø²Ú¯Ø´Øª</button>';a.innerHTML=h;a.classList.add('show');}
    function sL(l){const a=document.getElementById('lessonArea');let h='';l.l.s.forEach(s=>{h+='<div class="card liquid-glass-lg"><h3>'+s.t+'</h3><p style="white-space:pre-line">'+s.c+'</p></div>';});h+='<button class="back-btn" onclick="backToSubMenu()">â¬…ï¸ Ø¨Ø§Ø²Ú¯Ø´Øª</button>';a.innerHTML=h;a.classList.add('show');}

    // ===== EXERCISE =====
    function sEM(l){const a=document.getElementById('wordsArea');let h='<div class="card liquid-glass-lg"><h2>âœï¸ ØªÙ…Ø±ÛŒÙ†</h2></div><div class="sub-menu show" style="display:grid"><div class="sub-btn liquid-glass" onclick="sE(\'m\')"><span class="sicon">âœï¸</span><span>ØªÙ…Ø±ÛŒÙ† Ø¯Ø±Ø³</span></div><div class="sub-btn liquid-glass" onclick="sE(\'g\')"><span class="sicon">ğŸ“</span><span>Ú¯Ø±Ø§Ù…Ø±</span></div><div class="sub-btn liquid-glass" onclick="sE(\'w\')"><span class="sicon">ğŸ”¤</span><span>Ù„ØºØ§Øª</span></div><div class="sub-btn liquid-glass" onclick="sE(\'a\')"><span class="sicon">ğŸ¯</span><span>Ø¢Ø²Ù…ÙˆÙ†</span></div></div><button class="back-btn" onclick="backToSubMenu()">â¬…ï¸ Ø¨Ø§Ø²Ú¯Ø´Øª</button>';a.innerHTML=h;a.classList.add('show');}

    function sE(t){hideHomeContent();const l=L[cL];let q=[];if(t==='m')q=[...l.e];else if(t==='g')q=[...(l.ge||[])];else if(t==='w'){const w=[...l.w].sort(()=>Math.random()-0.5).slice(0,6);w.forEach(wi=>{const o=[wi.f];while(o.length<4){const r=l.w[Math.floor(Math.random()*l.w.length)].f;if(!o.includes(r))o.push(r);}o.sort(()=>Math.random()-0.5);q.push({s:wi.d+" = ___",o:o,c:o.indexOf(wi.f),h:"Ù…Ø¹Ù†ÛŒ",x:wi.d+"="+wi.f});});}else q=[...l.e,...(l.ge||[])].sort(()=>Math.random()-0.5);cQ=q.sort(()=>Math.random()-0.5);cI=0;qS=0;document.getElementById('quizArea').style.display='block';sQ();}

    function sQ(){if(cI>=cQ.length){sR();return;}const q=cQ[cI];document.getElementById('progressFill').style.width=(cI/cQ.length*100)+'%';document.getElementById('questionNumber').textContent='Ø³Ø¤Ø§Ù„ '+(cI+1)+' Ø§Ø² '+cQ.length;document.getElementById('questionText').textContent='Ø¬Ø§ÛŒ Ø®Ø§Ù„ÛŒ Ø±Ùˆ Ù¾Ø± Ú©Ù†:';document.getElementById('questionSentence').innerHTML=q.s.replace('___','<span class="blank">______</span>');document.getElementById('questionHint').textContent=settings.hints&&q.h?'ğŸ’¡ '+q.h:'';const c=document.getElementById('optionsContainer');c.innerHTML='';q.o.forEach((o,i)=>{const b=document.createElement('button');b.className='option-btn';b.textContent=o;b.onclick=()=>cA(i,b);c.appendChild(b);});document.getElementById('explanation').classList.remove('show');document.getElementById('nextBtn').classList.remove('show');}

    function cA(s,b){const q=cQ[cI];const bs=document.querySelectorAll('.option-btn');bs.forEach(b=>b.disabled=true);if(s===q.c){b.classList.add('correct');qS++;tS+=10;st++;}else{b.classList.add('wrong');bs[q.c].classList.add('correct');st=0;}document.getElementById('explanation').innerHTML='ğŸ“š '+q.x;document.getElementById('explanation').classList.add('show');document.getElementById('nextBtn').classList.add('show');updateScoreOnline();if(settings.autoNext)setTimeout(()=>nextQuestion(),1500);}

    function nextQuestion(){cI++;sQ();}

    function sR(){document.getElementById('quizArea').style.display='none';document.getElementById('resultCard').style.display='block';const p=Math.round(qS/cQ.length*100);let e,t,x;if(p===100){e='ğŸ†';t='Ø¹Ø§Ù„ÛŒ!';x='Ø¨ÛŒâ€ŒÙ†Ù‚Øµ!';}else if(p>=80){e='ğŸŒŸ';t='Ø®ÛŒÙ„ÛŒ Ø®ÙˆØ¨!';x='Ø§Ø¯Ø§Ù…Ù‡ Ø¨Ø¯Ù‡!';}else if(p>=60){e='ğŸ‘';t='Ø®ÙˆØ¨ Ø¨ÙˆØ¯!';x='ØªÙ…Ø±ÛŒÙ† Ú©Ù†!';}else{e='ğŸ’ª';t='Ù†Ø§Ø§Ù…ÛŒØ¯ Ù†Ø´Ùˆ!';x='Ø¯Ø±Ø³ Ø±Ùˆ Ø¨Ø®ÙˆÙ†!';}document.getElementById('resultEmoji').textContent=e;document.getElementById('resultTitle').textContent=t;document.getElementById('resultScore').textContent=qS+' Ø§Ø² '+cQ.length;document.getElementById('resultText').textContent=x;syncUserToFirestore();}

    // ===== SETTINGS =====
    function updateSettingsUI(){
        const isDark=!document.body.classList.contains('light-mode');
        document.getElementById('themeToggle').classList.toggle('active',isDark);
        document.getElementById('hintToggle').classList.toggle('active',settings.hints);
        document.getElementById('autoNextToggle').classList.toggle('active',settings.autoNext);
    }

    function toggleTheme(){document.body.classList.toggle('light-mode');const isLight=document.body.classList.contains('light-mode');localStorage.setItem('theme',isLight?'light':'dark');updateSettingsUI();showToast(isLight?'â˜€ï¸ Ø±ÙˆØ´Ù†':'ğŸŒ™ ØªØ§Ø±ÛŒÚ©');}
    function toggleHints(){settings.hints=!settings.hints;localStorage.setItem('appSettings',JSON.stringify(settings));updateSettingsUI();}
    function toggleAutoNext(){settings.autoNext=!settings.autoNext;localStorage.setItem('appSettings',JSON.stringify(settings));updateSettingsUI();}
    function resetProgress(){if(confirm('ØªÙ…Ø§Ù… Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ù¾Ø§Ú© Ø¨Ø´Ù‡ØŸ')){localStorage.removeItem('ms');localStorage.removeItem('mt');localStorage.removeItem('activeDays');tS=0;st=0;updateScoreUI();syncUserToFirestore();showToast('ğŸ—‘ï¸ Ù¾Ø§Ú© Ø´Ø¯!');goHome();}}

    function loadTheme(){if(localStorage.getItem('theme')==='light')document.body.classList.add('light-mode');}

    // ===== BUILD =====
    function buildList(){
        const li=document.getElementById('lektionList');let h='';
        lektionInfo.forEach(l=>{h+='<div class="lektion-btn liquid-glass" onclick="openLektion('+l.num+')"><span class="icon">'+l.icon+'</span><div class="info"><div class="title">'+l.title+'</div><div class="subtitle">'+l.subtitle+'</div></div><span class="arrow">â†</span></div>';});
        li.innerHTML=h;
    }

    // ===== Periodic sync =====
    setInterval(()=>{
        if(currentUser) syncUserToFirestore();
    }, 60000);

    // ===== INIT =====
    loadTheme();
    buildList();
    updateScoreUI();
</script>
</body>
</html>